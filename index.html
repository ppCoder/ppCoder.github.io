<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="Yun">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Yun">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Yun">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>Yun</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Yun</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Code and Love.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/24/架构/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PPCoder">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/author.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/24/架构/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-24T22:44:20+08:00">
                2019-09-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="DevOps"><a href="#DevOps" class="headerlink" title="DevOps"></a><code>DevOps</code></h3><p>是一组过程，方法与系统的统称，用于促进开发(应用程序/软件工程)，技术运营和质量保障部门之间的沟通，协作与整合。</p>
<p>它的出现是由于软件行业日益清晰地认识到：为了按时交付软件产品和服务，开发和运营工作必须紧密合作</p>
<h4 id="职责"><a href="#职责" class="headerlink" title="职责"></a>职责</h4><ul>
<li>开发运维协作</li>
<li>自动化，基础设施即代码</li>
<li>持续集成/测试</li>
<li>持续交付/部署</li>
<li>持续监控/反馈</li>
</ul>
<h3 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h3><p>一组独立的计算机系统构成一个松耦合的多处理器系统，它们之间通过网络实现进程间通信</p>
<p>应用程序可以通过网络共享内存进行消息传送，实现分布式计算机</p>
<h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><p>1.基于DNS的负载均衡</p>
<p>通过DNS服务中的随机名字解析来实现负载均衡，在DNS服务器中，可以为多个不同地址配置同一个名字，而最终查询这个名字的客户机将在解析这个名字时，得到其中一个地址。</p>
<p>因此，对于同一个名字，不同的客户机会得到不同的地址，他们也就访问不同地址上的Web服务器，从而达到负载均衡的目的</p>
<p>2.反向代理负载均衡</p>
<p>3.基于NAT的负载均衡</p>
<p>网络地址转换为在内部地址和外部地址之间进行转换，以便具备内部地址的计算机能访问外部网络，而当外部网络中的计算机访问地址转换网关拥有的某一外部地址时，地址转换网关能将其转发到一个映射的内部地址上，因此如果地址转换网关能将每个连接均匀转换为不同的内部服务器地址，此后外部网络中的计算机就各自与自己转换得到的地址上服务器进行通信，从而达到负载分担的目的</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/24/计算机网络/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PPCoder">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/author.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/24/计算机网络/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-24T22:44:20+08:00">
                2019-09-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h2><p>SourceShell</p>
<p>为建立在应用层基础上的安全协议。</p>
<p>专为远程登陆会话和其他网络服务提供安全性的协议，利用SSH协议可以有效防止远程登陆过程中的信息泄露问题</p>
<p>前提：ftp，pop和telnet都不安全，使用明文传送口令和数据</p>
<h2 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h2><h3 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h3><blockquote>
<p>套接字是一个位于网络中特定节点的服务所具有的标识符，套接字包含一个节点地址和一个端口号，用来标识这一服务</p>
</blockquote>
<h5 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h5><p>大多数应用层协议如FTP，SMTP和POP3使用Socket来简历客户端和服务端之间的连接，从而进行数据的交换</p>
<h5 id="特征"><a href="#特征" class="headerlink" title="特征"></a>特征</h5><ul>
<li><p>==所有连接必须是唯一的==</p>
</li>
<li><p>套接字只允许在通信线程之间交换无结构字节流</p>
</li>
</ul>
<h3 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h3><h4 id="Socket-1"><a href="#Socket-1" class="headerlink" title="Socket"></a>Socket</h4><p>属于传输层，是对TCP/IP协议的实现，包含TCP/UDP，它是所有通信协议的基础，HTTP协议需要socket支持，以socket作为基础</p>
<ul>
<li>长连接通信，容易被防火墙拦截，可以通过心跳机制来实现，开发难度大</li>
<li>传输的数据一般是字符串，可读性不强</li>
<li>性能相对于是最优的</li>
<li>不便于 推广</li>
</ul>
<h4 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h4><p>属于应用层协议，对socket进行了封装</p>
<ul>
<li>跨平台</li>
<li>传数据还是不够友好</li>
<li>对第三方应用提供的服务，希望对外暴露服务的接口</li>
</ul>
<h4 id="WebService"><a href="#WebService" class="headerlink" title="WebService"></a>WebService</h4><p>改进HTTP缺点</p>
<ul>
<li>数据封装不够友好–&gt; 用xml封装数据</li>
<li>希望给第三方应用提供web方式的服务(http+xml) = web service</li>
</ul>
<h4 id="TCP三次握手"><a href="#TCP三次握手" class="headerlink" title="TCP三次握手"></a>TCP三次握手</h4><ol>
<li>A发送SYN=1，随机产生seq number</li>
<li>B收到请求，发送ACK=1，SYN=1，ack number=seq number+1，随机产生seq number</li>
<li>A检查ack number，发送ACK=1，ack number=seq+1</li>
</ol>
<h2 id="IP"><a href="#IP" class="headerlink" title="IP"></a>IP</h2><h3 id="私有IP地址"><a href="#私有IP地址" class="headerlink" title="私有IP地址"></a>私有IP地址</h3><ul>
<li>A类IP地址中：10.0.0.0–10.255.255.255</li>
<li>B类IP地址中：172.16.0.0–172.31.255.255</li>
<li>C类IP地址中：192.168.0.0–192.168.255.255</li>
</ul>
<h3 id="公有地址"><a href="#公有地址" class="headerlink" title="公有地址"></a>公有地址</h3><p>除私有地址之外的地址</p>
<h3 id="回环地址"><a href="#回环地址" class="headerlink" title="回环地址"></a>回环地址</h3><p>凡是以127开头的地址，都是回环地址</p>
<p>给回环地址发送的数据包会被主机IP层获取，不进入链路层</p>
<h2 id="HTTP-1"><a href="#HTTP-1" class="headerlink" title="HTTP"></a>HTTP</h2><p><code>HyperText Transfer Protocol</code>: 超文本传输协议</p>
<h3 id="HTTP格式"><a href="#HTTP格式" class="headerlink" title="HTTP格式"></a>HTTP格式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#请求行：请求方法URI协议/版本</span><br><span class="line">POST /index.html HTTP/1.1   请求方法 url 协议/版本号</span><br><span class="line">#请求头</span><br><span class="line">Host: localhost  主机地址</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 5.1; rv:10.0.2) Gecko/20100101 Firefox/10.0.2</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-cn,zh;q=0.5</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Referer: &lt;a target=_blank href=&quot;http://localhost/&quot; style=&quot;color: rgb(51, 102, 153); text-decoration: none;&quot;&gt;http://localhost/&lt;/a&gt;</span><br><span class="line">Content-Length：25</span><br><span class="line">Content-Type：application/x-www-form-urlencoded</span><br><span class="line">                    请求空行 标志着请求头结束，请求正文（请求体）的开始</span><br><span class="line">#请求体</span><br><span class="line">username=aa&amp;password=1234</span><br></pre></td></tr></table></figure>

<p>HTTP1.1 默认进行持久连接</p>
<h4 id="HTTP工作过程"><a href="#HTTP工作过程" class="headerlink" title="HTTP工作过程"></a>HTTP工作过程</h4><ol>
<li>地址解析</li>
<li>封装HTTP请求数据包</li>
<li>封装成TCP包，建立TCP连接</li>
<li>客户机发送请求响应</li>
<li>服务器响应</li>
<li>服务器关闭TCP连接</li>
</ol>
<h4 id="HTTP中GET和POST的区别"><a href="#HTTP中GET和POST的区别" class="headerlink" title="HTTP中GET和POST的区别"></a>HTTP中GET和POST的区别</h4><p>HTTP定义了四种方法GET,POST,PUT,DELETE对应着四种资源的操作方式查，改，增，删。</p>
<h5 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h5><ul>
<li>所以GET用于获取信息时而不修改信息，是安全的</li>
<li>GET请求的数据会附加在URL之后，可提交的数据量跟URL的长度有关，而URL的长度是和浏览器和服务器相关的</li>
<li>GET请求可以缓存</li>
<li>GET请求只支持URL编码</li>
<li>大多数浏览器限制url长度为2K个字节，而大多数服务器最多处理64K大小的URL，虽然GET可以带body，但不能保证服务器会读取</li>
</ul>
<h5 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h5><ul>
<li>POST用于修改信息，需要用到表单提交</li>
<li>提交的数据放在HTTP的包体中</li>
<li>POST请求不可缓存</li>
<li>产生两个TCP数据包，浏览器先发送header，服务器响应100，再发送data，服务器响应200，firefox除外</li>
</ul>
<h4 id="HTTPS实现原理"><a href="#HTTPS实现原理" class="headerlink" title="HTTPS实现原理"></a>HTTPS实现原理</h4><ol>
<li>SSL客户端发出一个消息给服务器，这个消息里面包含了自己可实现的算法列表和其他的一些需要的信息，SSL的服务器端会回应一个数据包，这里面确定了这次通信所需要的算法，然后服务器向客户端返回证书（证书里包含了服务器信息：域名。申请证书的公司，公共密匙）</li>
<li>Client在收到服务器返回的证书后，判断签发这个证书的公共签发机构，并使用这个机构的公共密匙确认签名是否有效，客户端还会确保证书中列出的域名就是它正在连接的域名</li>
<li>如果确认证书有效，那么生成对称密匙并使用服务器的公共密匙进行加密。然后发送给服务器，服务器使用它的私匙对它进行解密，这样两台计算机可以开始进行对称加密进行通信</li>
</ol>
<h5 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h5><p>HTTP+SSL层，HTTPS的安全基础是SSL，HTTPS端口号：443</p>
<h5 id="SSL"><a href="#SSL" class="headerlink" title="SSL"></a>SSL</h5><p>安全套接层，通过证书认证来确保客户端和网站服务器之间的数据是加密安全的</p>
<h2 id="WebService-1"><a href="#WebService-1" class="headerlink" title="WebService"></a>WebService</h2><h3 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h3><h3 id="WSDL"><a href="#WSDL" class="headerlink" title="WSDL"></a>WSDL</h3><p>web service description language-WebService描述语言</p>
<p>通过xml形式说明服务在什么地方–地址</p>
<p>通过xml形式说明服务提供什么方法 – 如何调用</p>
<h3 id="SOAP"><a href="#SOAP" class="headerlink" title="SOAP"></a>SOAP</h3><p>是XML WebService的通信协议</p>
<p>HTTP+XML</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/24/SingleServiceDemo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PPCoder">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/author.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/24/SingleServiceDemo/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-24T22:44:20+08:00">
                2019-09-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-搭建服务"><a href="#1-搭建服务" class="headerlink" title="1.搭建服务"></a>1.搭建服务</h2><ul>
<li><input checked disabled type="checkbox"> 实现增删改查</li>
</ul>
<ul>
<li><input checked disabled type="checkbox"> 将操作记录保存到库中</li>
<li><input checked disabled type="checkbox"> 处理异常：少用异常</li>
<li><input checked disabled type="checkbox"> 日志分类</li>
</ul>
<h3 id="保存操作记录"><a href="#保存操作记录" class="headerlink" title="保存操作记录"></a>保存操作记录</h3><p>切面保存操作记录</p>
<p>规范化返回信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回结果工具类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">success</span><span class="params">(Object object)</span></span>&#123;</span><br><span class="line">        Result result = <span class="keyword">new</span> Result();</span><br><span class="line">        result.setCode(<span class="number">0</span>);</span><br><span class="line">        result.setMsg(<span class="string">"成功"</span>);</span><br><span class="line">        result.setData(object);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">success</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> success(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">error</span><span class="params">(Integer code,String msg)</span></span>&#123;</span><br><span class="line">        Result result = <span class="keyword">new</span> Result();</span><br><span class="line">        result.setCode(code);</span><br><span class="line">        result.setMsg(msg);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回格式</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Result</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//错误码</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//提示信息</span></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//具体的内容</span></span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//枚举格式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> ResultEnum &#123;</span><br><span class="line">    UNKNOW_ERROR(-<span class="number">1</span>,<span class="string">"未知错误"</span>),</span><br><span class="line">    SUCCESS(<span class="number">0</span>,<span class="string">"成功"</span>),</span><br><span class="line">    PRIMARY_SCHOOL(<span class="number">100</span>,<span class="string">"xx"</span>),</span><br><span class="line">    MIDDLE_SCHOOL(<span class="number">101</span>,<span class="string">"xxx"</span>),</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>  Integer code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    ResultEnum(Integer code, String msg) &#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="异常处理："><a href="#异常处理：" class="headerlink" title="异常处理："></a>异常处理：</h3><blockquote>
<p>try-catch：捕获异常</p>
<p>throws：抛出异常到上层</p>
</blockquote>
<p><img src="https://image-static.segmentfault.com/411/861/4118619330-5a05577c2d32f" alt="img"></p>
<p>异常捕获规范：不要在业务代码中捕获异常，将业务层的所有异常全部抛出到上层，我们只需要用AOP对Controller层的所有方法处理即可</p>
<p>默认异常处理：/error</p>
<p>单个异常处理</p>
<p>全局异常处理</p>
<ul>
<li><p>自定义error属性</p>
<blockquote>
<p>simply add a bean of type <code>ErrorAttributes</code> to use the existing mechanism but replace the contents</p>
</blockquote>
</li>
<li><p>自定义errorController</p>
<blockquote>
<p>To do that just extend <code>BasicErrorController</code> and add a public method with a <code>@RequestMapping</code> that has a <code>produces</code> attribute, and create a bean of your new type.</p>
</blockquote>
</li>
<li><p>自定义ControllerAdvice</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义异常</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//参数可以改为枚举类型</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyException</span><span class="params">(Integer code,String message)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//父类的构造方法本身会传message进去</span></span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCode</span><span class="params">(Integer code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义error属性</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomErrorAttributes</span> <span class="keyword">implements</span> <span class="title">ErrorAttributes</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getErrorAttributes</span><span class="params">(RequestAttributes requestAttributes, <span class="keyword">boolean</span> includeStackTrace)</span> </span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; result = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    result.put(<span class="string">"timestamp"</span>, System.currentTimeMillis());</span><br><span class="line">    result.put(<span class="string">"error"</span>, <span class="string">"customized error"</span>);</span><br><span class="line">    result.put(<span class="string">"path"</span>, <span class="string">"customized path"</span>);</span><br><span class="line">    result.put(<span class="string">"status"</span>, <span class="number">100</span>);</span><br><span class="line">    result.put(<span class="string">"exception"</span>, <span class="string">"customized exception"</span>);</span><br><span class="line">    result.put(<span class="string">"message"</span>, <span class="string">"customized message"</span>);</span><br><span class="line">    result.put(<span class="string">"trace"</span>, <span class="string">"customized trace"</span>);</span><br><span class="line">    result.put(<span class="string">"add-attribute"</span>, <span class="string">"add-attribute"</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Throwable <span class="title">getError</span><span class="params">(RequestAttributes requestAttributes)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*应用到所有@RequestMapping注解方法，在其执行之前初始化数据绑定器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@InitBinder</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initWebBinder</span><span class="params">(WebDataBinder binder)</span></span>&#123;</span><br><span class="line">        <span class="comment">//对日期的统一处理</span></span><br><span class="line">        binder.addCustomFormatter(<span class="keyword">new</span> DateFormatter(<span class="string">"yyyy-MM-dd"</span>));</span><br><span class="line">        <span class="comment">//添加对数据的校验</span></span><br><span class="line">        <span class="comment">//binder.setValidator();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 把值绑定到Model中，使全局@RequestMapping可以获取到该值</span></span><br><span class="line"><span class="comment">     * 在Controller中使用ModelMap以及@ModelAttribute()来获取值</span></span><br><span class="line"><span class="comment">     * 实例：用于将异常信息传给控制器，然后规范json格式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ModelAttribute</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addAttribute</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">        model.addAttribute(<span class="string">"attribute"</span>,  <span class="string">"The Attribute"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_ERROR_VIEW = <span class="string">"error"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 全局异常捕获</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(value = Exception.class)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">defaultErrorHandler</span><span class="params">(HttpServletRequest req, Exception e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">        mav.addObject(<span class="string">"exception"</span>, e);</span><br><span class="line">        mav.addObject(<span class="string">"url"</span>, req.getRequestURL());</span><br><span class="line">        mav.setViewName(DEFAULT_ERROR_VIEW);</span><br><span class="line">        <span class="keyword">return</span> mav;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自定义异常捕获</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(value = MyException.class)<span class="comment">//拦截异常的类型，传入的参数可以时一个数组，同时处理多个异常</span></span><br><span class="line">    <span class="meta">@ResponseStatus</span>(HttpStatus.INTERNAL_SERVER_ERROR)<span class="comment">//自定义浏览器返回的状态码</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">jsonErrorHandler</span><span class="params">(HttpServletRequest req, MyException e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Response r = <span class="keyword">new</span> Response();</span><br><span class="line">        r.setMsg(e.getMessage());<span class="comment">//消息内容</span></span><br><span class="line">        r.setCode(ErrorInfo.ERROR);<span class="comment">//消息类型</span></span><br><span class="line">        r.setData(<span class="string">"Some Data"</span>);<span class="comment">//请求返回的数据</span></span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Springmvc的异常处理器</span></span><br><span class="line"><span class="comment">//不能使用两个ExceptionHandler去处理同一个异常</span></span><br></pre></td></tr></table></figure>

<h3 id="记录日志："><a href="#记录日志：" class="headerlink" title="记录日志："></a>记录日志：</h3><h4 id="SpringBoot中日志配置"><a href="#SpringBoot中日志配置" class="headerlink" title="SpringBoot中日志配置"></a>SpringBoot中日志配置</h4><h5 id="在项目中打印日志"><a href="#在项目中打印日志" class="headerlink" title="在项目中打印日志"></a>在项目中打印日志</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(XXX.class);</span><br></pre></td></tr></table></figure>

<h5 id="将日志存储到文件"><a href="#将日志存储到文件" class="headerlink" title="将日志存储到文件"></a>将日志存储到文件</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">	<span class="attr">file:</span> <span class="string">log\springbootdemo.log//设置文件，相对路径+文件名</span></span><br><span class="line">	<span class="attr">path:</span> <span class="string">xxxx//设置目录，绝对路径或相对路径</span></span><br><span class="line">	<span class="string">//当file和path同时设置，只有file生效</span></span><br></pre></td></tr></table></figure>

<h5 id="设置日志级别"><a href="#设置日志级别" class="headerlink" title="设置日志级别"></a>设置日志级别</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">	<span class="attr">level:</span></span><br><span class="line">		<span class="string">root=WARN;</span></span><br><span class="line">		<span class="string">com.example=INFO;</span></span><br></pre></td></tr></table></figure>

<h4 id="自定义日志配置"><a href="#自定义日志配置" class="headerlink" title="自定义日志配置"></a>自定义日志配置</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">	<span class="string">config=classpath:logging-config.xml</span></span><br></pre></td></tr></table></figure>

<p><code>configuration</code></p>
<ul>
<li><code>scan</code>：如果配置文件发生改变，将会被重新加载</li>
<li><code>scanPeriod</code>：设置检测配置文件是否有修改的时间间隔，如果没有给出时间单位，默认的单位是毫秒，默认时间1分钟</li>
<li><code>debug</code>：打印出<code>logback</code>内部日志信息，实时查看<code>logback</code>运行状态</li>
</ul>
<p><code>contextName</code></p>
<blockquote>
<p>每个logger都关联到logger上下文，默认上下文名称为“default”。</p>
<p>但可以使用<contextname>设置成其他名字，用于区分不同应用程序的记录。</contextname></p>
<p>一旦设置，不能修改,可以通过<code>%contextName</code>来打印日志上下文名称。</p>
</blockquote>
<p><code>property</code>：定义变量值</p>
<h5 id="appender：格式化日志输出节点"><a href="#appender：格式化日志输出节点" class="headerlink" title="appender：格式化日志输出节点"></a>appender：格式化日志输出节点</h5><ul>
<li><p>class：指定哪种输出策略，常用的是控制台输出策略和文件输出策略</p>
<p>–&gt; <code>ThresholdFilter</code>：系统定义拦截器，过滤ERROR级别以下的日志，</p>
</li>
</ul>
<p><code>encoder</code>：对日志进行编码</p>
<p><code>RollingFileAppender</code>：切分日志</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"RollingFileInfo"</span> <span class="attr">fileName</span>=<span class="string">"$&#123;log_path&#125;/info.log"</span></span></span><br><span class="line"><span class="tag"><span class="attr">filePattern</span>=<span class="string">"$&#123;log_path&#125;/$$&#123;date:yyyy-MM&#125;/info-%d&#123;yyyy-MM-dd&#125;-%i.log.gz"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Filters</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">"INFO"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">"WARN"</span> <span class="attr">onMatch</span>=<span class="string">"DENY"</span></span></span><br><span class="line"><span class="tag">                                 <span class="attr">onMismatch</span>=<span class="string">"NEUTRAL"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Filters</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"[%d][%t][%p][%c:%L] %m%n"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 归档每天的文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">"1"</span> <span class="attr">modulate</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 限制单个文件大小 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"2 MB"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 限制每天文件个数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">compressionLevel</span>=<span class="string">"0"</span> <span class="attr">max</span>=<span class="string">"10"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>fileNamePattern</code>：定义了日志的切分方式，把每一天的归档到一个文件夹中</p>
<h5 id="root：指定最基础的日志级别"><a href="#root：指定最基础的日志级别" class="headerlink" title="root：指定最基础的日志级别"></a><code>root</code>：指定最基础的日志级别</h5><ul>
<li>level：设置打印级别</li>
</ul>
<h5 id="loger：设置某个包或类的日志打印级别"><a href="#loger：设置某个包或类的日志打印级别" class="headerlink" title="loger：设置某个包或类的日志打印级别"></a><code>loger</code>：设置某个包或类的日志打印级别</h5><h3 id="事务回滚"><a href="#事务回滚" class="headerlink" title="事务回滚"></a>事务回滚</h3><p>1.业务层抛出异常，控制层处理</p>
<p>2.当异常为<code>RuntimeException</code>时，才会开启回滚</p>
<h2 id="2-nginx转发均衡"><a href="#2-nginx转发均衡" class="headerlink" title="2. nginx转发均衡"></a>2. nginx转发均衡</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#服务器集群</span><br><span class="line">upstream message.com&#123;</span><br><span class="line">    #weight是权重</span><br><span class="line">    server 127.0.0.1:5757 weight=2;</span><br><span class="line">    server 156.2.3.1:7777 weight=1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#修改nginx配置文件，</span><br><span class="line">server &#123;</span><br><span class="line">	listen       8765;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    #charset koi8-r;</span><br><span class="line">    #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        #root 静态资源文件存放位置</span><br><span class="line">        root   /home/work/chat/static;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">        #当访问路径不存在该资源时，转发</span><br><span class="line">        if (!-e $request_filename) &#123;</span><br><span class="line">        	proxy_pass http:message.com;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>附加：通过一个域名访问不同的nginx服务器</p>
<h2 id="3-postman调用接口"><a href="#3-postman调用接口" class="headerlink" title="3. postman调用接口"></a>3. postman调用接口</h2><h2 id="4-Druid监控"><a href="#4-Druid监控" class="headerlink" title="4. Druid监控"></a>4. Druid监控</h2><h4 id="4-1-Druid：数据库连接池"><a href="#4-1-Druid：数据库连接池" class="headerlink" title="4.1 Druid：数据库连接池"></a>4.1 Druid：数据库连接池</h4><h4 id="4-2-功能："><a href="#4-2-功能：" class="headerlink" title="4.2 功能："></a>4.2 功能：</h4><ol>
<li>数据库连接池，代替DBCP和C3P0</li>
<li>可以监控数据库访问性能</li>
<li>数据库密码加密</li>
<li>SQL执行日志</li>
<li>拓展JDBC：Filter机制</li>
</ol>
<h4 id="4-3-配置方法："><a href="#4-3-配置方法：" class="headerlink" title="4.3 配置方法："></a>4.3 配置方法：</h4><h5 id="4-3-1-纯yml配置"><a href="#4-3-1-纯yml配置" class="headerlink" title="4.3.1 纯yml配置"></a>4.3.1 纯yml配置</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用druid数据源</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="attr">druid:</span></span><br><span class="line">   <span class="comment"># 初始化大小</span></span><br><span class="line"><span class="attr">   initialSize:</span> <span class="number">10</span></span><br><span class="line">   <span class="comment">#最小连接数</span></span><br><span class="line"><span class="attr">   minIdle:</span> <span class="number">10</span></span><br><span class="line">   <span class="comment">#最大连接数</span></span><br><span class="line"><span class="attr">   maxActive:</span> <span class="number">200</span></span><br><span class="line">   <span class="comment"># 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒</span></span><br><span class="line"><span class="attr">   time-between-eviction-runs-millis:</span> <span class="number">60000</span></span><br><span class="line">   <span class="comment"># 配置一个连接在池中最小生存的时间，单位是毫秒</span></span><br><span class="line"><span class="attr">   min-evictable-idle-time-millis:</span> <span class="number">300000</span></span><br><span class="line">   <span class="comment"># 配置测试查询语句</span></span><br><span class="line"><span class="attr">   validationQuery:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">DUAL</span></span><br><span class="line"><span class="attr">   testOnBorrow:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">   testWhileIdle:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">   removeAbandoned:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">   removeAbandonedTimeout:</span> <span class="number">1800</span></span><br><span class="line"><span class="attr">   logAbandoned:</span> <span class="literal">true</span></span><br><span class="line">   <span class="comment"># 打开PSCache，并且指定每个连接上PSCache的大小</span></span><br><span class="line"><span class="attr">   poolPreparedStatements:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">   maxOpenPreparedStatements:</span> <span class="number">100</span></span><br><span class="line">   <span class="comment"># 配置监控统计拦截的filters，去掉后监控界面sql无法统计，'wall'用于防火墙</span></span><br><span class="line"><span class="attr">   filters:</span> <span class="string">stat,wall</span></span><br><span class="line">   <span class="comment"># 通过connectProperties属性来打开mergeSql功能；慢SQL记录</span></span><br><span class="line"><span class="attr">   connectionProperties:</span> <span class="string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=5000</span></span><br><span class="line">   <span class="comment">#配置监控视图</span></span><br><span class="line"><span class="attr">   stat-view-servlet:</span></span><br><span class="line">     <span class="comment">#登录查看信息的账号密码, 用于登录Druid监控后台</span></span><br><span class="line"><span class="attr">     login-username:</span> <span class="string">admin</span></span><br><span class="line"><span class="attr">     login-password:</span> <span class="number">1234</span></span><br><span class="line">     <span class="comment">#是否能够重置数据.</span></span><br><span class="line"><span class="attr">     reset-enable:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">     url-pattern:</span> <span class="string">/druid/*</span></span><br><span class="line">     <span class="comment"># 添加IP白名单</span></span><br><span class="line">     <span class="comment">#allow:</span></span><br><span class="line">     <span class="comment"># 添加IP黑名单，当白名单和黑名单重复时，黑名单优先级更高</span></span><br><span class="line">     <span class="comment">#deny:</span></span><br><span class="line">  <span class="comment">#监控拦截器</span></span><br><span class="line"><span class="attr">  web-stat-filter:</span></span><br><span class="line">     <span class="comment"># 添加过滤规则</span></span><br><span class="line"><span class="attr">     url-pattern:</span> <span class="string">/*</span></span><br><span class="line">     <span class="comment"># 忽略过滤格式</span></span><br><span class="line"><span class="attr">     exclusions:</span> <span class="string">"*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*"</span></span><br></pre></td></tr></table></figure>

<h5 id="4-3-2-配置类"><a href="#4-3-2-配置类" class="headerlink" title="4.3.2 配置类"></a>4.3.2 配置类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DruidConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(DruidConfig.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AppConfig appConfig;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.url&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String dbUrl;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.username&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.password&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.driver-class-name&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String driverClassName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.initial-size&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> initialSize;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.min-idle&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> minIdle;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.max-active&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxActive;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.max-wait&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxWait;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.time-between-eviction-runs-millis&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> timeBetweenEvictionRunsMillis;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.min-evictable-idle-time-millis&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> minEvictableIdleTimeMillis;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.validation-query&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String validationQuery;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.test-while-idle&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> testWhileIdle;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.test-on-borrow&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> testOnBorrow;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.test-on-return&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> testOnReturn;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.pool-prepared-statements&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> poolPreparedStatements;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.max-pool-prepared-statement-per-connection-size&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxPoolPreparedStatementPerConnectionSize;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.filters&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String filters;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"&#123;spring.datasource.druid.connection-properties&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String connectionProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>     <span class="comment">//声明其为Bean实例</span></span><br><span class="line">    <span class="meta">@Primary</span>  <span class="comment">//在同样的DataSource中，首先使用被标注的DataSource</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DruidDataSource datasource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">        datasource.setUrl(dbUrl);</span><br><span class="line">        datasource.setUsername(username);</span><br><span class="line">        datasource.setPassword(password);</span><br><span class="line">        datasource.setDriverClassName(driverClassName);</span><br><span class="line">        <span class="comment">//configuration</span></span><br><span class="line">        datasource.setInitialSize(initialSize);</span><br><span class="line">        datasource.setMinIdle(minIdle);</span><br><span class="line">        datasource.setMaxActive(maxActive);</span><br><span class="line">        datasource.setMaxWait(maxWait);</span><br><span class="line">        datasource.setTimeBetweenEvictionRunsMillis(timeBetweenEvictionRunsMillis);</span><br><span class="line">        datasource.setMinEvictableIdleTimeMillis(minEvictableIdleTimeMillis);</span><br><span class="line">        datasource.setValidationQuery(validationQuery);</span><br><span class="line">        datasource.setTestWhileIdle(testWhileIdle);</span><br><span class="line">        datasource.setTestOnBorrow(testOnBorrow);</span><br><span class="line">        datasource.setTestOnReturn(testOnReturn);</span><br><span class="line">        datasource.setPoolPreparedStatements(poolPreparedStatements);</span><br><span class="line">        datasource.setMaxPoolPreparedStatementPerConnectionSize(maxPoolPreparedStatementPerConnectionSize);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            datasource.setFilters(filters);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">"druid configuration initialization filter"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        datasource.setConnectionProperties(connectionProperties);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> datasource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">druidServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//logger.info("init Druid Servlet Configuration ");</span></span><br><span class="line">        ServletRegistrationBean servletRegistrationBean = <span class="keyword">new</span> ServletRegistrationBean();</span><br><span class="line">        servletRegistrationBean.setServlet(<span class="keyword">new</span> StatViewServlet());</span><br><span class="line">        servletRegistrationBean.addUrlMappings(<span class="string">"/druid/*"</span>);</span><br><span class="line">        Map&lt;String, String&gt; initParameters = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        initParameters.put(<span class="string">"loginUsername"</span>, appConfig.getDruidUserName());<span class="comment">// 用户名</span></span><br><span class="line">        initParameters.put(<span class="string">"loginPassword"</span>, appConfig.getDruidPassword());<span class="comment">// 密码</span></span><br><span class="line">        initParameters.put(<span class="string">"resetEnable"</span>, appConfig.getDruidResetAll());<span class="comment">// 禁用HTML页面上的“Reset All”功能</span></span><br><span class="line">        initParameters.put(<span class="string">"allow"</span>, <span class="string">""</span>); <span class="comment">// IP白名单 (没有配置或者为空，则允许所有访问)</span></span><br><span class="line">        <span class="comment">//initParameters.put("deny", "192.168.20.38");// IP黑名单 (存在共同时，deny优先于allow)</span></span><br><span class="line">        servletRegistrationBean.setInitParameters(initParameters);</span><br><span class="line">        <span class="keyword">return</span> servletRegistrationBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">druidWebStatViewFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        FilterRegistrationBean registrationBean = <span class="keyword">new</span> FilterRegistrationBean(<span class="keyword">new</span> WebStatFilter());</span><br><span class="line">        registrationBean.addInitParameter(<span class="string">"urlPatterns"</span>, <span class="string">"/*"</span>);</span><br><span class="line">        registrationBean.addInitParameter(<span class="string">"exclusions"</span>, <span class="string">"*.js,*.gif,*.jpg,*.bmp,*.png,*.css,*.ico,/druid/*"</span>);</span><br><span class="line">        <span class="keyword">return</span> registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-4-使用方法"><a href="#4-4-使用方法" class="headerlink" title="4.4 使用方法"></a>4.4 使用方法</h4><p>本地访问 <a href="http://localhost:8080/druid" target="_blank" rel="noopener">http://localhost:8080/druid</a></p>
<h2 id="5-Redis缓存"><a href="#5-Redis缓存" class="headerlink" title="5. Redis缓存"></a>5. Redis缓存</h2><h3 id="5-1-Redis"><a href="#5-1-Redis" class="headerlink" title="5.1 Redis"></a>5.1 Redis</h3><h4 id="5-1-1-Redis是什么"><a href="#5-1-1-Redis是什么" class="headerlink" title="5.1.1 Redis是什么"></a>5.1.1 Redis是什么</h4><blockquote>
<p>Redis是一个开源（BSD许可），内存数据结构存储，用作数据库，缓存和消息代理。它支持数据结构，如 strings, hashes, lists, sets, sorted sets with range queries, bitmaps, hyperloglogs, geospatial indexes with radius queries and streams。Redis具有内置复制，Lua脚本，LRU驱逐，事务和不同级别的磁盘持久性，并通过Redis Sentinel提供高可用性并使用Redis Cluster自动分区</p>
</blockquote>
<blockquote>
<p>Redis通常被称为<em>数据结构</em>服务器，这意味着Redis通过一组命令提供对可变数据结构的访问，这些命令使用带有TCP套接字和简单协议的<code>server-client</code>模型发送。因此，不同的进程可以以共享方式和修改相同的数据结构。</p>
</blockquote>
<h4 id="5-1-2-Redis数据结构的特殊属性"><a href="#5-1-2-Redis数据结构的特殊属性" class="headerlink" title="5.1.2 Redis数据结构的特殊属性"></a>5.1.2 Redis数据结构的特殊属性</h4><ul>
<li>Redis关心将它们存储在磁盘上， 即使它们总是被提供并修改到内存服务器内存中。这意味着Redis速度很快，但这也是非易失性的</li>
<li>数据结构的实现强调内存效率，因此与使用高级变成语言建模的相同数据结构相比，Redis内部的数据结构可能会使用更少的内存</li>
<li>Redis提供了许多在数据库中很容易找到的功能，如复制，可调节的持久性，群集，高可用性。</li>
</ul>
<h3 id="5-2-Redis的应用场景"><a href="#5-2-Redis的应用场景" class="headerlink" title="5.2 Redis的应用场景"></a>5.2 Redis的应用场景</h3><h3 id="5-3-Redis的数据结构"><a href="#5-3-Redis的数据结构" class="headerlink" title="5.3 Redis的数据结构"></a>5.3 Redis的数据结构</h3><p><img src="https://upload-images.jianshu.io/upload_images/6751690-0dbb4c73b2761208.png?imageMogr2/auto-orient/" alt="img"></p>
<h3 id="5-4-Redis代替Session保存用户状态"><a href="#5-4-Redis代替Session保存用户状态" class="headerlink" title="5.4 Redis代替Session保存用户状态"></a>5.4 Redis代替Session保存用户状态</h3><h2 id="6-PageHelper"><a href="#6-PageHelper" class="headerlink" title="6. PageHelper"></a>6. PageHelper</h2><p>分页！</p>
<h5 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h5><p>注意：SpringBoot中要添加SpringBoot的starter，不然不能用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="添加配置"><a href="#添加配置" class="headerlink" title="添加配置"></a>添加配置</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pagehelper:</span></span><br><span class="line">  <span class="comment">#自动检测当前的数据库链接，自动选择合适的分页方式。可以指定使用的方言</span></span><br><span class="line"><span class="attr">  helperDialect:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="comment">#分页合理化参数，默认值为false，当设置为true时，pageNum&lt;=0时会查询第一页，pageNum&gt;pages总数时，会查询最后一页。</span></span><br><span class="line"><span class="attr">  reasonable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment">#支持通过Mapper接口参数来传递分页参数，默认值false，分页插件会从查询方法的参数值中，自动根据params配置的字段中取值，查找到合适的值就自动分页</span></span><br><span class="line"><span class="attr">  supportMethodsArguments:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment">#为了支持startPage(Object params)，增加了该参数来配置参数映射</span></span><br><span class="line">  <span class="comment">#用于从对象中根据属性名取值，可以配置 pageNum,pageSize,count,pageSizeZero,reasonable，</span></span><br><span class="line">  <span class="comment">#不配置映射时用默认值， 默认值为pageNum=pageNum;pageSize=pageSize;count=countSql;reasonable=reasonable;pageSizeZero=pageSizeZero。</span></span><br><span class="line"><span class="attr">  params:</span> <span class="string">count=countSql</span></span><br></pre></td></tr></table></figure>

<h5 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PageInfo&lt;UserInfo&gt; <span class="title">selectAll</span><span class="params">(Integer page, Integer size)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//开启分页查询，写在查询语句上方</span></span><br><span class="line">    <span class="comment">//只有紧跟在PageHelper.startPage方法后的第一个Mybatis的查询（Select）方法会被分页。</span></span><br><span class="line">    PageHelper.startPage(page, size);</span><br><span class="line">    List&lt;UserInfo&gt; userInfoList = userInfoMapper.selectAll();</span><br><span class="line">    PageInfo&lt;UserInfo&gt; pageInfo = <span class="keyword">new</span> PageInfo&lt;&gt;(userInfoList);</span><br><span class="line">    <span class="keyword">return</span> pageInfo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-单点登录"><a href="#7-单点登录" class="headerlink" title="7. 单点登录"></a>7. 单点登录</h2><p>cookie的安全性</p>
<p>跨域读取cookie</p>
<h2 id="8-Eureka"><a href="#8-Eureka" class="headerlink" title="8. Eureka"></a>8. Eureka</h2><h3 id="8-1-高可用注册中心"><a href="#8-1-高可用注册中心" class="headerlink" title="8.1 高可用注册中心"></a>8.1 高可用注册中心</h3><ol>
<li>所有节点即是服务的提供方，也是服务的消费方</li>
<li>将自己作为服务向其他服务中心注册自己，以实现服务清单的互相同步</li>
</ol>
<h3 id="8-2-搭建步骤"><a href="#8-2-搭建步骤" class="headerlink" title="8.2 搭建步骤"></a>8.2 搭建步骤</h3><h5 id="EnableEurekaServer声明注册中心"><a href="#EnableEurekaServer声明注册中心" class="headerlink" title="@EnableEurekaServer声明注册中心"></a><code>@EnableEurekaServer</code>声明注册中心</h5><h5 id="添加配置-1"><a href="#添加配置-1" class="headerlink" title="添加配置"></a>添加配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># server (eureka 默认端口为：8761)</span><br><span class="line">server.port=8761</span><br><span class="line"># 服务名</span><br><span class="line">spring.application.name=spring-cloud-server</span><br><span class="line"># 是否注册到eureka（eureka本身是不需要再注册到自己的）</span><br><span class="line">eureka.client.register-with-eureka=false</span><br><span class="line"># 是否从eureka获取注册信息</span><br><span class="line">eureka.client.fetch-registry=false</span><br><span class="line"># eureka服务器的地址（注意：地址最后面的 /eureka/ 这个是固定值）</span><br><span class="line">eureka.client.serviceUrl.defaultZone=http://localhost:$&#123;server.port&#125;/eureka/</span><br><span class="line">#服务失效时间，Eureka多长时间没收到服务的renew操作，就剔除该服务，默认90秒</span><br><span class="line">eureka.instance.leaseExpirationDurationInSeconds=15</span><br><span class="line">#eureka server清理无效节点的时间间隔，默认60000毫秒，即60秒</span><br><span class="line">eureka.server.evictionIntervalTimerInMs=20000</span><br><span class="line"># 自我保护模式（缺省为打开）</span><br><span class="line">eureka.server.enable-self-preservation: true</span><br><span class="line"># 续期时间，即扫描失效服务的间隔时间（缺省为60*1000ms）       </span><br><span class="line">eureka.server.eviction-interval-timer-in-ms: 5000</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>1.根据切面<code>AfterReturning</code>可以得到返回值，来为操作记录添加状态或者根据状态判断是否保存</p>
<p>2.少用异常，给前端统一的状态吗和错误信息</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/24/Spring/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PPCoder">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/author.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/24/Spring/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-24T22:44:20+08:00">
                2019-09-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><h2 id="IOC"><a href="#IOC" class="headerlink" title="IOC"></a>IOC</h2><p>构造器注入（实现了松耦合）：在构造的时候把任务作为构造器参数注入</p>
<p>装配：创建应用组件之间协作的行为</p>
<h2 id="bean"><a href="#bean" class="headerlink" title="bean"></a>bean</h2><h3 id="自动化装配"><a href="#自动化装配" class="headerlink" title="自动化装配"></a>自动化装配</h3><blockquote>
<ul>
<li>组件扫描(Component scanning)</li>
<li>自动装配(Autowiring)</li>
</ul>
</blockquote>
<h4 id="组件扫描"><a href="#组件扫描" class="headerlink" title="组件扫描"></a>组件扫描</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span><span class="comment">//定义组件</span></span><br><span class="line"><span class="meta">@ComponentScan</span><span class="comment">//开启扫描</span></span><br><span class="line"><span class="meta">@Configuration</span><span class="comment">//定义配置文件,默认当前包内</span></span><br><span class="line"></span><br><span class="line">componentScan(basePackages=&#123;<span class="string">"soundsystem"</span>,<span class="string">"knight"</span>&#125;)<span class="comment">//多个包</span></span><br><span class="line">componentScan(basePackageClasses=&#123;CDPlayer.class,DVDPlayer.class&#125;)<span class="comment">//指定一个或多个类和接口</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//启用扫描</span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"main.example.soundsystem"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="自动装配"><a href="#自动装配" class="headerlink" title="自动装配"></a>自动装配</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* autowired注解会尝试满足方法参数上所声明的依赖</span></span><br><span class="line"><span class="comment">* 如果只有一个bean匹配依赖需求，那么这个bean会被装配进来</span></span><br><span class="line"><span class="comment">* 如果没有匹配的bean，那么在应用上下文创建的时候，spring会抛出异常</span></span><br><span class="line"><span class="comment">* Autowired(required=false)不强制进行封装的话，最好进行null检查，防止nullPointerException</span></span><br><span class="line"><span class="comment">* 如果有多个bean满足依赖关系，spring会抛出异常，表明没有明确指定要选择的bean</span></span><br><span class="line"><span class="comment">* inject和autowired在大多数场景下没有区别，inject是java依赖注入规范，autowired是spring特有的</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CDPlayer</span><span class="params">(CompactDisc cd)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.cd = cd;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="java装配-显示装配"><a href="#java装配-显示装配" class="headerlink" title="java装配(显示装配)"></a>java装配(显示装配)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span>(name=<span class="string">"Pepper"</span>)<span class="comment">//默认id=sgtPeppers</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CompactDisc <span class="title">sgtPeppers</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> SgtPeppers();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> cdPlayer <span class="title">cdPlayer</span><span class="params">(CompactDisc com)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> CDPlyaer(com);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="XML装配"><a href="#XML装配" class="headerlink" title="XML装配"></a>XML装配</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"compactDisc"</span> <span class="attr">class</span>=<span class="string">"main.example.soundsystem.SqtPeppers"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h2><blockquote>
<p>面向切面编程往往被定义为<strong>促使软件系统实现关注点的分离</strong>一项技 术。系统由许多不同的组件组成，每一个组件各负责一块特定功能。 除了实现自身核心的功能之外，这些组件还经常承担着额外的职责。 诸如日志、事务管理和安全这样的系统服务经常融入到自身具有核心 业务逻辑的组件中去，这些系统服务通常被称为横切关注点，因为它 们会跨越系统的多个组件。</p>
</blockquote>
<p>AOP（面向切面编程），切面，即功能组件。</p>
<blockquote>
<p>实现系统关注点功能的代码将会重复出现在多个组件中。这意味 着如果你要改变这些关注点的逻辑，必须修改各个模块中的相关 实现。即使你把这些关注点抽象为一个独立的模块，其他模块只 是调用它的方法，但方法的调用还是会重复出现在各个模块中。 组件会因为那些与自身核心业务无关的代码而变得混乱。一个向 地址簿增加地址条目的方法应该只关注如何添加地址，而不应该 关注它是不是安全的或者是否需要支持事务。</p>
</blockquote>
<p>解决的问题：1.实现系统关注点的代码会重复出现在多个组件中。2.组件需要关注与自身核心业务无关的代码。</p>
<blockquote>
<p>AOP能够使这些服务模块化，并以声明的方式将它们应用到它们需要 影响的组件中去。所造成的结果就是这些组件会具有更高的内聚性并 且会更加关注自身的业务，完全不需要了解涉及系统服务所带来复杂 性。</p>
</blockquote>
<p><strong>Spring在运行时通知对象：</strong></p>
<p>在加载所有bean的时候，Spring才会创建被代理的对象</p>
<p><strong>Spring只支持方法级别的连接点：</strong></p>
<p>Spring缺少对字段连接点的支持，无法让我们创建细粒度的而通知，也不支持构造器连接点</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//xml形式</span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span>&gt;</span>//切面要引用bean</span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:before</span>&gt;</span>//后置通知</span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:after</span>&gt;</span>//前置通知</span><br><span class="line">    	<span class="tag">&lt;<span class="name">pointcut-ref</span>&gt;</span>//引用切入点</span><br><span class="line">	<span class="tag">&lt;<span class="name">pointcut</span>&gt;</span>//切入点</span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>//定义切入点</span><br><span class="line">        <span class="tag">&lt;<span class="name">expression</span>&gt;</span>//选择所应用的通知</span><br></pre></td></tr></table></figure>

<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><ul>
<li>通知：描述切面的工作，也定义了执行工作的时间</li>
<li>连接点：应用执行过程中能够插入切面的一个点，可以是一个方法，异常，甚至修改字段。</li>
<li>切点：通知被应用的具体位置，即哪些连接点会得到通知</li>
<li>切面：切面是通知和切点的结合</li>
<li>引入：无需修改现有的类的情况下，让他们具有新的行为和状态</li>
<li>织入：切面应用到目标对象并创建新的代理对象的过程</li>
</ul>
<h3 id="通知类型"><a href="#通知类型" class="headerlink" title="通知类型"></a>通知类型</h3><ul>
<li><p>Before：前置通知。在目标方调用前调用通知功能</p>
</li>
<li><p>After：后置通知。完成之后调用通知，此时不会关心方法的输出是什么</p>
</li>
<li><p>After-returning：返回通知。成功执行之后调用</p>
</li>
<li><p>After-throwing：异常通知。抛出异常之后调用</p>
</li>
<li><p>Aroud：环绕通知。调用之前和调用之后执行自定义行为</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Audience</span></span>&#123;</span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(** concert.Performance.perform(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">performance</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Around</span>(<span class="string">"performance()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">watchPerformance</span><span class="params">(ProceedingJoinPoint jp)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            print(<span class="string">"1"</span>);<span class="comment">//前置通知</span></span><br><span class="line">            jp.proceed();<span class="comment">//运行方法</span></span><br><span class="line">            print(<span class="string">"2"</span>);<span class="comment">//后置通知</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Throwabl e)&#123;</span><br><span class="line">            print(<span class="string">"3"</span>);<span class="comment">//异常通知</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="AspectJ注解"><a href="#AspectJ注解" class="headerlink" title="AspectJ注解"></a>AspectJ注解</h3><p>@DeclareParents：将接口引入方法中</p>
<ul>
<li>value：指定引入bean的类型</li>
<li>defaultImpl：为引入功能提供实现的类</li>
</ul>
<p>@Pointcut：定义切入点</p>
<ul>
<li>returning：用以定义通知中与此同名的形参，用于访问目标方法的返回值</li>
</ul>
<h2 id="Spring容器"><a href="#Spring容器" class="headerlink" title="Spring容器"></a>Spring容器</h2><blockquote>
<p>beanFactory：提供基本的DI支持</p>
<p>ApplicationContext：基于beanFactory构建，提供应用框架级别的服务。例如从属性文本解析文本信息以及发布应用事件给感兴趣的事件监听者。</p>
</blockquote>
<h3 id="应用上下文"><a href="#应用上下文" class="headerlink" title="应用上下文"></a>应用上下文</h3><ul>
<li>AnnotationConfigApplicationContext：从一个或多个 基于Java的配置类中加载<strong>Spring</strong>应用上下文。<br><code>ApplicationContext context = new AnnotationConfigApplicationContext(main.example.knights.KnightConfig.class);</code></li>
<li>AnnotationConfigWebApplicationContext：从一个或 多个基于Java的配置类中加载<strong>Spring Web</strong>应用上下文。 </li>
<li>ClassPathXmlApplicationContext：从<strong>类路径</strong>下的一个或 多个XML配置文件中加载上下文定义，把应用上下文的定义文件 作为类资源。<br><code>ApplicationContext context = new ClassPathXmlApplicationContext(&quot;knight.xml&quot;);</code></li>
<li>FileSystemXmlapplicationcontext：从<strong>文件系统</strong>下的一 个或多个XML配置文件中加载上下文定义。<br><code>ApplicationContext context = new FileSystemXmlapplicationcontext(&quot;C:/knight.xml&quot;);</code></li>
<li>XmlWebApplicationContext：从<strong>Web应用</strong>下的一个或多个 XML配置文件中加载上下文定义。</li>
</ul>
<h3 id="bean生命周期"><a href="#bean生命周期" class="headerlink" title="bean生命周期"></a>bean生命周期</h3><blockquote>
<p>1．Spring对bean进行实例化；</p>
<p>2．Spring将值和bean的引用注入到bean对应的属性中；</p>
<p>3．如果bean实现了BeanNameAware接口，Spring将bean的ID传递给 setBean-Name()方法；</p>
<p>4．如果bean实现了BeanFactoryAware接口，Spring将调 用setBeanFactory()方法，将BeanFactory容器实例传入；</p>
<p>5．如果bean实现了ApplicationContextAware接口，Spring将调 用setApplicationContext()方法，将bean所在的应用上下文的 引用传入进来；</p>
<p>6．如果bean实现了BeanPostProcessor接口，Spring将调用它们 的post-ProcessBeforeInitialization()方法；</p>
<p>7．如果bean实现了InitializingBean接口，Spring将调用它们的 after-PropertiesSet()方法。类似地，如果bean使用initmethod声明了初始化方法，该方法也会被调用；</p>
<p>8．如果bean实现了BeanPostProcessor接口，Spring将调用它们 的post-ProcessAfterInitialization()方法；</p>
<p>9．此时，bean已经准备就绪，可以被应用程序使用了，它们将一直 驻留在应用上下文中，直到该应用上下文被销毁；</p>
<p>10．如果bean实现了DisposableBean接口，Spring将调用它的 destroy()接口方法。同样，如果bean使用destroy-method声明 了销毁方法，该方法也会被调用。</p>
</blockquote>
<h2 id="Spring生态"><a href="#Spring生态" class="headerlink" title="Spring生态"></a>Spring生态</h2><h2 id="Spring-MVC"><a href="#Spring-MVC" class="headerlink" title="Spring MVC"></a>Spring MVC</h2><h3 id="请求处理追踪"><a href="#请求处理追踪" class="headerlink" title="请求处理追踪"></a>请求处理追踪</h3><p>DispatcherServlet（前端控制器）：将请求发送给springmvc控制器 </p>
<p>–&gt;handler mapping(处理器映射)：查询一个或多个处理器映射来确定下一站在哪里（根据请求携带的URL信息来进行决策）</p>
<p>–&gt;Controller：处理请求的spring组件（尽量将业务委托给一个或者多个服务对象进行处理），返回一个逻辑名称</p>
<p>–&gt;view resolver（视图解析器）：匹配特定的视图实现</p>
<p>–&gt;model：以用户友好的方式进行格式化</p>
<p>–&gt;view：使用模型数据渲染输出</p>
<h4 id="配置DispatcherServlet"><a href="#配置DispatcherServlet" class="headerlink" title="配置DispatcherServlet"></a>配置DispatcherServlet</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpitterWebAppInitializer</span> <span class="keyword">extends</span> <span class="title">AbstractAnnotationConfigDispatcherServletInitializer</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将一个或多个路径映射到DispatcherServlet上</span></span><br><span class="line">    <span class="keyword">public</span> String[] getServletMapping()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String[] (<span class="string">"/"</span>);<span class="comment">//应用默认Servlet</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//配置ContextLoaderListener创建的应用上下文中的bean：驱动应用后端的中间层和数据层文件</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Class&lt;?&gt;[](RootConfig.class);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//DispaerServlet加载应用上下文时，使用定义的WebConfig配置类中bean：Web组件的bean（控制器，视图解析器以及处理器映射）</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Class&lt;?&gt;[](WebConfig.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="启用SpringMVC"><a href="#启用SpringMVC" class="headerlink" title="启用SpringMVC"></a>启用SpringMVC</h4><h5 id="WebConfig-class"><a href="#WebConfig-class" class="headerlink" title="WebConfig.class"></a>WebConfig.class</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"spitter.web"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//配置jsp视图解析器</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ViewResolver <span class="title">viewResolver</span><span class="params">()</span></span>&#123;</span><br><span class="line">        InternalResourceViewResolver resolver = </span><br><span class="line">            <span class="keyword">new</span> InternalResourceViewResolver();</span><br><span class="line">        resolver.setPrefix(<span class="string">"/WEB_INF/views"</span>);</span><br><span class="line">        resolver.setSuffix(<span class="string">".jsp"</span>);</span><br><span class="line">        resolver.setExposeContextBeansAsAttributes(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> resolver;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//配置静态资源的处理</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">configureDefaultServletHandling</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        DefaultServletHandlerConfigurer)</span></span>&#123;</span><br><span class="line">        configurer.enable();<span class="comment">//对静态资源的请求转发到Servlet容器默认的Servlet上，而不是使用DispaterSerlvet本身来处理此类请求</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="RootConfig-class"><a href="#RootConfig-class" class="headerlink" title="RootConfig.class"></a>RootConfig.class</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages=&#123;<span class="string">"spitter"</span>&#125;,</span><br><span class="line">	excludeFilters=&#123;</span><br><span class="line">        <span class="meta">@Filter</span>(type=FilterType.ANNOTATION,value=EnableWebMvc.class)</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RootConfig</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=&#123;<span class="string">"/"</span>,<span class="string">"homepage"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HomeController</span></span>&#123;</span><br><span class="line">	<span class="meta">@RequestMapping</span>(method=GET)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"home"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//显示声明模型</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">contacts1</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line">	model.addAttribute(<span class="string">"contactsList"</span>,</span><br><span class="line">		contactRepository.findContacts(Long.MAX_VALUE,<span class="number">20</span>));</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"contacts"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//非Spring类型</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">contacts2</span><span class="params">(Map map)</span></span>&#123;</span><br><span class="line">    model.addAttribute(<span class="string">"contactsList"</span>,</span><br><span class="line">		contactRepository.findContacts(Long.MAX_VALUE,<span class="number">20</span>));</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"contacts"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//返回对象和集合时，这个值会被放到模型</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Contact&gt;contacts3()&#123;</span><br><span class="line">    <span class="keyword">return</span> contactRepository.findContacts(Long.MAX_VALUE,<span class="number">20</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//模型中会存储一个contacts列表，key为contactsList，然后这个列表会发送到名为contacts的视图中。</span></span><br><span class="line"><span class="comment">//模型数据会作为请求属性放到请求request之中</span></span><br></pre></td></tr></table></figure>

<h5 id="接受请求输入"><a href="#接受请求输入" class="headerlink" title="接受请求输入"></a>接受请求输入</h5><p>@PathVariable：获取url中参数的格式：/hello/{id}/{name}</p>
<p>@RequestParam：获取url参数格式：/hello？id=10</p>
<ol>
<li>当URL指向的是某一具体业务资源，例如博客，用户时，使用@PathVariable</li>
<li>当URL需要对资源或者资源列表进行过滤，删选时，用@RequestParam</li>
</ol>
<p>@RequestBody：获取一个json格式的java对象</p>
<p>@CookieValue：获取Cookie中的值</p>
<ul>
<li><p>查询参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String MAX_LONG_AS_STRING = </span><br><span class="line">    Long.toString(Long.MAX_VALUE);</span><br><span class="line"><span class="comment">//分页，有参和无参情况同时考虑</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(method=RequestMethod.GET)</span><br><span class="line"><span class="keyword">public</span> List&lt;Contact&gt;contacts(</span><br><span class="line">    <span class="meta">@RequestParam</span>(value=<span class="string">"max"</span>,</span><br><span class="line">                 defaultValue=MAX_LONG_AS_STRING) <span class="keyword">long</span> max,</span><br><span class="line">    <span class="meta">@RequestParam</span>(value=<span class="string">"count"</span>,</span><br><span class="line">                 defaultValue=<span class="string">"20"</span>) <span class="keyword">int</span> count)&#123;</span><br><span class="line">    <span class="keyword">return</span> contactRepository.findContacts(max,count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>表单参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//重定向保证了表单不会重复提交</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/register"</span>,method=POST)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">processRegistration</span><span class="params">(Spitter spitter)</span></span>&#123;</span><br><span class="line">    <span class="comment">//保存spitter</span></span><br><span class="line">    spitterRepository.save(spitter);</span><br><span class="line">    <span class="comment">//重定向到基本信息页，forward则跳转到指定url</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"redirect:/spitter/"</span> + spitter.getUsername();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>路径变量：@PathVariable：获取url中数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询参数</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"show"</span>,method=RequestMethod.GET)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">showSpittle</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    @RequestParam(<span class="string">"spittle_id"</span>)</span><span class="keyword">long</span> spittleId,</span></span><br><span class="line"><span class="function">    Model model)</span>&#123;</span><br><span class="line">    mode.addAttribute(spittleRepository.findOne(spittleId));</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"spittle"</span>;</span><br><span class="line">&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//路径变量</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/&#123;spittleId&#125;"</span>,method=RequestMethod.GET)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">spittle</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    //跳过占位符传递到spittleId参数中</span></span></span><br><span class="line"><span class="function"><span class="params">    @PathVariable(<span class="string">"spittleId"</span>)</span><span class="keyword">long</span> spittleId,</span></span><br><span class="line"><span class="function">    Model model)</span>&#123;  </span><br><span class="line">    mode.addAttribute(spittleRepository.findOne(spittleId));<span class="comment">//默认key是类型名</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"spittle"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="跨重定向请求传递数据"><a href="#跨重定向请求传递数据" class="headerlink" title="跨重定向请求传递数据"></a>跨重定向请求传递数据</h5><p>重定向会结束原来的请求，发起一个新的get请求，原始请求中所带有的模型数据就消亡了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//存放普通数据</span></span><br><span class="line">model.addAttribute(<span class="string">"id"</span>,id);</span><br><span class="line"><span class="keyword">return</span> <span class="string">"redirect：/index/&#123;username&#125;"</span>;</span><br><span class="line"><span class="comment">//存放对象</span></span><br><span class="line">RedirectAttribute model;</span><br><span class="line">model.addFlashAttribute(<span class="string">"object"</span>,object);</span><br></pre></td></tr></table></figure>

<h3 id="REST-API"><a href="#REST-API" class="headerlink" title="REST API"></a>REST API</h3><blockquote>
<p>REST：将资源的状态以最适合客户端或服务段的形式转移</p>
<p>‘以信息为中心的表述性状态转移，关注要处理的数据，面向资源’</p>
<ul>
<li>表述性：可以用各种形式来进行表述</li>
<li>状态：更关注资源的状态，而不是资源采取的行为</li>
<li>转移：涉及到转移资源数据，以某种表述性形式转移</li>
</ul>
<p>SOAP：关注行为和处理</p>
</blockquote>
<h5 id="将资源的java表述形式转换为发送给客户端的表述形式"><a href="#将资源的java表述形式转换为发送给客户端的表述形式" class="headerlink" title="将资源的java表述形式转换为发送给客户端的表述形式"></a>将资源的java表述形式转换为发送给客户端的表述形式</h5><ul>
<li><p>内容协商：选择一个试图，将模型渲染为呈现给客户端的表述形式</p>
</li>
<li><p>消息转换器：通过一个消息转换器将控制器所返回的对象转换为呈现给客户端的表现形式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过查找请求中Content-Type头部信息，寻找对应的转换器</span></span><br><span class="line"><span class="meta">@ResponseBody</span><span class="comment">//在把数据发送到客户端的时候，要使用某一个消息器</span></span><br><span class="line"><span class="meta">@RequestBody</span><span class="comment">//查找一个消息转换器，将来自客户端的资源表述转换为对象</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(consumes=”application/json“)<span class="comment">//只处理头部信息为consumes的请求，如果不满足，会由其他方法来处理请求</span></span><br><span class="line"><span class="meta">@RestController</span><span class="comment">//类级别的ResponseBody</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="发送错误信息到客户端"><a href="#发送错误信息到客户端" class="headerlink" title="发送错误信息到客户端"></a>发送错误信息到客户端</h5><ul>
<li><p>@ResponseStatus：指定状态码</p>
</li>
<li><p>@ResponseEntity：控制器方法返回此类型对象，包含更多相应元数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ResponseEntity包含ResponseBody的语义</span></span><br><span class="line"><span class="comment">//ResponseEntity封装了响应和状态码</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Spittle&gt;spittleById(<span class="meta">@PathVariable</span> <span class="keyword">long</span> id)&#123;</span><br><span class="line">    Spittle spittle = spittleRepository.findOne(id);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    HttpStatus status = spittle != null ?</span></span><br><span class="line"><span class="comment">        HttpStatus.OK : HttpStatus.NOT_FOUND;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    <span class="keyword">if</span>(spittle == <span class="keyword">null</span>)&#123;</span><br><span class="line">        Error error = <span class="keyword">new</span> Error(<span class="number">4</span>,<span class="string">"Spittle"</span>+id+<span class="string">"not found"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;Error&gt;(error,HttpStatus.NOT_FOUND);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;Spittle&gt;(spittle,status);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>异常处理器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler</span>(SpittleNotFoundException.class)</span><br><span class="line"><span class="meta">@ResponseStatus</span>(HttpStatus.NOT_FOUND)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Error <span class="title">spittleNotFound</span><span class="params">(SpittleNotFoundException e)</span></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> spittleId = e.getSpittleId();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Error(<span class="number">4</span>,<span class="string">"spittle"</span>+id+<span class="string">"not found"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h5 id="在相应中设置头部信息"><a href="#在相应中设置头部信息" class="headerlink" title="在相应中设置头部信息"></a>在相应中设置头部信息</h5><p>将返回的错误200处理成201</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//构建ResponseEntity</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(method=RequestMethod.POST</span><br><span class="line">consumes=<span class="string">"application/json"</span>)</span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Spittle&gt;saveSpittle(</span><br><span class="line"><span class="meta">@RequestBody</span> Spittle spittle)&#123;</span><br><span class="line">    Spittle spittle = spittleRepository.save(spittle);</span><br><span class="line">    HttpHeaders header = <span class="keyword">new</span> HttpHeaders();</span><br><span class="line">    <span class="comment">/*------URI------*/</span></span><br><span class="line">    URI locationUri = URI.create(</span><br><span class="line">    <span class="string">"http://localhost:8080/spittr/spittles/*"</span>+spittle.getId());</span><br><span class="line">    header.setLocation(locationUri);</span><br><span class="line">    </span><br><span class="line">    ResponseEntity&lt;Spittle&gt;responseEntity = </span><br><span class="line">        <span class="keyword">new</span> ResponseEntity&lt;Spittle&gt;(</span><br><span class="line">    spittle,headers,HttpStatus.CREATE);</span><br><span class="line">    <span class="keyword">return</span> responseEntity;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//利用UriComponentsBuilder来构建LocationURI</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(method=RequestMethod.POST</span><br><span class="line">consumes=<span class="string">"application/json"</span>)</span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Spittle&gt;saveSpittle(</span><br><span class="line"><span class="meta">@RequestBody</span> Spittle spittle,UriComponentsBuilder ucb)&#123;</span><br><span class="line">    Spittle spittle = spittleRepository.save(spittle);</span><br><span class="line">    HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();</span><br><span class="line">    <span class="comment">/*-------UriComponentsBuilder---------*/</span></span><br><span class="line">    URI locationUri = </span><br><span class="line">        ucb.path(<span class="string">"/spittles/*"</span>)<span class="comment">//处理的基础路径</span></span><br><span class="line">        .path(String.valueOf(spittle.getId()))<span class="comment">//使用已保存的id</span></span><br><span class="line">        .build()<span class="comment">//构建UriComponents</span></span><br><span class="line">        .toUri();<span class="comment">//得到新创建的Spittle的URI</span></span><br><span class="line">    header.setLocation(locationUri);</span><br><span class="line">    </span><br><span class="line">    ResponseEntity&lt;Spittle&gt;responseEntity = </span><br><span class="line">        <span class="keyword">new</span> ResponseEneity&lt;Spittle&gt;(</span><br><span class="line">    spittle,headers,HttpStatus.CREATED);</span><br><span class="line">    <span class="keyword">return</span> responseEntity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="创建REST客户端"><a href="#创建REST客户端" class="headerlink" title="创建REST客户端"></a>创建REST客户端</h4><h3 id="Entity实体类"><a href="#Entity实体类" class="headerlink" title="Entity实体类"></a>Entity实体类</h3><p>@NotEmpty：String，Colection，Map，数组，是不能为null或者长度为0的(调用了String，Colection，Map的isEmpty()方法)</p>
<p>@NotBlank：纯空格的String是不符合规则的</p>
<p>@NotNull：不能为null</p>
<p>@asserttrue：验证boolean对象是否为true</p>
<p>@assertfalse：验证boolean对象是否为false</p>
<p>@min：验证number和string对象是否大等于指定的值</p>
<p>@max：验证number和string对象是否小等于指定的值</p>
<p>@length：验证string的长度</p>
<p>@decimalmin：验证number和string对象是否大等于指定的值，小数存在精度</p>
<p>@decimalmax：验证number和string对象是否小等于指定的值，小数存在精度</p>
<p>@size：验证对象（array,collection,map,string）长度是否在给定的范围之内</p>
<p>@digits：验证number和string的构成是否合法</p>
<p>@past：验证date和calendar对象是否在当前时间之前</p>
<p>@future：验证date和calendar对象是否在当前时间之后</p>
<p>@pattern：验证String对象是否符合正则表达式的规则</p>
<p>@Email：验证邮箱</p>
<h3 id="DAO数据访问层"><a href="#DAO数据访问层" class="headerlink" title="DAO数据访问层"></a>DAO数据访问层</h3><h4 id="整合mybatis"><a href="#整合mybatis" class="headerlink" title="整合mybatis"></a>整合mybatis</h4><p>开启扫描</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan</span>(<span class="string">"com.neo.mapper"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(Application.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Dao层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Select</span>(<span class="string">"SELECT * FROM users"</span>)</span><br><span class="line">	<span class="meta">@Results</span>(&#123;</span><br><span class="line"><span class="meta">@Result</span>(property = <span class="string">"userSex"</span>,  column = <span class="string">"user_sex"</span>, javaType = UserSexEnum.class),</span><br><span class="line"><span class="meta">@Result</span>(property = <span class="string">"nickName"</span>, column = <span class="string">"nick_name"</span>)&#125;)</span><br><span class="line">	<span class="function">List&lt;UserEntity&gt; <span class="title">getAll</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Select</span>(<span class="string">"SELECT * FROM users WHERE id = #&#123;id&#125;"</span>)</span><br><span class="line">	<span class="meta">@Results</span>(&#123;</span><br><span class="line">		<span class="meta">@Result</span>(property = <span class="string">"userSex"</span>,  column = <span class="string">"user_sex"</span>, javaType = UserSexEnum.class),</span><br><span class="line">		<span class="meta">@Result</span>(property = <span class="string">"nickName"</span>, column = <span class="string">"nick_name"</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="function">UserEntity <span class="title">getOne</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Insert</span>(<span class="string">"INSERT INTO users(userName,passWord,user_sex) VALUES(#&#123;userName&#125;, #&#123;passWord&#125;, #&#123;userSex&#125;)"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(UserEntity user)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Update</span>(<span class="string">"UPDATE users SET userName=#&#123;userName&#125;,nick_name=#&#123;nickName&#125; WHERE id =#&#123;id&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(UserEntity user)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Delete</span>(<span class="string">"DELETE FROM users WHERE id =#&#123;id&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">(Long id)</span></span>;</span><br></pre></td></tr></table></figure>

<h4 id="Bind标签"><a href="#Bind标签" class="headerlink" title="Bind标签"></a>Bind标签</h4><p><bind>标签的两个属性都是必选的，name为绑定到上下文的变量名，value为OGNL表达式。</bind></p>
<h3 id="Service业务逻辑层"><a href="#Service业务逻辑层" class="headerlink" title="Service业务逻辑层"></a>Service业务逻辑层</h3><p>Service主要进行业务处理，controller主要进行请求转发</p>
<h2 id="Spring-Security"><a href="#Spring-Security" class="headerlink" title="Spring Security"></a>Spring Security</h2><h3 id="Basic安全认证"><a href="#Basic安全认证" class="headerlink" title="Basic安全认证"></a>Basic安全认证</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  security:</span></span><br><span class="line"><span class="attr">    user:</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">user</span></span><br><span class="line"><span class="attr">      password:</span> <span class="string">security</span></span><br><span class="line"><span class="attr">      roles:</span> <span class="string">USER</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Spring Security配置类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity</span>(prePostEnabled = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//配置如何通过拦截器保护请求</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//所有的请求都需要经过HTTPBasic认证</span></span><br><span class="line">        http.authorizeRequests().anyRequest().authenticated().and().httpBasic();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置user-detail服务</span></span><br><span class="line"><span class="comment">//    @Override</span></span><br><span class="line"><span class="comment">//    protected void configure(AuthenticationManagerBuilder auth) throws Exception &#123;</span></span><br><span class="line"><span class="comment">//        auth.userDetailsService(this.userDetailsService).passwordEncoder(this.passwordEncoder());</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置SpringSecurity的Filter链</span></span><br><span class="line">    <span class="comment">//@Override</span></span><br><span class="line">    <span class="comment">//protected void configure(WebSecurity);</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PasswordEncoder <span class="title">passwordEncoder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        明文编码器：不做任何操作的密码编辑器，用于明文测试</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">return</span> NoOpPasswordEncoder.getInstance();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    @Autowired</span></span><br><span class="line"><span class="comment">//    private CustomUserDetailsService userDetailsService;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Spring注解"><a href="#Spring注解" class="headerlink" title="Spring注解"></a>Spring注解</h2><p>@Autowired：注解，一般结合@ComponentScan注解，来自动注入一个Service或Dao级别的Bean</p>
<p>@Resource：默认自动装配，当找不到匹配的名称或者id时才按类型进行装配</p>
<blockquote>
<p>Resource是java自己的注解，name属性解析为bean的名字，而type属性解析为bean的类型。如果匹配到多个bean，则必须指定一个name或用@Qualifier确定合适的bean</p>
<p>Autowired是spring的注解，只根据type进行注入，不会去匹配name。如果匹配到多个bean，可以用@Qualifier也可以用@primary指定默认bean</p>
</blockquote>
<p>@Configuration：类级别，定义配置类，会被AnnotationConfigApplicationContext或AnnotationConfigWebApplicationContext类进行扫描，并用于构建bean定义，初始化Spring容器</p>
<p>@ConfigurationProperties 根据前缀分类映射到不同对象.</p>
<p>@Component类级别注解，用来标识一个组件，比如自定了一个filter，则需要此注解标识之后，Spring Boot才会正确识别。</p>
<p>@Value：可以在类里调用设置在<code>yml</code>里的变量<code>@Value(&quot;${xxx}&quot;)</code></p>
<p>@Bean：方法级别，产生一个Bean并交由容器管理。</p>
<p>@Repository：将DAO类声明为Bean，同时还能将所标注的类中抛出的数据访问异常封装为Spring的数据访问异常类型。</p>
<p>@<code>ResponseBody</code>：方法级别，返回结果直接写入<code>Http response body</code>中，通常用来返回<code>JSON</code>数据或者XML</p>
<h4 id="带参请求处理"><a href="#带参请求处理" class="headerlink" title="带参请求处理"></a>带参请求处理</h4><p><code>@RequestBody</code>：</p>
<blockquote>
<p>作用在形参列表上， 用于将前台发送过过来固定格式的数据(xml或者<code>json</code>)封装为对应的<code>javaBean</code>对象，封装时使用到的一个对象时系统默认配置的<code>httpMessageConverter</code>进行解析，然后封装到形参上</p>
</blockquote>
<ul>
<li><code>application/json</code>时候可用</li>
<li><code>form-data</code>，<code>x-www-form-urlencoded</code>时候不可用</li>
</ul>
<p><code>@RequestParam</code>：</p>
<ul>
<li><code>application/json</code>时候，<code>json</code>字符串部分不可用</li>
<li><code>url</code>中的？后面添加参数可用</li>
<li><code>form-data</code>，<code>x-www-form-urlencoded</code>时候可用，且参数可以没有顺序，但是要将Headers里的Content-Type删掉</li>
</ul>
<p>==没有指定参数接收方式，可以通过<code>HttpServletRequest</code>取到<code>form-data</code>，<code>x-www-form-urlencoded</code>中的值==</p>
<p><code>@PathVariable</code>：接受<code>@RequestMapping</code>传过来的URI中的id，并绑定在参数上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span> </span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/owners/&#123;a&#125;"</span>) </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RelativePathUriTemplateController</span> </span>&#123; </span><br><span class="line">  <span class="meta">@RequestMapping</span>(<span class="string">"/pets/&#123;b&#125;"</span>) </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findPet</span><span class="params">(@PathVariable(<span class="string">"a"</span>)</span> String a,@PathVariable String b, Model model) </span>&#123;     </span><br><span class="line">    <span class="comment">// implementation omitted </span></span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@RequestHeader</code>：处理request header部分的注解</p>
<p><code>@CookieValue</code>：将cookie里的id绑定到方法参数上</p>
<p>@Around：增强处理</p>
<p><code>@ExceptionHandler</code>：统一处理某一类异常</p>
<p><code>@ResponseStatus</code>：类或方法级别，将某种异常映射为<code>http</code>状态码</p>
<p>当方法被调用时，制定的code和reason会返回给前端，value时<code>http</code>状态码，reason时错误信息。</p>
<p><code>@ControllerAdvice</code>：异常集中处理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;  </span><br><span class="line">    <span class="comment">// 表示让Spring捕获到所有抛出的SQLException异常，并交由这个被注解的handleSQLException方法处理</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(SQLException.class)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// @ResponseStatus指定了code和reason写到response上，返回给前端  </span></span><br><span class="line">    <span class="meta">@ResponseStatus</span>(value=HttpStatus.INTERNAL_SERVER_ERROR,reason=”sql查询错误”)  </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*表示让Spring捕获到所有抛出的SQLException异常</span></span><br><span class="line"><span class="comment">     *交由这个被注解的handleSQLException方法处理</span></span><br><span class="line"><span class="comment">     *同时使用@ResponseStatus指定了code和reason写到response上</span></span><br><span class="line"><span class="comment">     *返回给前端。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ResponseBody</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ExceptionResponse <span class="title">handleSQLException</span><span class="params">(HttpServletRequest request, Exception ex)</span> </span>&#123;  </span><br><span class="line">        String message = ex.getMessage();  </span><br><span class="line">        <span class="keyword">return</span> ExceptionResponse.create(HttpStatus.INTERNAL_SERVER_ERROR.value(), message);  </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/24/SpringBoot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PPCoder">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/author.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/24/SpringBoot/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-24T22:44:20+08:00">
                2019-09-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h2><p>SpringBoot思想：约定大于配置</p>
<h3 id="什么是SpringBoot"><a href="#什么是SpringBoot" class="headerlink" title="什么是SpringBoot"></a>什么是SpringBoot</h3><blockquote>
<p>SpringBoot是一个框架，一种全新的编程规范，他的产生简化了框架的使用，所谓简化是指简化了Spring众多框架中所需的大量且繁琐的配置文件，所以 SpringBoot是一个服务于框架的框架，服务范围是简化配置文件。</p>
</blockquote>
<h3 id="SpringBoot和Spring的区别"><a href="#SpringBoot和Spring的区别" class="headerlink" title="SpringBoot和Spring的区别"></a>SpringBoot和Spring的区别</h3><ol>
<li>自动配置</li>
<li>使用注解</li>
<li>内置Tomcat，Jetty或Undertow</li>
</ol>
<h3 id="SpringBoot的starter模块"><a href="#SpringBoot的starter模块" class="headerlink" title="SpringBoot的starter模块"></a>SpringBoot的starter模块</h3><p><code>spring-boot-starter</code>：包括自动配置支持，日志和YAML</p>
<p><code>spring-boot-starter-web</code>：自动依赖<code>spring-boot-starter</code></p>
<p><code>spring-boot-starter-test</code>：测试模块，包括JUint，Hamcrest、Mockito。</p>
<p><code>spring-boot-starter-thymeleaf</code>：html模板</p>
<p><code>spring-boot-starter-data-jpa</code>:</p>
<p><code>spring-boot-starter-security</code>:</p>
<p><code>spring-boot-starter-actuator</code>：监控模块</p>
<h2 id="自动配置"><a href="#自动配置" class="headerlink" title="自动配置"></a>自动配置</h2><h3 id="自动配置的原理"><a href="#自动配置的原理" class="headerlink" title="自动配置的原理"></a>自动配置的原理</h3><h3 id="读取配置文件的方式"><a href="#读取配置文件的方式" class="headerlink" title="读取配置文件的方式"></a>读取配置文件的方式</h3><h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><p><code>@Controller</code>：类级别，控制器注解，返回ViewAndModel</p>
<p><code>@RestController</code>：类级别，控制器注解，返回json格式，包含@Controller和@ResponseBody</p>
<p><code>@Request Mapping</code>：方法级别，映射注解</p>
<p><code>@EnableAutoConfiguration</code>：类级别，根据添加的jar依赖猜测你想如何配置Spring</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(ElementType.TYPE)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*AutoConfigurationImportSelector</span></span><br><span class="line"><span class="comment"> *将所有符合条件的@Confident配置都加载到当前IoC容器</span></span><br><span class="line"><span class="comment"> *SpringFactoriesLoader.loadFactoryNames()</span></span><br><span class="line"><span class="comment"> *把</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Import</span>(AutoConfigurationImportSelector.class)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123;</span><br><span class="line">    String ENABLED_OVERRIDE_PROPERTY = <span class="string">"spring.boot.enableautoconfiguration"</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] exclude() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    String[] excludeName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@SpringBootApplication</code>：类级别，根据maven依赖的jar来自动猜测完成正确的spring的对应配置，只要引入了spring-boot-starter-web的依赖，默认会自动配置Spring MVC和tomcat容器<br>@Configuration类级别的注解，一般这个注解，我们用来标识main方法所在的类,完成元数据bean的初始化。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementType.TYPE&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span> <span class="comment">//应用了@Configuration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(</span><br><span class="line">    excludeFilters = &#123;<span class="meta">@Filter</span>(</span><br><span class="line">    type = FilterType.CUSTOM,</span><br><span class="line">    classes = &#123;TypeExcludeFilter.class&#125;</span><br><span class="line">), <span class="meta">@Filter</span>(</span><br><span class="line">    type = FilterType.CUSTOM,</span><br><span class="line">    classes = &#123;AutoConfigurationExcludeFilter.class&#125;</span><br><span class="line">)&#125;</span><br><span class="line">)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@ComponentScan：类级别，自动扫描加载所有的Spring组件包括Bean注入，一般用在main方法所在的类上 </p>
<p>@ImportResource：类级别，当我们必须使用一个xml的配置时，使用@ImportResource和@Configuration来标识这个文件资源的类。 </p>
<h2 id="WebJars"><a href="#WebJars" class="headerlink" title="WebJars"></a>WebJars</h2><blockquote>
<p>将客户端资源（js，css等前端资源）打包成Jar文件，以对资源进行统一依赖管理。WebJars的Jar包部署在Maven中央仓库上。</p>
</blockquote>
<h2 id="数据持久层"><a href="#数据持久层" class="headerlink" title="数据持久层"></a>数据持久层</h2><h3 id="集成Mybatis"><a href="#集成Mybatis" class="headerlink" title="集成Mybatis"></a>集成Mybatis</h3><h4 id="数据源配置"><a href="#数据源配置" class="headerlink" title="数据源配置"></a>数据源配置</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span> <span class="string">dev</span></span><br><span class="line">  <span class="comment"># 数据源配置</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="number">1234</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:mysql://127.0.0.1:3306/singlemessagedemo?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=UTC</span></span><br></pre></td></tr></table></figure>

<h4 id="扫描组件"><a href="#扫描组件" class="headerlink" title="扫描组件"></a>扫描组件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*springboot自动加载datasource配置</span></span><br><span class="line"><span class="comment"> *数据源会自动注入到sqlSessionFactory中</span></span><br><span class="line"><span class="comment"> *sqlSessionFactory会自动注入到Mapper中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mapper</span><span class="comment">//自动注入，在每个Mapper类上添加</span></span><br><span class="line"><span class="meta">@MapperScan</span>()<span class="comment">//扫描注入，在启动类中添加</span></span><br></pre></td></tr></table></figure>

<h4 id="开发Mapper"><a href="#开发Mapper" class="headerlink" title="开发Mapper"></a>开发Mapper</h4><p>@Select，@Insert，@Delete，@Update是增删查改的注解</p>
<p>@Result：修饰返回的结果集，映射实体类和数据库字段，property，column，javaType</p>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/24/MQ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PPCoder">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/author.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/24/MQ/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-24T22:44:20+08:00">
                2019-09-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="消息队列"><a href="#消息队列" class="headerlink" title="消息队列"></a>消息队列</h3><p>把需要的数据放到队列里（生产者），消费者去队列里消费</p>
<h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><ol>
<li>解耦</li>
<li>异步</li>
<li>削峰/限流</li>
</ol>
<h4 id="消费者获取数据"><a href="#消费者获取数据" class="headerlink" title="消费者获取数据"></a>消费者获取数据</h4><ul>
<li>PUSH：生产者将数据放到消息队列中，消息队列有数据了，主动叫消费者去拿</li>
<li>PULL：消费者不断轮询消息队列，看看有没有新的数据，如果有就消费</li>
</ul>
<h4 id="改进"><a href="#改进" class="headerlink" title="改进"></a>改进</h4><ol>
<li>高可用：集群/分布式</li>
<li>数据丢失：数据持久化</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/24/MySQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PPCoder">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/author.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/24/MySQL/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-24T22:44:20+08:00">
                2019-09-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>mysql三大引擎是啥</p>
<ul>
<li><p>myisam</p>
</li>
<li><p>innodb</p>
</li>
</ul>
<p>redis的hash算法用的是啥</p>
<p>nosql为啥比sql快</p>
<p>什么是索引</p>
<p>为啥nosql没有索引</p>
<p>B+和B树的区别</p>
<p>sql优化常见的方法</p>
<h3 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h3><p>通过SQL语句的拼接达到无参数查询数据库数据目的的方法</p>
<h3 id="Redis，MySQL，HBase区别："><a href="#Redis，MySQL，HBase区别：" class="headerlink" title="Redis，MySQL，HBase区别："></a>Redis，MySQL，HBase区别：</h3><p>采用的数据结构分别为hash，B+，LSM树</p>
<ul>
<li>hash存储引擎是哈希表的持久化实现，支持增删改以及随机读取操作，但不支持顺序扫描，对应的存储系统为key-value存储系统。对于key-value的插入以及查询，哈希表的复杂度都是O(1)，明显比树O(n)快，如果不需要有序的遍历数据，哈希表是最佳选择</li>
<li>B树存储引擎是B树的持久化实现，不仅支持单挑记录的增删改查操作，还支持顺序扫描（B+树的叶子节点之间的指针），对应的存储系统就是关系数据库。</li>
<li>LSM（Log-Structured Merge Tree）存储引擎和B树存储引擎一样，同样支持增删改查，顺序扫描操作。而且通过批量存储技术规避磁盘随机写入问题。当然凡是有利有弊，LSM树和B+树相比，LSM树牺牲了部分读性能，用来大幅提高写性能，hbase和levelDB的内部实现数据结构就是LSM树</li>
</ul>
<h3 id="非关系型数据库"><a href="#非关系型数据库" class="headerlink" title="非关系型数据库"></a>非关系型数据库</h3><h4 id="MongoDB：文档数据库"><a href="#MongoDB：文档数据库" class="headerlink" title="MongoDB：文档数据库"></a>MongoDB：文档数据库</h4>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/24/Nginx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PPCoder">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/author.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/24/Nginx/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-24T22:44:20+08:00">
                2019-09-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><h3 id="Nginx工作原理"><a href="#Nginx工作原理" class="headerlink" title="Nginx工作原理"></a>Nginx工作原理</h3><h4 id="nginx-文件结构"><a href="#nginx-文件结构" class="headerlink" title="nginx 文件结构"></a>nginx 文件结构</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">...              #全局块</span><br><span class="line"></span><br><span class="line">events &#123;         #events块</span><br><span class="line">   ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http      #http块</span><br><span class="line">&#123;</span><br><span class="line">    ...   #http全局块</span><br><span class="line">    server        #server块</span><br><span class="line">    &#123; </span><br><span class="line">        ...       #server全局块</span><br><span class="line">        location [PATTERN]   #location块</span><br><span class="line">        &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">        location [PATTERN] </span><br><span class="line">        &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    server</span><br><span class="line">    &#123;</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...     #http全局块</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>全局块</strong>：配置影响nginx全局的指令。一般有运行nginx服务器的用户组，nginx进程pid存放路径，日志存放路径，配置文件引入，允许生成worker process数等。</li>
<li><strong>events块</strong>：配置影响nginx服务器或与用户的网络连接。有每个进程的最大连接数，选取哪种事件驱动模型处理连接请求，是否允许同时接受多个网路连接，开启多个网络连接序列化等。</li>
<li><strong>http块</strong>：可以嵌套多个server，配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置。如文件引入，mime-type定义，日志自定义，是否使用sendfile传输文件，连接超时时间，单连接请求数等。</li>
<li><strong>server块</strong>：配置虚拟主机的相关参数，一个http中可以有多个server。</li>
<li><strong>location块</strong>：配置请求的路由，以及各种页面的处理情况。</li>
</ul>
<h4 id="处理流程"><a href="#处理流程" class="headerlink" title="处理流程"></a>处理流程</h4><p><img src="D:%5Clearn%5Cnote%5Cpic%5C1564450067806.png" alt="1564450067806"></p>
<ol>
<li>接到HTTP请求，nginx通过查找配置文件将请求映射到一个location block</li>
<li>location配置的各个指令会启动不同模块完成工作</li>
<li>通常一个location的指令会涉及一个handler模块和多个filter模块</li>
<li>handler模块负责处理请求，完成响应内容的生成，filter模块负责对响应内容进行处理</li>
</ol>
<h4 id="多线程模型"><a href="#多线程模型" class="headerlink" title="多线程模型"></a>多线程模型</h4><p>nginx启动会以daemon形式在后台运行，采用多线程+异步非阻塞IO事件模型来处理各种连接请求。</p>
<ol>
<li><p>多线程模型包括一个master进程，多个worker进程。</p>
<ul>
<li>master进程负责管理nginx本身和其他worker进程</li>
<li>读取并验证配置文件nginx.conf</li>
</ul>
</li>
<li><p>每个worker进程都维护一个线程，处理连接和请求。worker进程的个数由配置文件决定，一般和cpu个数相关</p>
</li>
</ol>
<h4 id="多进程处理模型"><a href="#多进程处理模型" class="headerlink" title="多进程处理模型"></a>多进程处理模型</h4><p>惊群现象：一个请求进来的时候，所有的worker都会感知到</p>
<p>worker进程fork master进程，具有相同的设置，所以设置一个类似互斥锁，保证只有一个进程可以去注册读事件</p>
<h4 id="Nginx的热部署"><a href="#Nginx的热部署" class="headerlink" title="Nginx的热部署"></a>Nginx的热部署</h4><p>修改配置文件后，重新生成新的worker进程，以新的配置处理请求，新的请求都交给新的worker进程，老的worker进程，等把以前的请求处理完毕就kill掉</p>
<h4 id="IO事件模型"><a href="#IO事件模型" class="headerlink" title="IO事件模型"></a>IO事件模型</h4><p>nginx采用linux的epoll模型，epoll模型基于事件驱动机制，可以监控多个事件是否准备完毕，如果ok，则放入epoll队列，这个过程是异步的。worker只需要从epoll队列循环处理即可</p>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><h4 id="代理设置"><a href="#代理设置" class="headerlink" title="代理设置"></a>代理设置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location /user/ &#123;</span><br><span class="line">	proxy_pass http://ppgoder.cn;</span><br><span class="line">	proxy_method get;    #支持客户端的请求方法。post/get；</span><br><span class="line">	#Nginx服务器提供代理服务的http协议版本1.0，1.1，默认设置为1.0版本</span><br><span class="line">	proxy_http_version 1.0 ; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="正向代理"><a href="#正向代理" class="headerlink" title="正向代理"></a>正向代理</h4><p>客户端非常明确的要访问的服务器地址，服务器只清楚请求来自    哪个代理服务器，不清楚来自的客户端</p>
<p>代客户端发送请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">location /xxx &#123;</span><br><span class="line">	#最上层目录的定义</span><br><span class="line">	root	html/static;</span><br><span class="line">	#url为localhost/xxx,文件地址为../html/static/xxx</span><br><span class="line">	</span><br><span class="line">	#目录的别名,目录后面必须用&apos;/&apos;结束</span><br><span class="line">	alias	html/static/;</span><br><span class="line">	#url为localhost/xxx，文件地址为../html/static/</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h4><p>客户端是无感知代理的存在，对外都是透明的，访问者不知道自己访问的是一个代理，反响代理隐藏了服务器的信息</p>
<p>代服务器接收请求</p>
<p>配置请求转发</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//nginx.conf</span></span><br><span class="line">http&#123;</span><br><span class="line">	server&#123;</span><br><span class="line">		listen <span class="number">80</span>;<span class="comment">//端口号</span></span><br><span class="line">		server_name www.baidu.com;<span class="comment">//访问的域名</span></span><br><span class="line">		access_log logs/www_baidu_access.log main;<span class="comment">//日志</span></span><br><span class="line">        error_log logs/www_baidu_error.log;<span class="comment">//日志存放位置</span></span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_redirect off;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_pass http:<span class="comment">//127.0.0.1:8081; //转发的ip地址</span></span><br><span class="line">            #access_log  logs/www_baidu_access.log;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="错误页面配置"><a href="#错误页面配置" class="headerlink" title="错误页面配置"></a>错误页面配置</h4><h5 id="直接访问"><a href="#直接访问" class="headerlink" title="直接访问"></a>直接访问</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error_page  404              https://www.baidu.com;</span><br></pre></td></tr></table></figure>

<h5 id="路径访问"><a href="#路径访问" class="headerlink" title="路径访问"></a>路径访问</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">error_page  404              /404.html;</span><br><span class="line">location = /404.html&#123;</span><br><span class="line">	root	html/; #将会链接到html文件夹下的404.html</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h4><h5 id="模式"><a href="#模式" class="headerlink" title="模式"></a>模式</h5><ol>
<li>轮询</li>
<li>ip_hash：按ip的hash结果分配，同一ip会固定访问一个后端服务器</li>
<li>url_hash：按url的hash结果分配，同一url会固定访问一个后端服务器</li>
<li>fair：按后端服务器的响应时间分配，响应时间短的优先分配</li>
</ol>
<h5 id="服务器参数"><a href="#服务器参数" class="headerlink" title="服务器参数"></a>服务器参数</h5><ol>
<li>down：当前服务器暂不参与负载</li>
<li>weight：权重，值越大，负载量越大</li>
<li>max_fails：允许请求失败的次数，默认为1</li>
<li>fail_timeout：max_fail次失败后暂停的时间</li>
<li>backup：备份机，只有其他所有的非backup机器down或者忙时，才会请求backup机器</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">//nginx.conf</span><br><span class="line">http&#123;</span><br><span class="line">    //服务器集群</span><br><span class="line">    upstream myserver&#123;</span><br><span class="line">		server 127.0.0.1:8081;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	server&#123;</span><br><span class="line">		listen 80;//端口号</span><br><span class="line">		server_name www.baidu.com;//访问的域名</span><br><span class="line">		access_log logs/www_baidu_access.log main;//日志</span><br><span class="line">        error_log logs/www_baidu_error.log;//日志存放位置</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_redirect off;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_pass http://myserver; //转发的ip地址</span><br><span class="line">            #access_log  logs/www_baidu_access.log;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="静态服务器"><a href="#静态服务器" class="headerlink" title="静态服务器"></a>静态服务器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123; </span><br><span class="line">    listen 80;</span><br><span class="line">    #静态网站访问的域名地址</span><br><span class="line">    server_name www.xxx.com;</span><br><span class="line">    client_max_body_size 1024M; </span><br><span class="line">    location / &#123;</span><br><span class="line">    	#直接静态项目的绝对路径的根目录</span><br><span class="line">    	root	/var/www/xxx_static; </span><br><span class="line">        index	index.html; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/24/Odoo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PPCoder">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/author.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/24/Odoo/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-24T22:44:20+08:00">
                2019-09-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Odoo运维文档"><a href="#Odoo运维文档" class="headerlink" title="Odoo运维文档"></a>Odoo运维文档</h2><p>author: dongml</p>
<p>date: 2019/8/28 14:56</p>
<h3 id="开发环境配置"><a href="#开发环境配置" class="headerlink" title="开发环境配置"></a>开发环境配置</h3><ol>
<li><h4 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h4><h5 id="1-1-什么是docker"><a href="#1-1-什么是docker" class="headerlink" title="1.1 什么是docker"></a>1.1 什么是docker</h5><blockquote>
<p>Docker is the company driving the container movement and the only container platform provider to address every application across the hybrid cloud. Today’s businesses are under pressure to digitally transform but are constrained by existing applications and infrastructure while rationalizing an increasingly diverse portfolio of clouds, datacenters and application architectures. Docker enables true independence between applications and infrastructure and developers and IT ops to unlock their potential and creates a model for better collaboration and innovation.</p>
<p>Docker是推动集装箱运输的公司，也是唯一能够解决混合云中每个应用程序的容器平台提供商。今天的企业面临数字化转型的压力，但受到现有应用程序和基础架构的限制，同时使云，数据中心和应用程序架构的组合日益多样化。 Docker实现了应用程序和基础架构之间的真正独立性，开发人员和IT运营商可以释放潜力，并创建更好的协作和创新模型</p>
</blockquote>
<h5 id="1-2-为什么用docker"><a href="#1-2-为什么用docker" class="headerlink" title="1.2 为什么用docker"></a>1.2 为什么用docker</h5><p>众所周知，我们在安装odoo过程中很痛苦，那么，，，，有没有这样的一款软件，让你免除这些痛苦，能很轻易的上手操作呢。</p>
<p>有的，那就是docker，docker是一个容器，它保存的是odoo等软件的镜像，我们甚至只要从仓库拉取需要的镜像就可以很轻松的实现安装或者迁移，那么你以及你的队友，无论是从ubuntu迁移到centos，还是windows迁移linux，只要主机安装了docker，就完全无需考虑配置问题，docker可以迅速的帮你配置好一切，并且保持环境，配置一致。</p>
<p>而我们使用docker，甚至只需要一个写好的compose，我们所有开发的配置都可以保持一致</p>
<h5 id="1-3-安装配置"><a href="#1-3-安装配置" class="headerlink" title="1.3 安装配置"></a>1.3 安装配置</h5><p>1.3.1 查看内核版本是否支持Docker</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -r</span><br></pre></td></tr></table></figure>

<p>1.3.2 更新软件包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y upgrade</span><br></pre></td></tr></table></figure>

<p>1.3.3 查看是否安装过旧版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa|grep docker</span><br></pre></td></tr></table></figure>

<p>1.3.4 如果有就移除旧版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">yum remove docker \</span><br><span class="line">           docker-client \</span><br><span class="line">           docker-client-latest \</span><br><span class="line">           docker-common \</span><br><span class="line">           docker-latest \</span><br><span class="line">           docker-latest-logrotate \</span><br><span class="line">           docker-logrotate \</span><br><span class="line">           docker-selinux \</span><br><span class="line">           docker-engine-selinux \</span><br><span class="line">           docker-engine</span><br></pre></td></tr></table></figure>

<p>1.3.5 使用脚本安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://get.docker.com/ | sh</span><br><span class="line">sh get-docker.sh</span><br></pre></td></tr></table></figure>

<p>1.3.6 设置自启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable docker</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="2">
<li><h4 id="安装postgres"><a href="#安装postgres" class="headerlink" title="安装postgres"></a>安装postgres</h4></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo docker pull postgres</span><br><span class="line">docker run -d -e POSTGRES_USER=odoo -e POSTGRES_PASSWORD=odoo -e POSTGRES_DB=postgres --name db postgres</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><h4 id="安装odoo-12"><a href="#安装odoo-12" class="headerlink" title="安装odoo:12"></a>安装odoo:12</h4></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo docker pull odoo:12</span><br><span class="line">docker run -p 8069:8069 --name odoo --link db:postgres -t odoo</span><br></pre></td></tr></table></figure>



<p>以上，我们的一个环境就部署完成了，但是这环境看起来似乎并没有特别简单，如果能只运行一行命令就能解决该多好呀。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<h4 id="附：docker-compose-yml"><a href="#附：docker-compose-yml" class="headerlink" title="附：docker-compose.yml"></a>附：docker-compose.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.3'</span></span><br><span class="line"><span class="attr">services:</span> </span><br><span class="line">	<span class="attr">odoo12:</span> </span><br><span class="line">		<span class="attr">build:</span> <span class="string">./build/odoo12</span></span><br><span class="line">		<span class="attr">command:</span> <span class="string">start</span></span><br><span class="line">    	<span class="attr">links:</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="attr">postgres:db</span></span><br><span class="line">    	<span class="attr">ports:</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">"8069:8069"</span></span><br><span class="line">    	<span class="attr">volumes:</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="attr">odoo-web-data:/var/lib/odoo</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">./volumes/odoo12/config:/etc/odoo</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">./volumes/odoo12/addons:/opt/odoo/additional_addons</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">./volumes/odoo12/filestore:/opt/odoo/data/filestore</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">./volumes/odoo12/sessions:/opt/odoo/data/sessions</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">./volumes/odoo12/ssh:/opt/odoo/ssh:ro</span></span><br><span class="line">      	</span><br><span class="line">	<span class="attr">postgres:</span></span><br><span class="line">    	<span class="attr">image:</span> <span class="attr">postgres:10</span></span><br><span class="line">    	<span class="attr">container_name:</span> <span class="string">pgsql</span></span><br><span class="line">		<span class="attr">ports:</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">"5432:5432"</span></span><br><span class="line">  	  	<span class="attr">networks:</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">"odoonetwork"</span></span><br><span class="line">    	<span class="attr">environment:</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">POSTGRES_DB=postgres</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">POSTGRES_PASSWORD=odoo</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">POSTGRES_USER=odoo</span></span><br><span class="line">    	<span class="attr">volumes:</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">./volumes/postgres:/var/lib/postgresql/data</span></span><br></pre></td></tr></table></figure>

<h4 id="附：odoo配置文件"><a href="#附：odoo配置文件" class="headerlink" title="附：odoo配置文件"></a>附：odoo配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[options]</span><br><span class="line">addons_path = /mnt/extra-addons,/usr/lib/python2.7/dist-packages/odoo/addons</span><br><span class="line">;data_dir = /var/lib/odoo</span><br><span class="line">admin_passwd = admin</span><br><span class="line">csv_internal_sep = ,</span><br><span class="line">db_maxconn = 64</span><br><span class="line">db_name = False</span><br><span class="line">db_template = template1</span><br><span class="line">dbfilter = .*</span><br><span class="line">debug_mode = False</span><br><span class="line">email_from = False</span><br><span class="line">limit_memory_hard = 2684354560</span><br><span class="line">limit_memory_soft = 2147483648</span><br><span class="line">limit_request = 8192</span><br><span class="line">limit_time_cpu = 60</span><br><span class="line">limit_time_real = 120</span><br><span class="line">list_db = True</span><br><span class="line">log_db = False</span><br><span class="line">log_handler = [&apos;:INFO&apos;]</span><br><span class="line">log_level = info</span><br><span class="line">logfile = None</span><br><span class="line">longpolling_port = 8072</span><br><span class="line">max_cron_threads = 2</span><br><span class="line">osv_memory_age_limit = 1.0</span><br><span class="line">osv_memory_count_limit = False</span><br><span class="line">smtp_password = False</span><br><span class="line">smtp_port = 25</span><br><span class="line">smtp_server = localhost</span><br><span class="line">smtp_ssl = False</span><br><span class="line">smtp_user = False</span><br><span class="line">workers = 2</span><br><span class="line">xmlrpc = True</span><br><span class="line">xmlrpc_interface =</span><br><span class="line">xmlrpc_port = 8069</span><br><span class="line">xmlrpcs = True</span><br><span class="line">xmlrpcs_interface =</span><br><span class="line">xmlrpcs_port = 8071</span><br></pre></td></tr></table></figure>

<h3 id="设置Nginx反向代理"><a href="#设置Nginx反向代理" class="headerlink" title="设置Nginx反向代理"></a>设置Nginx反向代理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">upstream odoo &#123;</span><br><span class="line">​    server 127.0.0.1:8069;</span><br><span class="line">&#125;</span><br><span class="line">upstream odoochat &#123;</span><br><span class="line">​    server 127.0.0.1:8072;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">​     listen 80;</span><br><span class="line">​     # Add Headers for odoo proxy mode</span><br><span class="line">​     proxy_set_header X-Forwarded-Host $host;</span><br><span class="line">​     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">​     proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">​     proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line"></span><br><span class="line">​     # log</span><br><span class="line">​     access_log /var/log/nginx/odoo.access.log;</span><br><span class="line">​     error_log /var/log/nginx/odoo.error.log;</span><br><span class="line">​     # Redirect longpoll requests to odoo longpolling port</span><br><span class="line">​     location /longpolling &#123;</span><br><span class="line">​        proxy_pass http://odoochat;</span><br><span class="line">​     &#125;</span><br><span class="line"></span><br><span class="line">​     # Redirect requests to odoo backend server</span><br><span class="line">​     location / &#123;</span><br><span class="line">​         proxy_redirect off;</span><br><span class="line">​         proxy_pass http://odoo;</span><br><span class="line">​     &#125;</span><br><span class="line"></span><br><span class="line">​     # common gzip</span><br><span class="line">​    gzip_types text/css text/scss text/plain text/xml application/xml application/json application/javascript;</span><br><span class="line">​    gzip on;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/24/Docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PPCoder">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/author.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/24/Docker/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-24T22:44:20+08:00">
                2019-09-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><h3 id="什么是docker"><a href="#什么是docker" class="headerlink" title="什么是docker"></a>什么是docker</h3><blockquote>
<p>Docker is the company driving the container movement and the only container platform provider to address every application across the hybrid cloud. Today’s businesses are under pressure to digitally transform but are constrained by existing applications and infrastructure while rationalizing an increasingly diverse portfolio of clouds, datacenters and application architectures. Docker enables true independence between applications and infrastructure and developers and IT ops to unlock their potential and creates a model for better collaboration and innovation.</p>
<p>Docker是推动集装箱运输的公司，也是唯一能够解决混合云中每个应用程序的容器平台提供商。今天的企业面临数字化转型的压力，但受到现有应用程序和基础架构的限制，同时使云，数据中心和应用程序架构的组合日益多样化。 Docker实现了应用程序和基础架构之间的真正独立性，开发人员和IT运营商可以释放潜力，并创建更好的协作和创新模型</p>
</blockquote>
<h3 id="为什么用docker"><a href="#为什么用docker" class="headerlink" title="为什么用docker"></a>为什么用docker</h3><p>众所周知，odoo这个软件出奇的难以安装，需要的依赖又多，那么，，，，有没有这样的一款软件，让你免除这些痛苦，能很轻易的上手操作odoo，而免除这些痛苦呢。</p>
<p>有的，那就是docker，docker是一个容器，它保存的是odoo等配置的镜像，我们将配置好的odoo等的依赖软件上传到docker的仓库，那么你以及你的队友，无论是从ubuntu迁移到centos，还是windows迁移linux，只要主机安装了docker，就完全无需考虑配置问题，docker可以迅速的帮你配置好一切，并且保持环境，配置一致。</p>
<p>而docker所做的呢，就是类似在你的系统中安装了一个虚拟机，脱离了平台，配置就有了保证。虽然比喻并不恰当，但还是很形象的。</p>
<h3 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h3><ol>
<li>查看内核版本是否支持Docker</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -r</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>更新软件包</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y upgrade</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>查看是否安装过旧版本</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa|grep docker</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>如果有就移除旧版本</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">yum remove docker \</span><br><span class="line">           docker-client \</span><br><span class="line">           docker-client-latest \</span><br><span class="line">           docker-common \</span><br><span class="line">           docker-latest \</span><br><span class="line">           docker-latest-logrotate \</span><br><span class="line">           docker-logrotate \</span><br><span class="line">           docker-selinux \</span><br><span class="line">           docker-engine-selinux \</span><br><span class="line">           docker-engine</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>使用脚本安装</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://get.docker.com/ | sh</span><br><span class="line">sh get-docker.sh</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/author.jpg" alt="PPCoder">
            
              <p class="site-author-name" itemprop="name">PPCoder</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">PPCoder</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
