<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="Yun">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Yun">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Yun">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>Yun</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Yun</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Code and Love.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-feeling">
          <a href="/feeling/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-feeling"></i> <br>
            
            feeling
          </a>
        </li>
      
        
        <li class="menu-item menu-item-notes">
          <a href="/notes/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-notes"></i> <br>
            
            notes
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/26/Java/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PPCoder">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/author.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/26/Java/" itemprop="url">Java基础整理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-12-26T15:26:25+08:00">
                2019-12-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h2 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h2><h3 id="null"><a href="#null" class="headerlink" title="null"></a><code>null</code></h3><blockquote>
<p>The Java Virtual Machine specification does not mandate a concrete value encoding null.（Java虚拟机规范并没有授权一个具体的值编码null。）</p>
<p>不是有效的对象实例，并没有为它分配内存。它只是一个值，指示对象引用当前不引用对象</p>
</blockquote>
<ol>
<li><p>大小写敏感，</p>
</li>
<li><p>引用类型变量的默认值，</p>
</li>
<li><p>不能赋给基本类型变量，</p>
</li>
<li><p>既不是对象也不是类型，是一种特殊值</p>
</li>
<li><p>可以将null转化或赋予成任何引用类型</p>
</li>
<li><p><code>instanceof</code>对带有null值的引用类型变量会返回<code>false</code></p>
</li>
<li><p><code>null==null是安全的</code></p>
</li>
<li><p>静态方法可以通过类型调用，所以null可以调用静态方法</p>
</li>
<li><p>其他用途和注意事项：</p>
<ul>
<li><p>释放内存</p>
</li>
<li><p><code>List</code>：允许重复元素，可以加入任意多个null</p>
<p><code>Set</code>：不允许重复元素，最多可以加入一个null</p>
<p><code>Map</code>：Map的key最多可以加入一个null，value字段没有限制</p>
</li>
</ul>
</li>
</ol>
<h3 id="default"><a href="#default" class="headerlink" title="default"></a><code>default</code></h3><ul>
<li><p>witch中的默认值</p>
</li>
<li><p>JAVA 8 新特性，在接口中实现方法</p>
</li>
</ul>
<blockquote>
<p>注意：与static有差别，default只是保证实现了方法，用法和普通函数一样</p>
</blockquote>
<h3 id="transient"><a href="#transient" class="headerlink" title="transient"></a><code>transient</code></h3><ul>
<li><p>阻止变量被序列化，即反序列化时被赋空值</p>
</li>
<li><p>可以手动序列化</p>
</li>
</ul>
<h3 id="Native"><a href="#Native" class="headerlink" title="Native"></a><code>Native</code></h3><p>Java Native Interface(Java本地接口)：用户和本地C代码进行互操作的API</p>
<h2 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h2><h3 id="位运算符"><a href="#位运算符" class="headerlink" title="位运算符"></a>位运算符</h3><ol>
<li><p>“按位与”：&amp;</p>
<p>双目运算符，对两个整型数据a，b按位进行运算，运算结果是一个整形数据c。</p>
<p>运算法则是：如果a，b两个数据对应位都是1，则c的该位是1，否则是0</p>
</li>
<li><p>“按位或”：|</p>
<p>双目运算符，对两个整形数据a，b按位进行运算，运算结果是一个整形数据c。</p>
<p>运算法则：如果a，b两个数据对应位都是0，则c的该位是0，否则是1。</p>
</li>
<li><p>“按位非”：~</p>
<p>弹幕运算符，对一个整型数据a按位进行运算，运算结果是一个整形数据c。</p>
<p>运算法则：如果a对应位是0，则c的对应位是1，否则是0</p>
</li>
<li><p>“按位异或”：^</p>
<p>双目运算符，对两个整形数据a，b按位进行运算，运算结果是一个整形数据c。</p>
<p>运算法则：如果a，b两个数据对应位相同，则c的该位是0，否则是1</p>
</li>
</ol>
<h3 id="移位运算符"><a href="#移位运算符" class="headerlink" title="移位运算符"></a>移位运算符</h3><blockquote>
<p>注意： </p>
<ul>
<li>移位运算符只可用来处理整数类型</li>
<li>如果对char，byte或short类型数值移位，将强制转型为int类型</li>
<li>当短类型byte，short对-1移位时，多次类型转换可能会导致数字不变</li>
<li>右侧整数  = 移动的位数</li>
</ul>
</blockquote>
<ol>
<li><p>左移操作符：&lt;&lt;</p>
<p>低位补0</p>
</li>
<li><p>右移操作符：&gt;&gt;</p>
<p>“符号拓展”：符号为正，则高位补0；符号为负，高位补1</p>
</li>
<li><p>无符号右移操作符：&gt;&gt;&gt;</p>
<p>“零拓展”：高位补0</p>
</li>
</ol>
<blockquote>
<p>难点：（Thinking in java中可能难以理解的部分）</p>
<p>所谓“数值右端低五位才有用”，参考 [<a href="https://blog.csdn.net/Pioneer_Java/article/details/78742267]" target="_blank" rel="noopener">https://blog.csdn.net/Pioneer_Java/article/details/78742267]</a></p>
<p>两个关键词：数值右端，低五位</p>
<ul>
<li>数值右端：值表达式x &gt;&gt; y，数值x，x的右端即y</li>
<li>低五位：y的低五位，2的5次方=32，保证不超过int位数</li>
</ul>
</blockquote>
<h2 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h2><h3 id="int"><a href="#int" class="headerlink" title="int"></a><code>int</code></h3><h2 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h2><h3 id="Java对象的内存模型"><a href="#Java对象的内存模型" class="headerlink" title="Java对象的内存模型"></a>Java对象的内存模型</h3><p> | 对象头 | 实例数据 | 对齐填充字节 |</p>
<h4 id="对象头"><a href="#对象头" class="headerlink" title="对象头"></a>对象头</h4><p>| <code>MarkWord</code> | 指向类的指针 | 数组长度（只有数组对象有） |</p>
<h5 id="MarkWord"><a href="#MarkWord" class="headerlink" title="MarkWord"></a><code>MarkWord</code></h5><p>记录了对象和synchronized锁有关的信息</p>
<p><img src="G:%5Cresource%5Cpublic%5CYunBlog%5CNote%5Cpic%5C1565839536881.png" alt="1565839536881"></p>
<h5 id="指向类的指针"><a href="#指向类的指针" class="headerlink" title="指向类的指针"></a>指向类的指针</h5><blockquote>
<p> 该指针在32位JVM中的长度是32bit，在64位JVM中长度是64bit。</p>
<p> Java对象的类数据保存在方法区。</p>
</blockquote>
<h5 id="数组长度"><a href="#数组长度" class="headerlink" title="数组长度"></a>数组长度</h5><blockquote>
<p>只有数组对象保存了这部分数据。</p>
<p>该数据在32位和64位JVM中长度都是32bit</p>
</blockquote>
<h4 id="实例数据"><a href="#实例数据" class="headerlink" title="实例数据"></a>实例数据</h4><blockquote>
<p>对象的实例数据就是在java代码中能看到的属性和他们的值</p>
</blockquote>
<h4 id="对齐填充字节"><a href="#对齐填充字节" class="headerlink" title="对齐填充字节"></a>对齐填充字节</h4><blockquote>
<p>因为JVM要求java的对象占的内存大小应该是8bit的倍数，所以后面有几个字节用于把对象的大小补齐至8bit的倍数，没有特别的功能。</p>
</blockquote>
<h3 id="对象的创建"><a href="#对象的创建" class="headerlink" title="对象的创建"></a>对象的创建</h3><h4 id="类加载检查"><a href="#类加载检查" class="headerlink" title="类加载检查"></a>类加载检查</h4><p>//todo</p>
<h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><h2 id="集合类"><a href="#集合类" class="headerlink" title="集合类"></a>集合类</h2><h3 id="集合框架"><a href="#集合框架" class="headerlink" title="集合框架"></a>集合框架</h3><p><img src="G:%5Cresource%5Cpublic%5CYunBlog%5Cpic%5CJAVA%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6.png" alt="img"></p>
<h3 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a><code>Collection</code></h3><blockquote>
<p>The root interface in the collection hierarchy.  A collection represents a group of objects, known as its elements.  Some collections allow duplicate elements and others do not.  Some are ordered and others unordered.  The JDK does not provide any direct implementations of this interface: it provides implementations of more specific subinterfaces like {@code Set} and {@code List}.  This interface is typically used to pass collections around and manipulate them where maximum generality is desired.</p>
<p>集合层次结构中的根接口。 集合表示一组对象，称为其元素。 有些集合允许重复元素而其他集合则不允许。 有些是订购的，有些是无序的。 JDK不提供此接口的任何直接实现：它提供了更具体的子接口的实现，如Set和List。 此接口通常用于传递集合并在需要最大通用性的情况下对其进行操作。</p>
</blockquote>
<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a><code>Map</code></h3><blockquote>
<p>An object that maps keys to values.  A map cannot contain duplicate keys; each key can map to at most one value.</p>
<p>将key映射到value的一个对象，map不能包含重复的key，每个key只能映射一个value</p>
</blockquote>
<p>并且，Map和Collection没有关系</p>
<h4 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a><code>HashMap</code></h4><blockquote>
<p>Hash table based implementation of the {@code Map} interface.  This implementation provides all of the optional map operations, and permits {@code null} values and the {@code null} key.  (The {@code HashMap} class is roughly equivalent to {@code Hashtable}, except that it is unsynchronized and permits nulls.)  This class makes no guarantees as to the order of the map; in particular, it does not guarantee that the order will remain constant over time.</p>
<p>基于Map接口实现的HashTable。此实现提供了所有可选的map操作，并允许value为null和key为null。HashMap类大致相当于HashTable，除了它是不同步的并且允许空值。这个类不保证map的顺序，尤其是它不保证顺序会随着时间的推移保持不变</p>
</blockquote>
<h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ol>
<li><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 允许且只允许有一个key为null，放在第一位</span></span><br><span class="line"><span class="comment">     * 插入的时间复杂度基本是O(1)</span></span><br><span class="line"><span class="comment">     * key用set存放，通过map的实现函数</span></span><br><span class="line"><span class="comment">     * 元素是无序的</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt;[] resize()&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 容量*2</span></span><br><span class="line"><span class="comment">     * 扩容会导致元素的顺序不定时改变</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li></li>
</ol>
<h3 id="List"><a href="#List" class="headerlink" title="List"></a><code>List</code></h3><blockquote>
<p>An ordered collection (also known as a sequence).  The user of this interface has precise control over where in the list each element is inserted.  The user can access elements by their integer index (position in the list), and search for elements in the list.</p>
<p>有序集合。该接口的用户可以精确的控制列表中每个元素的插入位置。用户可以通过调整数的索引访问元素，并搜索列表中的元素</p>
</blockquote>
<h4 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a><code>LinkedList</code></h4><blockquote>
<p>Doubly-linked list implementation of the {@code List} and {@code Deque} interfaces.  Implements all optional list operations, and permits all elements (including {@code null}).</p>
<p>实现了List和Deque接口的双链表实现。实现了所有可选的list操作，并允许所有元素，包含null</p>
</blockquote>
<h4 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a><code>ArrayList</code></h4><blockquote>
<p>Resizable-array implementation of the {@code List} interface.  Implements all optional list operations, and permits all elements, including {@code null}.  In addition to implementing the {@code List} interface, this class provides methods to manipulate the size of the array that is used internally to store the list.  (This class is roughly equivalent to {@code Vector}, except that it is unsynchronized.)</p>
<p>实现了List接口的可调整大小的数组实现。实现了所有可选list操作，允许所有元素，包含null。除此之外，它还提供了一些方法来操作内部用于存储列表的数组的大小。（相当于Vector，但它不同步）</p>
</blockquote>
<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a><code>Set</code></h3><blockquote>
<p>A collection that contains no duplicate elements.  More formally, sets contain no pair of elements {@code e1} and {@code e2} such that {@code e1.equals(e2)}, and at most one null element.  As implied by its name, this interface models the mathematical set abstraction.</p>
<p>不包含重复元素的集合。最多只包含一个null元素。正如其名称所暗示的，该界面模拟数学集抽象</p>
</blockquote>
<h2 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h2><h3 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h3><h4 id="线程的状态"><a href="#线程的状态" class="headerlink" title="线程的状态"></a>线程的状态</h4><p><img src="G:%5Cresource%5Cpublic%5CYunBlog%5CNote%5Cpic%5C1567155756338.png" alt="1567155756338"></p>
<p>创建态(New)：线程被创建</p>
<p>就绪态(Runnable)：线程对象被start</p>
<p>运行态(Running)：线程获取到cpu权限进行执行</p>
<p>等待态(Blocked)：等待/阻塞/睡眠状态，线程让出cpu使用权限，暂时停止运行</p>
<p>结束态(Dead)：执行结束或异常退出run方法</p>
<blockquote>
<p>注意：start()和run()的区别</p>
<p>run()方法是任务，定义了线程需要做的工作，如果直接调用，则会在当前线程执行任务</p>
<p>start()会调用虚拟机的方法，再开一个线程异步执行run方法</p>
</blockquote>
<h4 id="线程的创建"><a href="#线程的创建" class="headerlink" title="线程的创建"></a>线程的创建</h4><blockquote>
<p>线程可以驱动任务，Runnable接口用来定义任务</p>
</blockquote>
<ol>
<li>继承Thread类并重写run方法，Thread类实现了Runnable接口</li>
<li>实现Runnable接口并重写run方法，要将Runnable任务赋给Thread构造器</li>
<li>实现Callable接口</li>
<li>创建ExecutorService对象，将任务交给该对象去execute</li>
</ol>
<h3 id="线程同步"><a href="#线程同步" class="headerlink" title="线程同步"></a>线程同步</h3><h4 id="Synchronized"><a href="#Synchronized" class="headerlink" title="Synchronized"></a><code>Synchronized</code></h4><p>包含wait和notify</p>
<h4 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a><code>volatile</code></h4><h4 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a><code>Lock</code></h4><h4 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a><code>ThreadLocal</code></h4><p>–&gt; <code>JDK1.2</code>包<code>java.lang.ThreadLocal</code></p>
<blockquote>
<p>姓名：本地线程副本变量工具类</p>
<p>用途：将私有线程和该线程存放的副本对象做一个映射，各个线程之间的变量互不干扰</p>
<p>场景：在高并发的场景下，可以实现无状态的调用，特别适用于各个线程依赖不同的变量值完成操作的场景</p>
</blockquote>
<h5 id="ThreadLocalMap"><a href="#ThreadLocalMap" class="headerlink" title="ThreadLocalMap"></a><code>ThreadLocalMap</code></h5><blockquote>
<p>ThreadLocalMap is a customized hash map suitable only for maintaining thread local values. No operations are exported outside of the ThreadLocal class. The class is package private to allow declaration of fields in class Thread.  To help deal with very large and long-lived usages, the hash table entries use WeakReferences for keys. However, since reference queues are not used, stale entries are guaranteed to be removed only when the table starts running out of space.</p>
<p>ThreadLocalMap是一个自定义hash map仅适用于维护本地线程值。不会在ThreadLocal类之外导出操作。这个类是私有允许在Thread类中声明字段。为帮助解决非常大且长期使用，hash table的entries使用弱引用键。但是，由于未使用引用队列，只有在表开始空间不足时才能保证删除过时entries</p>
</blockquote>
<h4 id="BlockingQueue"><a href="#BlockingQueue" class="headerlink" title="BlockingQueue"></a><code>BlockingQueue</code></h4><h2 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h2><h3 id="异常分类"><a href="#异常分类" class="headerlink" title="异常分类"></a>异常分类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">           Throwable</span><br><span class="line"></span><br><span class="line">          /          \</span><br><span class="line"></span><br><span class="line">      Error          Exception</span><br><span class="line"></span><br><span class="line">     /            /           \</span><br><span class="line"></span><br><span class="line">xxxxxx        xxxxxx         RuntimeException</span><br><span class="line"></span><br><span class="line">                            /               \</span><br><span class="line"></span><br><span class="line">                      xxxxxx       ArithmeticException</span><br></pre></td></tr></table></figure>

<p><code>Throwable</code>：代表可抛出</p>
<p><code>Error</code>：严重错误，无法处理</p>
<p><code>Exception</code>：异常</p>
<p><code>RuntimeException</code>：运行时异常</p>
<p><code>非RuntimeException</code>：非运行时异常</p>
<p><code>ArithmeticException</code>：算术异常</p>
<h3 id="处理方法"><a href="#处理方法" class="headerlink" title="处理方法"></a>处理方法</h3><h4 id="1-try-catch"><a href="#1-try-catch" class="headerlink" title="1. try-catch"></a>1. try-catch</h4><p>try-catch会捕获到异常，并在catch中处理，不会终止程序</p>
<p><code>getMessage()</code>：Exception类的方法之一，返回异常的原因</p>
<p><code>printStackTrace()</code>：Exception类的方法之一，在屏幕输出函数栈信息，也就是异常出现的地方</p>
<h4 id="2-throw-or-throws"><a href="#2-throw-or-throws" class="headerlink" title="2. throw or throws"></a>2. throw or throws</h4><p>把可能出现的异常给调用的上级函数处理，</p>
<p><code>throw</code>：用于代码块中，如果throw抛出一个非<code>RuntimeException</code>异常，必须在函数定义声明里加上throws后缀，并且上层函数必须对此异常做出处理</p>
<p><code>throws</code>：用于函数名中,如果加多个异常，则是有可能抛出多个异常的一种</p>
<p>如果都不进行处理，会将异常抛给<code>jvm</code>进行处理，<code>jvm</code>会中断整个程序，将异常信息输出到屏幕，非<code>RuntimeException</code>无法抛给<code>jvm</code>进行处理</p>
<h2 id="WebApp"><a href="#WebApp" class="headerlink" title="WebApp"></a>WebApp</h2><h3 id="jar包"><a href="#jar包" class="headerlink" title="jar包"></a>jar包</h3><p>java archive：java归档文件，是与平台无关的文件格式，它允许将许多文件合成一个压缩文件，javase程序可以打包成jar包</p>
<h3 id="War包"><a href="#War包" class="headerlink" title="War包"></a>War包</h3><p>可以直接运行的web模块，通常用于网站，打成包部署到容器中，</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/03/面试问题归档/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PPCoder">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/author.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/03/面试问题归档/" itemprop="url">面试的一些小问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-03T21:52:14+08:00">
                2019-10-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h3 id="Servlet是线程安全吗"><a href="#Servlet是线程安全吗" class="headerlink" title="Servlet是线程安全吗"></a>Servlet是线程安全吗</h3>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2019/10/03/面试问题归档/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/03/SpringCloud/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PPCoder">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/author.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/03/SpringCloud/" itemprop="url">微服务学习</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-03T13:45:51+08:00">
                2019-10-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h1 id="微服务"><a href="#微服务" class="headerlink" title="微服务"></a>微服务</h1><blockquote>
<p>微服务架构是一种架构模式，它提倡将单一应用程序划分成一组小的服务，服务之间相互协调、互相配合，为用户提供最终价值。每个服务运行在其独立的进程中，服务和服务之间采用轻量级的通信机制相互沟通（通常是基于HTTP的Restful API).</p>
<p>每个服务都围绕着具体的业务进行构建，并且能够被独立的部署到生产环境、类生产环境等。另外，应尽量避免统一的、集中的服务管理机制，对具体的一个服务而言，应根据业务上下文，选择合适的语言、工具对其进行构.</p>
</blockquote>
<p>微服务：从业务层面对项目进行分割，注重项目粒度的划分，项目之间独立部署并通过协议进行数据交互</p>
<p>将应用分割为一系列细小的服务，每个服务专注于单一的功能，运行在独立的进程中</p>
<h3 id="服务的发现与注册"><a href="#服务的发现与注册" class="headerlink" title="服务的发现与注册"></a>服务的发现与注册</h3><blockquote>
<p>一般的微服务架构里都有两层API GetWay，</p>
<ul>
<li><p>外部API GetWay，用于用户访问系统；</p>
</li>
<li><p>内部API GetWay，内部服务之间的API GetWay，内部API GetWay要解决的问题就是服务发现和服务注册。API Gateway还可能有其他功能，如授权、监控、负载均衡、缓存、请求分片和管理、静态响应处理等。 </p>
</li>
</ul>
<p>从这也能看出来，为什么通信的方式要尽量单一，API GetWay有一项工作就是协议转换。</p>
</blockquote>
<h3 id="高可用性"><a href="#高可用性" class="headerlink" title="高可用性"></a>高可用性</h3><blockquote>
<p>描述一个系统经过专门的设计，从而减少停工时间，而保持其服务的高度可用性</p>
</blockquote>
<h4 id="负载均衡服务器的高可用性"><a href="#负载均衡服务器的高可用性" class="headerlink" title="负载均衡服务器的高可用性"></a>负载均衡服务器的高可用性</h4><p>建立一个备份机，监控主机的运行状况，如果备份机不能接收到主机的信息时，就接管主机的服务ip继续提供服务，如果又收到了主机的信息时，就释放服务ip地址。主，备份机之间实现系统配置信息的同步</p>
<h2 id="Dubbo"><a href="#Dubbo" class="headerlink" title="Dubbo"></a>Dubbo</h2><p>RPC框架，通讯协议是RPC协议</p>
<ol>
<li>被远程调用的接口，需要在<code>zookeeper</code>中进行注册</li>
<li>需要远程调用的服务在<code>zookeeper</code>中声明自己需要的接口</li>
<li><code>zookeeper</code>将已经注册的接口通知给需要的服务</li>
</ol>
<h2 id="Spring-Cloud"><a href="#Spring-Cloud" class="headerlink" title="Spring Cloud"></a>Spring Cloud</h2><p>RPC框架，通讯协议是HTTP RESTful协议</p>
<blockquote>
<p>Spring Cloud是一系列框架的有序集合。</p>
<p>它利用Spring Boot的开发便利性巧妙地简化了分布式系统基础设施的开发，如服务发现注册、配置中心、消息总线、负载均衡、断路器、数据监控等，都可以用Spring Boot的开发风格做到一键启动和部署。</p>
<p>Spring并没有重复制造轮子，它只是将目前各家公司开发的比较成熟、经得起实际考验的服务框架组合起来，通过Spring Boot风格进行再封装屏蔽掉了复杂的配置和实现原理，最终给开发者留出了一套简单易懂、易部署和易维护的分布式系统开发工具包。</p>
</blockquote>
<p><img src="C:%5CUsers%5CEDZ%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1562647212344.png" alt="1562647212344"></p>
<h4 id="版本冲突详见"><a href="#版本冲突详见" class="headerlink" title="版本冲突详见"></a>版本冲突详见</h4><ul>
<li><p>Angel版本基于<code>Spring Boot1.2.x</code>构建，在一些场景下，与<code>Spring Boot1.3.x</code>及以上版本不兼容。</p>
</li>
<li><p><code>Brixton</code>版本基于<code>Spring Boot1.3.x</code>构建，也可使用<code>1.4.x</code>进行测试，与<code>Spring Boot1.2.x</code>不兼容。</p>
</li>
<li><p><code>Camden</code>版本基于<code>Spring Boot1.4.x</code>构建，也可使用<code>1.5.x</code>进行测试。</p>
</li>
<li><p><code>Dalston</code>版本基于<code>Spring Boot1.5.x</code>构建，不兼容<code>Spring Boot2.0.x</code>。</p>
</li>
<li><p><code>Edgware</code>版本基于<code>Spring Boot1.5.x</code>构建，不兼容<code>Spring Boot2.0.x</code>。</p>
</li>
<li><p><code>Finchley</code>版本基于<code>Spring Boot2.0.x</code>构建，不兼容<code>Spring Boot1.x</code>。</p>
</li>
<li><p><code>Greenwich</code>版本基于<code>Spring Boot2.1.x</code>构建，不兼容<code>Spring Boot2.x</code>。</p>
</li>
</ul>
<p>!注意：发生<code>NoClasses</code>等问题时，查找各组件对应的SpringBoot版本号，动态的调整，SpringCloud只能表示大部分组件，并不能代表所有组件都支持最新</p>
<p>#### </p>
<h2 id="SpringCloud组件"><a href="#SpringCloud组件" class="headerlink" title="SpringCloud组件"></a>SpringCloud组件</h2><h3 id="Netflix"><a href="#Netflix" class="headerlink" title="Netflix"></a>Netflix</h3><p>对Netflix公司一系列开源产品的包装，它为Spring Boot应用提供了自配置的Netflix OSS整合。</p>
<h4 id="Eureka"><a href="#Eureka" class="headerlink" title="Eureka"></a>Eureka</h4><blockquote>
<p>服务中心，云端服务发现，一个基于 REST 的服务，用于定位服务，以实现云端中间层服务发现和故障转移。</p>
</blockquote>
<p>服务中心，提供服务，保证稳定性和质量。</p>
<p>包含两个组件：Eureka Server（服务端）和Eureka Client（客户端）</p>
<ul>
<li><p>Eureka Server：</p>
<blockquote>
<p>提供服务注册服务，各个节点启动会，会在Server中进行注册，包括主机与端口号，服务版本号，通讯协议等。</p>
<p>支持集群模式部署，集群中的不同服务注册中心通过异步模式相互复制各自的状态，这也意味着在给定的时间点每个实例关于所有服务的状态可能存在不一致的现象</p>
</blockquote>
</li>
<li><p>Eureka Client：</p>
<blockquote>
<p>处理服务的注册和发现，客户端服务通过注册和参数配置的方式，嵌入在客户端应用程序的代码中。</p>
</blockquote>
</li>
</ul>
<p>在应用启动时，Eureka客户端向服务端注册自己的服务信息，同时将服务端的服务信息缓存到本地。客户端会和服务端周期性的进行心跳交互，以更新服务租约和服务信息。</p>
<h4 id="Ribbon"><a href="#Ribbon" class="headerlink" title="Ribbon"></a>Ribbon</h4><p><img src="C:%5CUsers%5CEDZ%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1562663773534.png" alt="1562663773534"></p>
<blockquote>
<p>Spring Cloud Ribbon是一个基于HTTP和TCP的客户端负载均衡工具，它基于Netflix Ribbon实现。通过Spring Cloud的封装，可以让我们轻松地将面向服务的REST模版请求自动转换成客户端负载均衡的服务调用。</p>
</blockquote>
<p>作用：提供客户侧的软件负载均衡算法</p>
<h4 id="Hystrix"><a href="#Hystrix" class="headerlink" title="Hystrix"></a>Hystrix</h4><p><img src="C:%5CUsers%5CEDZ%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1562663919656.png" alt="1562663919656"></p>
<blockquote>
<p>熔断器，容错管理工具，旨在通过熔断机制控制服务和第三方库的节点,从而对延迟和故障提供更强大的容错能力。</p>
</blockquote>
<p>熔断器，服务无法正常使用，防止其他服务多次请求造成堵塞和浪费连接，将服务熔断，停止访问。</p>
<blockquote>
<p>为了保证其高可用，单个服务通常会集群部署。由于网络原因或者自身的原因，服务并不能保证100%可用，如果单个服务出现问题，调用这个服务就会出现线程阻塞，此时若有大量的请求涌入，Servlet容器的线程资源会被消耗完毕，导致服务瘫痪。服务与服务之间的依赖性，故障会传播，会对整个微服务系统造成灾难性的严重后果，这就是服务故障的“雪崩”效应。</p>
</blockquote>
<h4 id="Zuul"><a href="#Zuul" class="headerlink" title="Zuul"></a>Zuul</h4><blockquote>
<p>Zuul 是在云平台上提供动态路由,监控,弹性,安全等边缘服务的框架。</p>
<p>Zuul 相当于是设备和 Netflix 流应用的 Web 网站后端所有请求的前门。</p>
<p>智能路由，拦截和转发非法请求，api网关，负载均衡</p>
</blockquote>
<h4 id="Archaius"><a href="#Archaius" class="headerlink" title="Archaius"></a>Archaius</h4><blockquote>
<p>配置管理API，包含一系列配置管理API，提供动态类型化属性、线程安全配置操作、轮询框架、回调机制等功能。可以实现动态获取配置， 原理是每隔60s（默认，可配置）从配置源读取一次内容，这样修改了配置文件后不需要重启服务就可以使修改后的内容生效，前提使用Archaius的API来读取。</p>
</blockquote>
<p>动态获取配置</p>
<h3 id="Spring-Cloud-1"><a href="#Spring-Cloud-1" class="headerlink" title="Spring Cloud"></a>Spring Cloud</h3><h4 id="Config"><a href="#Config" class="headerlink" title="Config"></a>Config</h4><blockquote>
<p>俗称的配置中心，配置管理工具包，让你可以把配置放到远程服务器，集中化管理集群配置，目前支持本地存储、Git以及Subversion。</p>
</blockquote>
<p>配置中心，收集管理所有配置，方便上传到云端</p>
<blockquote>
<p>SpringCloud Config提供服务器端和客户端。服务器存储后端的默认实现使用git，因此它轻松支持标签版本的配置环境，以及可以访问用于管理内容的各种工具。</p>
</blockquote>
<h4 id="Bus"><a href="#Bus" class="headerlink" title="Bus"></a>Bus</h4><blockquote>
<p>事件、消息总线，用于在集群（例如，配置变化事件）中传播状态变化，可与Spring Cloud Config联合实现热部署。</p>
</blockquote>
<p>相当于水浒传中日行八百里的神行太保戴宗，确保各个小弟之间消息保持畅通。</p>
<h4 id="Cloud-Foundry"><a href="#Cloud-Foundry" class="headerlink" title="Cloud Foundry"></a>Cloud Foundry</h4><blockquote>
<p>Cloud Foundry是VMware推出的业界第一个开源PaaS云平台，它支持多种框架、语言、运行时环境、云平台及应用服务，使开发人员能够在几秒钟内进行应用程序的部署和扩展，无需担心任何基础架构的问题</p>
</blockquote>
<p>其实就是与CloudFoundry进行集成的一套解决方案，抱了Cloud Foundry的大腿。</p>
<h4 id="Cluster"><a href="#Cluster" class="headerlink" title="Cluster"></a>Cluster</h4><blockquote>
<p>Spring Cloud Cluster将取代Spring Integration。提供在分布式系统中的集群所需要的基础功能支持，如：选举、集群的状态一致性、全局锁、tokens等常见状态模式的抽象和实现。</p>
</blockquote>
<p>如果把不同的帮派组织成统一的整体，Spring Cloud Cluster已经帮你提供了很多方便组织成统一的工具。</p>
<h4 id="Consul"><a href="#Consul" class="headerlink" title="Consul"></a>Consul</h4><blockquote>
<p>Consul 是一个支持多数据中心分布式高可用的服务发现和配置共享的服务软件</p>
<p>Spring Cloud Consul 封装了Consul操作，consul是一个服务发现与配置工具，与Docker容器可以无缝集成。</p>
</blockquote>
<p>特征：</p>
<ul>
<li>服务发现</li>
<li>健康检查</li>
<li>Key/Value存储</li>
<li>多数据中心</li>
</ul>
<h4 id="Security"><a href="#Security" class="headerlink" title="Security"></a>Security</h4><p>基于spring security的安全工具包，为你的应用程序添加安全控制。这个小弟很牛鼻专门负责整个帮派的安全问题，设置不同的门派访问特定的资源，不能把秘籍葵花宝典泄漏了。</p>
<h4 id="Sleuth"><a href="#Sleuth" class="headerlink" title="Sleuth"></a>Sleuth</h4><p>日志收集工具包，封装了Dapper和log-based追踪以及Zipkin和HTrace操作，为SpringCloud应用实现了一种分布式追踪解决方案。</p>
<h4 id="Data-Flow"><a href="#Data-Flow" class="headerlink" title="Data Flow"></a>Data Flow</h4><ul>
<li>Data flow 是一个用于开发和执行大范围数据处理其模式包括ETL，批量运算和持续运算的统一编程模型和托管服务。</li>
<li>对于在现代运行环境中可组合的微服务程序来说，Spring Cloud data flow是一个原生云可编配的服务。使用Spring Cloud data flow，开发者可以为像数据抽取，实时分析，和数据导入/导出这种常见用例创建和编配数据通道 （data pipelines）。</li>
<li>Spring Cloud data flow 是基于原生云对 spring XD的重新设计，该项目目标是简化大数据应用的开发。Spring XD 的流处理和批处理模块的重构分别是基于 Spring Boot的stream 和 task/batch 的微服务程序。这些程序现在都是自动部署单元而且他们原生的支持像 Cloud Foundry、Apache YARN、Apache Mesos和Kubernetes 等现代运行环境。</li>
<li>Spring Cloud data flow 为基于微服务的分布式流处理和批处理数据通道提供了一系列模型和最佳实践。</li>
</ul>
<h4 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h4><p>Spring Cloud Stream是创建消息驱动微服务应用的框架。Spring Cloud Stream是基于Spring Boot创建，用来建立单独的／工业级spring应用，使用spring integration提供与消息代理之间的连接。数据流操作开发包，封装了与Redis,Rabbit、Kafka等发送接收消息。</p>
<p>一个业务会牵扯到多个任务，任务之间是通过事件触发的，这就是Spring Cloud stream要干的事了</p>
<h4 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h4><p>Spring Cloud Task 主要解决短命微服务的任务管理，任务调度的工作，比如说某些定时任务晚上就跑一次，或者某项数据分析临时就跑几次。</p>
<h4 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h4><blockquote>
<p><code>ZooKeeper</code>是一个分布式的，开放源码的分布式应用程序协调服务，是Google的Chubby一个开源的实现，是<code>Hadoop</code>和<code>Hbase</code>的重要组件。它是一个为分布式应用提供一致性服务的软件，提供的功能包括：配置维护、域名服务、分布式同步、组服务等。<code>ZooKeeper</code>的目标就是封装好复杂易出错的关键服务，将简单易用的接口和性能高效、功能稳定的系统提供给用户。</p>
</blockquote>
<p>操作<code>Zookeeper</code>的工具包，用于使用<code>zookeeper</code>方式的服务发现和配置管理，抱了<code>Zookeeper</code>的大腿。</p>
<h4 id="Connectors"><a href="#Connectors" class="headerlink" title="Connectors"></a>Connectors</h4><blockquote>
<p>Spring Cloud Connectors 简化了连接到服务的过程和从云平台获取操作的过程，有很强的扩展性，可以利用Spring Cloud Connectors来构建你自己的云平台。</p>
<p>便于云端应用程序在各种<code>PaaS</code>平台连接到后端，如：数据库和消息代理服务。</p>
</blockquote>
<h4 id="Starters"><a href="#Starters" class="headerlink" title="Starters"></a>Starters</h4><blockquote>
<p>Spring Boot式的启动项目，为Spring Cloud提供开箱即用的依赖管理。</p>
</blockquote>
<h4 id="CLI"><a href="#CLI" class="headerlink" title="CLI"></a>CLI</h4><blockquote>
<p>基于 Spring Boot CLI，可以让你以命令行方式快速建立云组件。</p>
</blockquote>
<h2 id="Dalston版"><a href="#Dalston版" class="headerlink" title="Dalston版"></a>Dalston版</h2><h3 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>12<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring-cloud.version</span>&gt;</span>Dalston.SR1<span class="tag">&lt;/<span class="name">spring-cloud.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--eureka server --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-eureka-server</span><br><span class="line">    <span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.xml.bind<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxb-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun.xml.bind<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxb-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.glassfish.jaxb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxb-runtime<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.activation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- jaxb模块引用 - end --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Eureka-Service"><a href="#Eureka-Service" class="headerlink" title="Eureka Service"></a>Eureka Service</h3><h3 id="Zuul网关"><a href="#Zuul网关" class="headerlink" title="Zuul网关"></a>Zuul网关</h3><h5 id="路由规则"><a href="#路由规则" class="headerlink" title="路由规则"></a>路由规则</h5><blockquote>
<p>路由规则包含两部分，一部分是外部请求的匹配规则，另一部分是路由的服务ID</p>
</blockquote>
<h5 id="默认路由规则："><a href="#默认路由规则：" class="headerlink" title="默认路由规则："></a>默认路由规则：</h5><blockquote>
<p>当zuul网关启动并注册到服务中心之后，服务网关会在注册中心发现我们启动的两个服务，网关就会创建两个对应的路由规则</p>
</blockquote>
<h5 id="传统路由配置"><a href="#传统路由配置" class="headerlink" title="传统路由配置"></a>传统路由配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#单实例配置</span><br><span class="line">zuul.routes.&lt;route&gt;.path=/user-service/**</span><br><span class="line">zuul.routes.&lt;route&gt;.url=http://localhost:8080/</span><br><span class="line">-------------------------------------------</span><br><span class="line">#多实例配置</span><br><span class="line">zuul.routes.&lt;route&gt;.path=/user-service/**</span><br><span class="line">zuul.routes.&lt;route&gt;.serviceId=user-service</span><br><span class="line">#serviceID:用户手工命名的服务名称</span><br><span class="line"></span><br><span class="line">#ribbon.eureka.enabled：由于zuul.routes.&lt;route&gt;.serviceId指定的是服务名称，默认情况下Ribbon会根据服务发现机制来获取配置服务名对应的实例清单。但是，该示例并没有整合类似Eureka之类的服务治理框架，所以需要将该参数设置为false，不然配置的serviceId是获取不到对应实例清单的。</span><br><span class="line">ribbon.eureka.enabled=false</span><br><span class="line">#进行转发的时候实现负载均衡</span><br><span class="line">#对多个实例进行路由转发时需要实现负载均衡策略，并且Zuul中自带Ribbon依赖</span><br><span class="line">&lt;serviceId&gt;.ribbon.listOfServers=http://localhost:8080/,http://localhost:8081/</span><br></pre></td></tr></table></figure>

<h5 id="服务路由配置"><a href="#服务路由配置" class="headerlink" title="服务路由配置"></a>服务路由配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zuul.routes.&lt;route&gt;.path=/user-service/**</span><br><span class="line">zuul.routes.&lt;route&gt;.serviceId=user-service</span><br><span class="line">--------------------------------------------</span><br><span class="line">zuul.routes.&lt;route&gt;=/user-service/**</span><br></pre></td></tr></table></figure>

<h2 id="Finchley版"><a href="#Finchley版" class="headerlink" title="Finchley版"></a>Finchley版</h2><h3 id="配置环境-1"><a href="#配置环境-1" class="headerlink" title="配置环境"></a>配置环境</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--开启安全模块:spring.security.user.name进行配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>Finchley.SR2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Eureka-1"><a href="#Eureka-1" class="headerlink" title="Eureka"></a>Eureka</h3><h4 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server.port=8761</span><br><span class="line"></span><br><span class="line">#true：注册到defaultZone对应的server中，|是否将自己注册到server</span><br><span class="line">eureka.client.register-with-eureka=false</span><br><span class="line">#true：从server获取注册信息并缓存到本地 |是否从server获取注册信息</span><br><span class="line">eureka.client.fetch-registry=false</span><br><span class="line"></span><br><span class="line">logging.level.com.netflix.eureka=OFF</span><br><span class="line">logging.level.com.netflix.discovery=OFF</span><br></pre></td></tr></table></figure>

<p><code>Eureka</code>：一个<code>instane</code>通过<code>instanceId</code>来唯一标识，如果没有这个值就用<code>eureka.instance.metadataMap.instanceId</code>来代替</p>
<p><code>SpringCLoud</code>：默认值是<code>spring.application.name</code>，没有设置则为UNKNOWN</p>
<p><code>eureka.instance.instanceId</code>不设置时，直接使用缺省值(<code>client.hostname:appliation.name:port</code>)</p>
<h5 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br></pre></td></tr></table></figure>

<h5 id="失效剔除"><a href="#失效剔除" class="headerlink" title="失效剔除"></a>失效剔除</h5><p>默认每隔一段时间（默认60s）将当前清单中超时（默认90s）没有续约的服务剔除出去</p>
<h5 id="自我保护"><a href="#自我保护" class="headerlink" title="自我保护"></a>自我保护</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 自我保护机制：</span><br><span class="line"># Eureka Server在运行期间，会统计心跳失败的比例在15分钟之内是否低于85%，</span><br><span class="line"># 如果出现低于的情况（在单机调试的时候很容易满足，实际在生产环境上通常是由</span><br><span class="line"># 于网络不稳定导致），Eureka Server会将当前的实例注册信息保护起来，同时提示这个警告。</span><br><span class="line"># 关闭后，会在服务停止后大约3分钟，将服务剔除Eureka Server。</span><br><span class="line">eureka.server.enable-self-preservation=false</span><br></pre></td></tr></table></figure>

<h5 id="【未解决】-添加用户认证"><a href="#【未解决】-添加用户认证" class="headerlink" title="【未解决】*添加用户认证"></a>【未解决】*添加用户认证</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--开启安全认证--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">    security:</span></span><br><span class="line"><span class="attr">        user:</span></span><br><span class="line"><span class="attr">          name:</span> <span class="string">user</span></span><br><span class="line"><span class="attr">          password:</span> <span class="number">1234</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    service-url:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://user:1234@eureka-server2:8762/eureka/</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConf</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//spring cloud 2.0 默认启用csrf校验</span></span><br><span class="line">        http.csrf().disable();</span><br><span class="line">        <span class="keyword">super</span>.configure(http);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Eureka的元数据"><a href="#Eureka的元数据" class="headerlink" title="Eureka的元数据"></a>Eureka的元数据</h5><ul>
<li><p>标准元数据：主机名，IP地址，端口号，状态页，健康检查，这些信息被发布在服务注册表中，用于服务之间的调用</p>
</li>
<li><p>自定义元数据：eureka.instance.metadata-map配置。这些元数据可以在远程客户端中访问，但一般不会改变客户端的行为，除非客户端知道该元数据的含义</p>
</li>
</ul>
<h5 id="多网卡环境下的ip选择"><a href="#多网卡环境下的ip选择" class="headerlink" title="多网卡环境下的ip选择"></a>多网卡环境下的ip选择</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">	<span class="attr">cloud:</span></span><br><span class="line">		<span class="attr">inetutils:</span> </span><br><span class="line">            <span class="comment">#忽略指定名称的网卡</span></span><br><span class="line"><span class="attr">            ignored-interfaces:</span></span><br><span class="line"><span class="bullet">             -</span> <span class="string">docker0</span></span><br><span class="line"><span class="bullet">             -</span> <span class="string">veth.*</span></span><br><span class="line">            <span class="comment">#正则指定网络地址</span></span><br><span class="line"><span class="attr">            preferredNetworks:</span> </span><br><span class="line"><span class="bullet">            -</span> <span class="number">192.168</span></span><br><span class="line"><span class="bullet">            -</span> <span class="number">10.0</span></span><br><span class="line">            <span class="comment">#只使用站点本地地址</span></span><br><span class="line"><span class="attr">            useOnlySiteLocalInterfaces:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">eureka:</span> </span><br><span class="line">	<span class="attr">instance:</span> </span><br><span class="line">	<span class="comment">#将自己的ip注册到server，默认为false，会注册hostname到server</span></span><br><span class="line">		<span class="attr">prefer-ip-address:</span> <span class="literal">true</span></span><br><span class="line">		<span class="comment">#手动指定注册到server的微服务ip</span></span><br><span class="line">		<span class="attr">ip-address:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<h4 id="Server的高可用"><a href="#Server的高可用" class="headerlink" title="Server的高可用"></a>Server的高可用</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改主机host</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">eureka-server</span></span><br><span class="line"><span class="attr">  profiles:</span></span><br><span class="line"><span class="attr">    active:</span> <span class="string">dev3</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span> <span class="string">dev1</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8761</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    service-url:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://eureka-server2:8762/eureka/</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line"><span class="attr">    hostname:</span> <span class="string">eureka-server1</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span> <span class="string">dev2</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8762</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    service-url:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://eureka-server3:8763/eureka/</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line"><span class="attr">    hostname:</span> <span class="string">eureka-server2</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span> <span class="string">dev3</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8763</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    service-url:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://eureka-server1:8761/eureka/</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line"><span class="attr">    hostname:</span> <span class="string">eureka-server3</span></span><br></pre></td></tr></table></figure>

<h4 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h4><p>通过发送REST请求的方式将自己注册到Server上， 同时带上了自身服务的一些元数据信息，Server将元数据信息存储在一个双层Map中，其中第一层MapKey是服务名，第二层key是具体服务的实例名</p>
<h5 id="首次注册"><a href="#首次注册" class="headerlink" title="首次注册"></a>首次注册</h5><p>首次心跳在Client启动后的30s，在这之前，instance不会出现在注册中心</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    serviceUrl:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://localhost:8761/eureka/</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line">    <span class="comment">#将自己的ip注册到server，默认为false，会注册hostname到server</span></span><br><span class="line"><span class="attr">    prefer-ip-address:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8762</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line">  <span class="comment">#指定注册到server上的应用名称</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">service-hi</span></span><br></pre></td></tr></table></figure>

<h5 id="服务续约"><a href="#服务续约" class="headerlink" title="服务续约"></a>服务续约</h5><p>服务注册后，会维持一个心跳用来持续的告诉Server我还活着，防止被Server剔除任务“将服务实例从服务列表中排除出去。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#定义服务续约任务的调用间隔时间</span><br><span class="line">eureka.instance.lease-renewal-interval-in-seconds=30</span><br><span class="line">#定义服务失效的时间</span><br><span class="line">eureka.instance.lease-expiration-duration-in-seconds=90</span><br><span class="line"></span><br><span class="line">#从server获取注册信息并缓存到本地</span><br><span class="line">eureka.client.fetch-registry=true</span><br><span class="line">#增量获取信息，如果为false，则强制每次获取全部注册信息</span><br><span class="line">eureka.client.shouldDisableDelta=true</span><br><span class="line">#异步任务，如果操作失败，以2的指数形式延长重试时间</span><br><span class="line">#修改缓存清单的更新时间</span><br><span class="line">eureka.client.registry-fetch-interval-seconds=30</span><br><span class="line"></span><br><span class="line">#Eureka的自我保护机制</span><br><span class="line"> eureka.server.enable-self-preservation</span><br></pre></td></tr></table></figure>

<h5 id="服务注册"><a href="#服务注册" class="headerlink" title="服务注册"></a>服务注册</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="comment">//EnableDiscoveryClient为各种服务组件提供了支持，是一个spring-cloud-commons项目注解，高度抽象</span></span><br><span class="line"><span class="comment">//EnableEurekaCLient是Netflix项目中的注解，只能与Eureka一起工作，当用Eureka服务注册中心是没有区别</span></span><br></pre></td></tr></table></figure>

<p>启动的时候会通过发送REST请求的方式将自己注册到Server上，同时带上了自身服务的一些元数据信息</p>
<h5 id="服务下线"><a href="#服务下线" class="headerlink" title="服务下线"></a>服务下线</h5><p>当服务实例进行正常的关闭操作时，它会出发一个服务下线的REST请求给Server，告诉服务注册中心：我要下线了</p>
<h5 id="健康检查"><a href="#健康检查" class="headerlink" title="健康检查"></a>健康检查</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#更细粒度控制健康检查，实现HealthCheckHandler接口</span></span><br><span class="line"><span class="attr">eureka:</span> </span><br><span class="line">	<span class="attr">client:</span> </span><br><span class="line">		<span class="comment">#该配置只能配置在application中，配置在bootstrap中有副作用：应用注册到server上状态是unknown</span></span><br><span class="line">		<span class="attr">healthcheck:</span> </span><br><span class="line">			<span class="comment">#actuator的/pause端点会失效，无法标记服务为DOWN</span></span><br><span class="line">			<span class="attr">enable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h4 id="客户端和服务端区别"><a href="#客户端和服务端区别" class="headerlink" title="客户端和服务端区别"></a>客户端和服务端区别</h4><h5 id="客户端模式"><a href="#客户端模式" class="headerlink" title="客户端模式"></a>客户端模式</h5><p>进行微服务调用，首先到服务注册中心获取服务列表，根据调用段本地的负载均衡策略，进行服务调用</p>
<h5 id="服务端模式"><a href="#服务端模式" class="headerlink" title="服务端模式"></a>服务端模式</h5><p>调用方直接向服务注册中心进行请求，服务注册中心再通过自身负载均衡策略，对微服务进行调用。这个模式下，调用方不需要在自身节点维护服务发现逻辑以及服务注册信息，这个模式类似于DNS模式</p>
<table>
<thead>
<tr>
<th>客户端模式</th>
<th>服务端模式</th>
</tr>
</thead>
<tbody><tr>
<td>只需要周期性获取列表，在调用服务时可以注解调用，少了一个RT，但需要在每个客户端维护获取列表的逻辑</td>
<td>简单，不需要在客户端维护获取服务列表的逻辑</td>
</tr>
<tr>
<td>可用性高，即使注册中心故障也能正常工作</td>
<td>可用性由路由器中间件决定，路由中间件故障则所有服务不可用，同时，由于所有调度以及存储都由中间件服务器完成，中间件服务器可能会面临过高的负载</td>
</tr>
<tr>
<td>服务上下线对调用方有影响（会出现短暂的调用失败）</td>
<td>服务上下线调用方无感知</td>
</tr>
</tbody></table>
<h3 id="Ribbon-1"><a href="#Ribbon-1" class="headerlink" title="Ribbon"></a>Ribbon</h3><h5 id="客户端负载均衡器（Ribbon）"><a href="#客户端负载均衡器（Ribbon）" class="headerlink" title="客户端负载均衡器（Ribbon）"></a>客户端负载均衡器（Ribbon）</h5><p>服务实例的清单在客户端，客户端进行负载均衡算法</p>
<p>对HTTP和TCP客户端的行为进行大量控制</p>
<p><code>@FeignClient</code>：指定接口索要调用的服务名称</p>
<p>Ribbon通过向<code>ioc</code>注入<code>RestTemplate</code>，并通过<code>@LoadBalance</code>开启负载均衡</p>
<h5 id="服务端负载均衡（Nginx）"><a href="#服务端负载均衡（Nginx）" class="headerlink" title="服务端负载均衡（Nginx）"></a>服务端负载均衡（Nginx）</h5><p>服务实例的清单在服务端，服务器进行负载均衡算法分配</p>
<h5 id="消费时要在启动类注入Bean"><a href="#消费时要在启动类注入Bean" class="headerlink" title="消费时要在启动类注入Bean"></a>消费时要在启动类注入Bean</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerApplication</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * GetForObject反序列化需要Entity提供无参构造函数</span></span><br><span class="line"><span class="comment">	 * 否则报错</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//..psvm</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>##### </p>
<h5 id="自定义负载均衡策略"><a href="#自定义负载均衡策略" class="headerlink" title="自定义负载均衡策略"></a>自定义负载均衡策略</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySelfRule</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IRule <span class="title">myRule</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//return new RandomRule();// Ribbon默认是轮询，我自定义为随机</span></span><br><span class="line">        <span class="comment">//return new RoundRobinRule();// Ribbon默认是轮询，我自定义为随机</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RandomRule_ZY();<span class="comment">// 我自定义为每台机器5次</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//RandomRule_ZY继承AbstractLoadBalancerRule类，重写public Server choose(ILoadBalancer lb, Object key)即可。</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#NFLoadBalancerClassName:配置ILoadBalancer的实现类</span></span><br><span class="line"><span class="comment">#NFLoadBalancerRuleClassName：配置IRule的实现类</span></span><br><span class="line"><span class="comment">#NFLoadBalancerPingClassName：配置IPing的实现类</span></span><br><span class="line"><span class="comment">#NIWSServerListClassName：配置ServerList的实现类</span></span><br><span class="line"><span class="comment">#NIWSServerListFilterClassName：配置ServerListFilter的实现类</span></span><br><span class="line"></span><br><span class="line"><span class="attr">xxxxxxx:</span> <span class="comment">#服务名</span></span><br><span class="line">	<span class="attr">ribbon:</span> </span><br><span class="line">		<span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.netflix.loadbalancer.RandomRule</span> <span class="comment">#改为随机</span></span><br></pre></td></tr></table></figure>

<h3 id="Hystrix-1"><a href="#Hystrix-1" class="headerlink" title="Hystrix"></a>Hystrix</h3><h5 id="Fallback（失败快速返回）"><a href="#Fallback（失败快速返回）" class="headerlink" title="Fallback（失败快速返回）"></a><code>Fallback</code>（失败快速返回）</h5><p>当某个服务单元发生故障之后，通过断路器的故障监控，<strong>向调用方返回一个错误响应，而不是长时间的等待</strong>，这样就不会使得线程因调用故障服务被长时间占用不释放，避免了故障在分布式系统中的蔓延</p>
<h5 id="资源-依赖隔离（线程池隔离）"><a href="#资源-依赖隔离（线程池隔离）" class="headerlink" title="资源/依赖隔离（线程池隔离）"></a>资源/依赖隔离（线程池隔离）</h5><p>它会为每一个依赖服务创建一个独立的线程池，这也就算某个依赖服务出现延迟过高的情况，也只是对该依赖服务的调用产生影响，而不会拖慢其他的依赖服务</p>
<h5 id="Ribbon中应用熔断器"><a href="#Ribbon中应用熔断器" class="headerlink" title="Ribbon中应用熔断器"></a>Ribbon中应用熔断器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//启动类开启注解</span></span><br><span class="line"><span class="meta">@EnableHystrix</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//对方法创建熔断器</span></span><br><span class="line"><span class="meta">@HystrixCommand</span>(fallbackMethod=<span class="string">"aError"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> restTemplate.getForObject(<span class="string">".."</span>,String.class);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">aError</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"a error!"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Feign中应用熔断器"><a href="#Feign中应用熔断器" class="headerlink" title="Feign中应用熔断器"></a>Feign中应用熔断器</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#默认不打开，需要手动打开hystrix</span><br><span class="line">feign.hystrix.enabled=true</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient</span>(value = <span class="string">"service-hi"</span>,fallback = SchedualServiceHiHystric.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SchedualServiceHi</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/hi"</span>,method = RequestMethod.GET)</span><br><span class="line">    <span class="function">String <span class="title">sayHiFromClientOne</span><span class="params">(@RequestParam(value = <span class="string">"name"</span>)</span> String name)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SchedualServiceHiHystric</span> <span class="keyword">implements</span> <span class="title">SchedualServiceHi</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHiFromClientOne</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"sorry "</span>+name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Feign"><a href="#Feign" class="headerlink" title="Feign"></a>Feign</h3><p>声明式，模板化的HTTP客户端</p>
<h5 id="Feign整合了ribbon和RestTemplate"><a href="#Feign整合了ribbon和RestTemplate" class="headerlink" title="Feign整合了ribbon和RestTemplate"></a>Feign整合了ribbon和<code>RestTemplate</code></h5><!--重点：定义接口，接口根据URL获取服务列表中的服务，Crontroller调用接口即使用服务-->

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//启动类开启注解</span></span><br><span class="line"><span class="meta">@EnableFeignClient</span></span><br></pre></td></tr></table></figure>

<h5 id="服务绑定"><a href="#服务绑定" class="headerlink" title="服务绑定"></a>服务绑定</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// name\value ---&gt;指定调用哪个服务</span></span><br><span class="line">任意一个客户端名称，用于创建Ribbon负载均衡器，可以解析成服务，不用Eureka时也可以配置listOfServers属性配置服务器列表</span><br><span class="line"><span class="comment">// url可以是完整的URL地址或者主机名</span></span><br><span class="line"><span class="comment">// fallbackFactory---&gt;熔断器的降级提示</span></span><br><span class="line"><span class="meta">@FeignClient</span>(value = <span class="string">"MICROSERVICECLOUD-DEPT"</span>, fallbackFactory = DeptClientServiceFallbackFactory.class)</span><br></pre></td></tr></table></figure>

<h3 id="Zuul-1"><a href="#Zuul-1" class="headerlink" title="Zuul"></a>Zuul</h3><p>整合了Hystrix和Ribbon</p>
<ol>
<li>维护服务无状态的特点，实现对服务访问的权限控制</li>
<li>统一向外系统提供REST API</li>
<li>服务路由，均衡负载，权限控制</li>
</ol>
<p><code>@SpringCloudApplication</code>：整合了<code>@SpringBootApplication</code>、<code>@EnableDiscoveryClient</code>、<code>@EnableCircuitBreaker</code></p>
<h4 id="聚合服务"><a href="#聚合服务" class="headerlink" title="聚合服务"></a>聚合服务</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Finchley.SR2版zuul仅支持2.0.x的springboot-starter--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client</span><br><span class="line">    <span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix</span><br><span class="line">    <span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="网关"><a href="#网关" class="headerlink" title="网关"></a>网关</h4><h5 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-zuul</span><br><span class="line">    <span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">api-gateway</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">1101</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line"><span class="attr">    hostname:</span> <span class="string">localhost</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    serviceUrl:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://$&#123;eureka.instance.hostname&#125;:1001/eureka/</span></span><br></pre></td></tr></table></figure>

<h5 id="服务路由"><a href="#服务路由" class="headerlink" title="服务路由"></a>服务路由</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># routes to url</span></span><br><span class="line"><span class="string">zuul.routes.&lt;route&gt;.path=/url-api/**</span></span><br><span class="line"><span class="string">zuul.routes.&lt;route&gt;.url=http://localhost:2222/</span></span><br><span class="line"><span class="comment">#所有/url-api/的访问都会映射到http://localhost:2222/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#自动开启Ribbon负载均衡策略</span></span><br><span class="line"><span class="attr">zuul:</span></span><br><span class="line"><span class="attr">  routes:</span></span><br><span class="line"><span class="attr">    aggregation-client:</span> <span class="string">/message/**</span></span><br></pre></td></tr></table></figure>

<h5 id="服务过滤"><a href="#服务过滤" class="headerlink" title="服务过滤"></a>服务过滤</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//检查请求中是否有accessToken参数</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccessFilter</span> <span class="keyword">extends</span> <span class="title">ZuulFilter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger log = LoggerFactory.getLogger(AccessFilter.class);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**返回一个字符串代表过滤器类型</span></span><br><span class="line"><span class="comment">     * pre:可以在请求被路由之前调用</span></span><br><span class="line"><span class="comment">     * routing:在路由请求时候被调用</span></span><br><span class="line"><span class="comment">     * post:在routing和error过滤器之后被调用</span></span><br><span class="line"><span class="comment">     * error:处理请求时发生错误时被调用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">filterType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"pre"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//通过int值来定义过滤器的执行顺序</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">filterOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//返回一个boolean类型来判断该过滤器是否要执行，所以通过此函数可实现过滤器的开关。true:该过滤器总是生效</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> ZuulException </span>&#123;</span><br><span class="line">        RequestContext ctx = RequestContext.getCurrentContext();</span><br><span class="line">        HttpServletRequest request = ctx.getRequest();</span><br><span class="line"></span><br><span class="line">        log.info(String.format(<span class="string">"%s request to %s"</span>, request.getMethod(), request.getRequestURL().toString()));</span><br><span class="line"></span><br><span class="line">        Object accessToken = request.getParameter(<span class="string">"accessToken"</span>);</span><br><span class="line">        <span class="keyword">if</span>(accessToken == <span class="keyword">null</span>) &#123;</span><br><span class="line">            log.warn(<span class="string">"access token is empty"</span>);</span><br><span class="line">            <span class="comment">//过滤该请求，不对其进行路由</span></span><br><span class="line">            ctx.setSendZuulResponse(<span class="keyword">false</span>);</span><br><span class="line">            <span class="comment">//设置返回的错误码</span></span><br><span class="line">            ctx.setResponseStatusCode(<span class="number">401</span>);</span><br><span class="line">            <span class="comment">//对返回的body内容进行编辑</span></span><br><span class="line">            <span class="comment">//ctx.setResponseBody(body);</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">"access token ok"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//在应用主类中定义bean才会生效</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> AccessFilter <span class="title">accessFilter</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> AccessFilter();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Config-1"><a href="#Config-1" class="headerlink" title="Config"></a>Config</h3><h5 id="bootstrap"><a href="#bootstrap" class="headerlink" title="bootstrap"></a>bootstrap</h5><p>程序引导时执行，应用于更加早期配置信息读取</p>
<h5 id="application"><a href="#application" class="headerlink" title="application"></a>application</h5><p>应用程序特有配置信息</p>
<p>bootstrap先于application加载</p>
<h4 id="Server-1"><a href="#Server-1" class="headerlink" title="Server"></a>Server</h4><h5 id="git调用远程仓库"><a href="#git调用远程仓库" class="headerlink" title="git调用远程仓库"></a>git调用远程仓库</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#写在bootstrap里</span></span><br><span class="line"><span class="string">spring</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">config-server</span></span><br><span class="line"><span class="attr">  cloud:</span></span><br><span class="line"><span class="attr">    config:</span></span><br><span class="line"><span class="attr">      server:</span></span><br><span class="line"><span class="attr">        git:</span></span><br><span class="line"><span class="attr">          uri:</span> <span class="attr">http://git.oschina.net/&lt;config</span> <span class="string">repository&gt;/</span></span><br><span class="line"><span class="attr">          username:</span> <span class="string">xxxx</span></span><br><span class="line"><span class="attr">          password:</span> <span class="string">xxxx</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">1201</span></span><br></pre></td></tr></table></figure>

<h5 id="读取本地文件"><a href="#读取本地文件" class="headerlink" title="读取本地文件"></a>读取本地文件</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span></span><br><span class="line"><span class="attr">    active:</span> <span class="string">native</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">config-server</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">1201</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line"><span class="attr">    hostname:</span> <span class="string">config-server1</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    service-url:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://eureka-server1:8761/eureka/</span></span><br></pre></td></tr></table></figure>

<h4 id="Client-1"><a href="#Client-1" class="headerlink" title="Client"></a>Client</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">eureka-client</span></span><br><span class="line"><span class="attr">  cloud:</span></span><br><span class="line"><span class="attr">    config:</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">config-eureka-client</span></span><br><span class="line"><span class="attr">      profile:</span> <span class="string">dev</span></span><br><span class="line">      <span class="comment">#指定地址去获取值</span></span><br><span class="line">      <span class="comment">#uri: http://</span></span><br><span class="line"><span class="attr">      label:</span> <span class="string">master</span></span><br><span class="line">      <span class="comment">#从注册中心的服务名称，去获取值</span></span><br><span class="line"><span class="attr">      discovery:</span></span><br><span class="line"><span class="attr">        enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">        service-id:</span> <span class="string">config-server</span></span><br><span class="line"><span class="attr">      git:</span></span><br><span class="line"><span class="attr">        basedir:</span> <span class="string">config-repo</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line"><span class="attr">    hostname:</span> <span class="string">eureka-client1</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    service-url:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://eureka-server1:8761/eureka/</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">1001</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="引用BUS自动刷新"><a href="#引用BUS自动刷新" class="headerlink" title="引用BUS自动刷新"></a>引用BUS自动刷新</h4><h5 id="增加依赖"><a href="#增加依赖" class="headerlink" title="增加依赖"></a>增加依赖</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//F版本必须对应SpringBoot2.0.x</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bus-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="增加配置"><a href="#增加配置" class="headerlink" title="增加配置"></a>增加配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">## 刷新时，关闭安全验证</span><br><span class="line">management.security.enabled=false</span><br><span class="line">## 开启消息跟踪</span><br><span class="line">spring.cloud.bus.trace.enabled=true</span><br><span class="line"></span><br><span class="line">spring.rabbitmq.host=localhost</span><br><span class="line">spring.rabbitmq.port=5672</span><br><span class="line">spring.rabbitmq.username=guest</span><br><span class="line">spring.rabbitmq.password=guest</span><br></pre></td></tr></table></figure>

<h5 id="在需要更新的控制类上添加"><a href="#在需要更新的控制类上添加" class="headerlink" title="在需要更新的控制类上添加"></a>在需要更新的控制类上添加</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RefreshScope</span><span class="comment">//添加该注解的类会在配置更改时得到特殊的处理</span></span><br></pre></td></tr></table></figure>

<h1 id="分布式"><a href="#分布式" class="headerlink" title="分布式"></a>分布式</h1><p>内部的一些核心服务，性能要求比较高的可以采用RPC，对外服务的一般可以采用REST</p>
<h2 id="模式"><a href="#模式" class="headerlink" title="模式"></a>模式</h2><h3 id="SOA–面向消息"><a href="#SOA–面向消息" class="headerlink" title="SOA–面向消息"></a>SOA–面向消息</h3><p>–&gt; Service-Oriented Architecture：面向服务的架构</p>
<p>包含多个服务，服务之间通过相互依赖最终提供一系列的功能，一个服务通常以独立的形式存在与操作系统进程中。各个服务之间通过网络调用</p>
<h2 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h2><h3 id="RPC–面向过程"><a href="#RPC–面向过程" class="headerlink" title="RPC–面向过程"></a>RPC–面向过程</h3><p>–&gt; Remote Procedure Call Protocol：远程过程调用协议</p>
<p>通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的协议</p>
<ol>
<li>解决服务之间的调用问题</li>
<li>服务之间调用要像本地调用一样方便</li>
<li>一般都架在TCP/IP协议上</li>
</ol>
<h5 id="RPC是分布式架构的核心"><a href="#RPC是分布式架构的核心" class="headerlink" title="RPC是分布式架构的核心"></a>RPC是分布式架构的核心</h5><p>响应式划分：</p>
<ul>
<li><p>同步调用：客户端调用服务方方法，等待直到服务方返回结果或者超时，再继续自己的操作</p>
<p><code>WebService</code>/<code>RMI</code></p>
</li>
<li><p>异步调用：客户端把消息发送给中间件，不再等待服务端返回，直接继续自己的操作</p>
<p><code>JMS</code>中间件：<code>ActiveMQ</code>，<code>Kafka</code>，<code>RocketMQ</code></p>
</li>
</ul>
<h5 id="RPC优点"><a href="#RPC优点" class="headerlink" title="RPC优点"></a>RPC优点</h5><ol>
<li>TCP不用经过3次握手，减少了网络开销</li>
</ol>
<h3 id="RESTful–面向资源"><a href="#RESTful–面向资源" class="headerlink" title="RESTful–面向资源"></a>RESTful–面向资源</h3><blockquote>
<p>Representation State Transfer：表述性状态传递，软件架构风格</p>
<p>通过HTTP协议定义的通用方法（GET，PUT，DELETE，POST），以URI对网络资源进行唯一标识，响应端根据请求端的不同需求，通过无状态通信，对其请求的资源进行表述</p>
</blockquote>
<h5 id="REST架构的主要原则"><a href="#REST架构的主要原则" class="headerlink" title="REST架构的主要原则"></a>REST架构的主要原则</h5><ol>
<li>网络上的所有事物都被抽象为资源</li>
<li>每个资源都有一个唯一的资源标识符</li>
<li>同一个资源具有多种表现形式（xml，json等）</li>
<li>对资源的各种操作不会改变资源标识符</li>
<li>所有的操作都是无状态的</li>
</ol>
<h5 id="无状态通信"><a href="#无状态通信" class="headerlink" title="无状态通信"></a>无状态通信</h5><p>无状态增强了系统的拓展性</p>
<blockquote>
<p>服务端不保存任何与特定HTTP请求相关的资源，应用状态必须由请求放在请求过程中提供。</p>
<p>要求在网络通信过程中，任意一个Web请求必须<strong>与其他请求隔离</strong>，当请求端提出请求时，请求本身包含了响应端为响应这一请求所需的全部信息</p>
</blockquote>
<h5 id="RESTful用法"><a href="#RESTful用法" class="headerlink" title="RESTful用法"></a>RESTful用法</h5><ul>
<li>GET：查询  幂等  安全</li>
<li>POST：增加  不幂等  不安全</li>
<li>PUT：修改  幂等  不安全</li>
<li>DELETE：删除  幂等  不安全</li>
</ul>
<p>幂等性：对同一REST接口进行多次访问，得到的资源状态是相同的</p>
<p>安全性：对该REST接口访问，不会使服务器端资源的状态发生改变</p>
<h4 id="REST三要素"><a href="#REST三要素" class="headerlink" title="REST三要素"></a>REST三要素</h4><ol>
<li>唯一的资源标识</li>
<li>简单的方法</li>
<li>一定的表达方式</li>
</ol>
<h3 id="SOAP–简单对象访问协议"><a href="#SOAP–简单对象访问协议" class="headerlink" title="SOAP–简单对象访问协议"></a>SOAP–简单对象访问协议</h3><p>–&gt; Simple Object Access Protocol：简单对象访问协议</p>
<ol>
<li>分布式环境的，轻量级的，基于XML进行信息交换的通信协议</li>
<li>可以在任何传输协议上使用</li>
<li>SOAP=RPC+HTTP+XML</li>
</ol>
<h5 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h5><ol>
<li>SOAP协议对于消息体和消息头都有定义，规范，安全</li>
<li>由于各种需求不断扩充其本身协议的内容，导致SOAP处理方面的性能有所下降，</li>
<li>SOAP也是基于HTTP协议，但是提供了session，cookie机制使得SOAP有状态，从而支持需要有状态的业务</li>
</ol>
<h3 id="XML-RPC"><a href="#XML-RPC" class="headerlink" title="XML-RPC"></a>XML-RPC</h3><p>一个远程过程调用的分布式计算协议</p>
<p>通过XML将调用函数封装，并使用HTTP协议作为传送机制</p>
<h2 id="接口设计"><a href="#接口设计" class="headerlink" title="接口设计"></a>接口设计</h2><h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><blockquote>
<p>应用程序编程接口</p>
<p>预先定义的函数，目的是作为”介面“沟通两个不同的东西，提供应用程序与开发人员基于某软件或硬件得以访问一组例程的能力，而又无需访问源码，或理解内部工作机制的细节</p>
</blockquote>
<h3 id="SDK"><a href="#SDK" class="headerlink" title="SDK"></a>SDK</h3><blockquote>
<p>软件开发工具包</p>
<p>被软件工程师用于为特定的软件包，软件框架，硬件平台，操作系统等建立应用软件的开发工具的集合。通俗点是指由第三方服务商提供的实现软件产品某项功能的工具包</p>
</blockquote>
<h3 id="SDK和API的区别"><a href="#SDK和API的区别" class="headerlink" title="SDK和API的区别"></a>SDK和API的区别</h3><p>SDK相当于开发集成工具环境，API就是数据接口。在SDK环境下调用API数据</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/03/MQ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PPCoder">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/author.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/03/MQ/" itemprop="url">MQ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-03T13:18:33+08:00">
                2019-10-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h3 id="消息队列"><a href="#消息队列" class="headerlink" title="消息队列"></a>消息队列</h3><p>把需要的数据放到队列里（生产者），消费者去队列里消费</p>
<h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><ol>
<li>解耦</li>
<li>异步</li>
<li>削峰/限流</li>
</ol>
<h4 id="消费者获取数据"><a href="#消费者获取数据" class="headerlink" title="消费者获取数据"></a>消费者获取数据</h4><ul>
<li>PUSH：生产者将数据放到消息队列中，消息队列有数据了，主动叫消费者去拿</li>
<li>PULL：消费者不断轮询消息队列，看看有没有新的数据，如果有就消费</li>
</ul>
<h4 id="改进"><a href="#改进" class="headerlink" title="改进"></a>改进</h4><ol>
<li>高可用：集群/分布式</li>
<li>数据丢失：数据持久化</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/03/SpringBoot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PPCoder">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/author.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/03/SpringBoot/" itemprop="url">SpringBoot笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-03T13:18:33+08:00">
                2019-10-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h2 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h2><p>SpringBoot思想：约定大于配置</p>
<h3 id="什么是SpringBoot"><a href="#什么是SpringBoot" class="headerlink" title="什么是SpringBoot"></a>什么是SpringBoot</h3><blockquote>
<p>SpringBoot是一个框架，一种全新的编程规范，他的产生简化了框架的使用，所谓简化是指简化了Spring众多框架中所需的大量且繁琐的配置文件，所以 SpringBoot是一个服务于框架的框架，服务范围是简化配置文件。</p>
</blockquote>
<h3 id="SpringBoot和Spring的区别"><a href="#SpringBoot和Spring的区别" class="headerlink" title="SpringBoot和Spring的区别"></a>SpringBoot和Spring的区别</h3><ol>
<li>自动配置</li>
<li>使用注解</li>
<li>内置Tomcat，Jetty或Undertow</li>
</ol>
<h3 id="SpringBoot的starter模块"><a href="#SpringBoot的starter模块" class="headerlink" title="SpringBoot的starter模块"></a>SpringBoot的starter模块</h3><p><code>spring-boot-starter</code>：包括自动配置支持，日志和YAML</p>
<p><code>spring-boot-starter-web</code>：自动依赖<code>spring-boot-starter</code></p>
<p><code>spring-boot-starter-test</code>：测试模块，包括JUint，Hamcrest、Mockito。</p>
<p><code>spring-boot-starter-thymeleaf</code>：html模板</p>
<p><code>spring-boot-starter-data-jpa</code>:</p>
<p><code>spring-boot-starter-security</code>:</p>
<p><code>spring-boot-starter-actuator</code>：监控模块</p>
<h2 id="自动配置"><a href="#自动配置" class="headerlink" title="自动配置"></a>自动配置</h2><h3 id="自动配置的原理"><a href="#自动配置的原理" class="headerlink" title="自动配置的原理"></a>自动配置的原理</h3><h3 id="读取配置文件的方式"><a href="#读取配置文件的方式" class="headerlink" title="读取配置文件的方式"></a>读取配置文件的方式</h3><h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><p><code>@Controller</code>：类级别，控制器注解，返回ViewAndModel</p>
<p><code>@RestController</code>：类级别，控制器注解，返回json格式，包含@Controller和@ResponseBody</p>
<p><code>@Request Mapping</code>：方法级别，映射注解</p>
<p><code>@EnableAutoConfiguration</code>：类级别，根据添加的jar依赖猜测你想如何配置Spring</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(ElementType.TYPE)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*AutoConfigurationImportSelector</span></span><br><span class="line"><span class="comment"> *将所有符合条件的@Confident配置都加载到当前IoC容器</span></span><br><span class="line"><span class="comment"> *SpringFactoriesLoader.loadFactoryNames()</span></span><br><span class="line"><span class="comment"> *把</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Import</span>(AutoConfigurationImportSelector.class)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123;</span><br><span class="line">    String ENABLED_OVERRIDE_PROPERTY = <span class="string">"spring.boot.enableautoconfiguration"</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] exclude() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    String[] excludeName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@SpringBootApplication</code>：类级别，根据maven依赖的jar来自动猜测完成正确的spring的对应配置，只要引入了spring-boot-starter-web的依赖，默认会自动配置Spring MVC和tomcat容器<br>@Configuration类级别的注解，一般这个注解，我们用来标识main方法所在的类,完成元数据bean的初始化。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementType.TYPE&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span> <span class="comment">//应用了@Configuration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(</span><br><span class="line">    excludeFilters = &#123;<span class="meta">@Filter</span>(</span><br><span class="line">    type = FilterType.CUSTOM,</span><br><span class="line">    classes = &#123;TypeExcludeFilter.class&#125;</span><br><span class="line">), <span class="meta">@Filter</span>(</span><br><span class="line">    type = FilterType.CUSTOM,</span><br><span class="line">    classes = &#123;AutoConfigurationExcludeFilter.class&#125;</span><br><span class="line">)&#125;</span><br><span class="line">)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@ComponentScan：类级别，自动扫描加载所有的Spring组件包括Bean注入，一般用在main方法所在的类上 </p>
<p>@ImportResource：类级别，当我们必须使用一个xml的配置时，使用@ImportResource和@Configuration来标识这个文件资源的类。 </p>
<h2 id="WebJars"><a href="#WebJars" class="headerlink" title="WebJars"></a>WebJars</h2><blockquote>
<p>将客户端资源（js，css等前端资源）打包成Jar文件，以对资源进行统一依赖管理。WebJars的Jar包部署在Maven中央仓库上。</p>
</blockquote>
<h2 id="数据持久层"><a href="#数据持久层" class="headerlink" title="数据持久层"></a>数据持久层</h2><h3 id="集成Mybatis"><a href="#集成Mybatis" class="headerlink" title="集成Mybatis"></a>集成Mybatis</h3><h4 id="数据源配置"><a href="#数据源配置" class="headerlink" title="数据源配置"></a>数据源配置</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span> <span class="string">dev</span></span><br><span class="line">  <span class="comment"># 数据源配置</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="number">1234</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:mysql://127.0.0.1:3306/singlemessagedemo?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=UTC</span></span><br></pre></td></tr></table></figure>

<h4 id="扫描组件"><a href="#扫描组件" class="headerlink" title="扫描组件"></a>扫描组件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*springboot自动加载datasource配置</span></span><br><span class="line"><span class="comment"> *数据源会自动注入到sqlSessionFactory中</span></span><br><span class="line"><span class="comment"> *sqlSessionFactory会自动注入到Mapper中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mapper</span><span class="comment">//自动注入，在每个Mapper类上添加</span></span><br><span class="line"><span class="meta">@MapperScan</span>()<span class="comment">//扫描注入，在启动类中添加</span></span><br></pre></td></tr></table></figure>

<h4 id="开发Mapper"><a href="#开发Mapper" class="headerlink" title="开发Mapper"></a>开发Mapper</h4><p>@Select，@Insert，@Delete，@Update是增删查改的注解</p>
<p>@Result：修饰返回的结果集，映射实体类和数据库字段，property，column，javaType</p>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/02/Spring/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PPCoder">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/author.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/02/Spring/" itemprop="url">Spring觉得重要的一些点</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-02T10:51:25+08:00">
                2019-10-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><h2 id="IOC"><a href="#IOC" class="headerlink" title="IOC"></a>IOC</h2><p>构造器注入（实现了松耦合）：在构造的时候把任务作为构造器参数注入</p>
<p>装配：创建应用组件之间协作的行为</p>
<h2 id="bean"><a href="#bean" class="headerlink" title="bean"></a>bean</h2><h3 id="自动化装配"><a href="#自动化装配" class="headerlink" title="自动化装配"></a>自动化装配</h3><blockquote>
<ul>
<li>组件扫描(Component scanning)</li>
<li>自动装配(Autowiring)</li>
</ul>
</blockquote>
<h4 id="组件扫描"><a href="#组件扫描" class="headerlink" title="组件扫描"></a>组件扫描</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span><span class="comment">//定义组件</span></span><br><span class="line"><span class="meta">@ComponentScan</span><span class="comment">//开启扫描</span></span><br><span class="line"><span class="meta">@Configuration</span><span class="comment">//定义配置文件,默认当前包内</span></span><br><span class="line"></span><br><span class="line">componentScan(basePackages=&#123;<span class="string">"soundsystem"</span>,<span class="string">"knight"</span>&#125;)<span class="comment">//多个包</span></span><br><span class="line">componentScan(basePackageClasses=&#123;CDPlayer.class,DVDPlayer.class&#125;)<span class="comment">//指定一个或多个类和接口</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//启用扫描</span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"main.example.soundsystem"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="自动装配"><a href="#自动装配" class="headerlink" title="自动装配"></a>自动装配</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* autowired注解会尝试满足方法参数上所声明的依赖</span></span><br><span class="line"><span class="comment">* 如果只有一个bean匹配依赖需求，那么这个bean会被装配进来</span></span><br><span class="line"><span class="comment">* 如果没有匹配的bean，那么在应用上下文创建的时候，spring会抛出异常</span></span><br><span class="line"><span class="comment">* Autowired(required=false)不强制进行封装的话，最好进行null检查，防止nullPointerException</span></span><br><span class="line"><span class="comment">* 如果有多个bean满足依赖关系，spring会抛出异常，表明没有明确指定要选择的bean</span></span><br><span class="line"><span class="comment">* inject和autowired在大多数场景下没有区别，inject是java依赖注入规范，autowired是spring特有的</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CDPlayer</span><span class="params">(CompactDisc cd)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.cd = cd;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="java装配-显示装配"><a href="#java装配-显示装配" class="headerlink" title="java装配(显示装配)"></a>java装配(显示装配)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span>(name=<span class="string">"Pepper"</span>)<span class="comment">//默认id=sgtPeppers</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CompactDisc <span class="title">sgtPeppers</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> SgtPeppers();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> cdPlayer <span class="title">cdPlayer</span><span class="params">(CompactDisc com)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> CDPlyaer(com);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="XML装配"><a href="#XML装配" class="headerlink" title="XML装配"></a>XML装配</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"compactDisc"</span> <span class="attr">class</span>=<span class="string">"main.example.soundsystem.SqtPeppers"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h2><blockquote>
<p>面向切面编程往往被定义为<strong>促使软件系统实现关注点的分离</strong>一项技 术。系统由许多不同的组件组成，每一个组件各负责一块特定功能。 除了实现自身核心的功能之外，这些组件还经常承担着额外的职责。 诸如日志、事务管理和安全这样的系统服务经常融入到自身具有核心 业务逻辑的组件中去，这些系统服务通常被称为横切关注点，因为它 们会跨越系统的多个组件。</p>
</blockquote>
<p>AOP（面向切面编程），切面，即功能组件。</p>
<blockquote>
<p>实现系统关注点功能的代码将会重复出现在多个组件中。这意味 着如果你要改变这些关注点的逻辑，必须修改各个模块中的相关 实现。即使你把这些关注点抽象为一个独立的模块，其他模块只 是调用它的方法，但方法的调用还是会重复出现在各个模块中。 组件会因为那些与自身核心业务无关的代码而变得混乱。一个向 地址簿增加地址条目的方法应该只关注如何添加地址，而不应该 关注它是不是安全的或者是否需要支持事务。</p>
</blockquote>
<p>解决的问题：1.实现系统关注点的代码会重复出现在多个组件中。2.组件需要关注与自身核心业务无关的代码。</p>
<blockquote>
<p>AOP能够使这些服务模块化，并以声明的方式将它们应用到它们需要 影响的组件中去。所造成的结果就是这些组件会具有更高的内聚性并 且会更加关注自身的业务，完全不需要了解涉及系统服务所带来复杂 性。</p>
</blockquote>
<p><strong>Spring在运行时通知对象：</strong></p>
<p>在加载所有bean的时候，Spring才会创建被代理的对象</p>
<p><strong>Spring只支持方法级别的连接点：</strong></p>
<p>Spring缺少对字段连接点的支持，无法让我们创建细粒度的而通知，也不支持构造器连接点</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//xml形式</span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span>&gt;</span>//切面要引用bean</span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:before</span>&gt;</span>//后置通知</span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:after</span>&gt;</span>//前置通知</span><br><span class="line">    	<span class="tag">&lt;<span class="name">pointcut-ref</span>&gt;</span>//引用切入点</span><br><span class="line">	<span class="tag">&lt;<span class="name">pointcut</span>&gt;</span>//切入点</span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>//定义切入点</span><br><span class="line">        <span class="tag">&lt;<span class="name">expression</span>&gt;</span>//选择所应用的通知</span><br></pre></td></tr></table></figure>

<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><ul>
<li>通知：描述切面的工作，也定义了执行工作的时间</li>
<li>连接点：应用执行过程中能够插入切面的一个点，可以是一个方法，异常，甚至修改字段。</li>
<li>切点：通知被应用的具体位置，即哪些连接点会得到通知</li>
<li>切面：切面是通知和切点的结合</li>
<li>引入：无需修改现有的类的情况下，让他们具有新的行为和状态</li>
<li>织入：切面应用到目标对象并创建新的代理对象的过程</li>
</ul>
<h3 id="通知类型"><a href="#通知类型" class="headerlink" title="通知类型"></a>通知类型</h3><ul>
<li><p>Before：前置通知。在目标方调用前调用通知功能</p>
</li>
<li><p>After：后置通知。完成之后调用通知，此时不会关心方法的输出是什么</p>
</li>
<li><p>After-returning：返回通知。成功执行之后调用</p>
</li>
<li><p>After-throwing：异常通知。抛出异常之后调用</p>
</li>
<li><p>Aroud：环绕通知。调用之前和调用之后执行自定义行为</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Audience</span></span>&#123;</span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(** concert.Performance.perform(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">performance</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Around</span>(<span class="string">"performance()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">watchPerformance</span><span class="params">(ProceedingJoinPoint jp)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            print(<span class="string">"1"</span>);<span class="comment">//前置通知</span></span><br><span class="line">            jp.proceed();<span class="comment">//运行方法</span></span><br><span class="line">            print(<span class="string">"2"</span>);<span class="comment">//后置通知</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Throwabl e)&#123;</span><br><span class="line">            print(<span class="string">"3"</span>);<span class="comment">//异常通知</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="AspectJ注解"><a href="#AspectJ注解" class="headerlink" title="AspectJ注解"></a>AspectJ注解</h3><p>@DeclareParents：将接口引入方法中</p>
<ul>
<li>value：指定引入bean的类型</li>
<li>defaultImpl：为引入功能提供实现的类</li>
</ul>
<p>@Pointcut：定义切入点</p>
<ul>
<li>returning：用以定义通知中与此同名的形参，用于访问目标方法的返回值</li>
</ul>
<h2 id="Spring容器"><a href="#Spring容器" class="headerlink" title="Spring容器"></a>Spring容器</h2><blockquote>
<p>beanFactory：提供基本的DI支持</p>
<p>ApplicationContext：基于beanFactory构建，提供应用框架级别的服务。例如从属性文本解析文本信息以及发布应用事件给感兴趣的事件监听者。</p>
</blockquote>
<h3 id="应用上下文"><a href="#应用上下文" class="headerlink" title="应用上下文"></a>应用上下文</h3><ul>
<li>AnnotationConfigApplicationContext：从一个或多个 基于Java的配置类中加载<strong>Spring</strong>应用上下文。<br><code>ApplicationContext context = new AnnotationConfigApplicationContext(main.example.knights.KnightConfig.class);</code></li>
<li>AnnotationConfigWebApplicationContext：从一个或 多个基于Java的配置类中加载<strong>Spring Web</strong>应用上下文。 </li>
<li>ClassPathXmlApplicationContext：从<strong>类路径</strong>下的一个或 多个XML配置文件中加载上下文定义，把应用上下文的定义文件 作为类资源。<br><code>ApplicationContext context = new ClassPathXmlApplicationContext(&quot;knight.xml&quot;);</code></li>
<li>FileSystemXmlapplicationcontext：从<strong>文件系统</strong>下的一 个或多个XML配置文件中加载上下文定义。<br><code>ApplicationContext context = new FileSystemXmlapplicationcontext(&quot;C:/knight.xml&quot;);</code></li>
<li>XmlWebApplicationContext：从<strong>Web应用</strong>下的一个或多个 XML配置文件中加载上下文定义。</li>
</ul>
<h3 id="bean生命周期"><a href="#bean生命周期" class="headerlink" title="bean生命周期"></a>bean生命周期</h3><blockquote>
<p>1．Spring对bean进行实例化；</p>
<p>2．Spring将值和bean的引用注入到bean对应的属性中；</p>
<p>3．如果bean实现了BeanNameAware接口，Spring将bean的ID传递给 setBean-Name()方法；</p>
<p>4．如果bean实现了BeanFactoryAware接口，Spring将调 用setBeanFactory()方法，将BeanFactory容器实例传入；</p>
<p>5．如果bean实现了ApplicationContextAware接口，Spring将调 用setApplicationContext()方法，将bean所在的应用上下文的 引用传入进来；</p>
<p>6．如果bean实现了BeanPostProcessor接口，Spring将调用它们 的post-ProcessBeforeInitialization()方法；</p>
<p>7．如果bean实现了InitializingBean接口，Spring将调用它们的 after-PropertiesSet()方法。类似地，如果bean使用initmethod声明了初始化方法，该方法也会被调用；</p>
<p>8．如果bean实现了BeanPostProcessor接口，Spring将调用它们 的post-ProcessAfterInitialization()方法；</p>
<p>9．此时，bean已经准备就绪，可以被应用程序使用了，它们将一直 驻留在应用上下文中，直到该应用上下文被销毁；</p>
<p>10．如果bean实现了DisposableBean接口，Spring将调用它的 destroy()接口方法。同样，如果bean使用destroy-method声明 了销毁方法，该方法也会被调用。</p>
</blockquote>
<h2 id="Spring生态"><a href="#Spring生态" class="headerlink" title="Spring生态"></a>Spring生态</h2><h2 id="Spring-MVC"><a href="#Spring-MVC" class="headerlink" title="Spring MVC"></a>Spring MVC</h2><h3 id="请求处理追踪"><a href="#请求处理追踪" class="headerlink" title="请求处理追踪"></a>请求处理追踪</h3><p>DispatcherServlet（前端控制器）：将请求发送给springmvc控制器 </p>
<p>–&gt;handler mapping(处理器映射)：查询一个或多个处理器映射来确定下一站在哪里（根据请求携带的URL信息来进行决策）</p>
<p>–&gt;Controller：处理请求的spring组件（尽量将业务委托给一个或者多个服务对象进行处理），返回一个逻辑名称</p>
<p>–&gt;view resolver（视图解析器）：匹配特定的视图实现</p>
<p>–&gt;model：以用户友好的方式进行格式化</p>
<p>–&gt;view：使用模型数据渲染输出</p>
<h4 id="配置DispatcherServlet"><a href="#配置DispatcherServlet" class="headerlink" title="配置DispatcherServlet"></a>配置DispatcherServlet</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpitterWebAppInitializer</span> <span class="keyword">extends</span> <span class="title">AbstractAnnotationConfigDispatcherServletInitializer</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将一个或多个路径映射到DispatcherServlet上</span></span><br><span class="line">    <span class="keyword">public</span> String[] getServletMapping()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String[] (<span class="string">"/"</span>);<span class="comment">//应用默认Servlet</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//配置ContextLoaderListener创建的应用上下文中的bean：驱动应用后端的中间层和数据层文件</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Class&lt;?&gt;[](RootConfig.class);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//DispaerServlet加载应用上下文时，使用定义的WebConfig配置类中bean：Web组件的bean（控制器，视图解析器以及处理器映射）</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Class&lt;?&gt;[](WebConfig.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="启用SpringMVC"><a href="#启用SpringMVC" class="headerlink" title="启用SpringMVC"></a>启用SpringMVC</h4><h5 id="WebConfig-class"><a href="#WebConfig-class" class="headerlink" title="WebConfig.class"></a>WebConfig.class</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"spitter.web"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//配置jsp视图解析器</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ViewResolver <span class="title">viewResolver</span><span class="params">()</span></span>&#123;</span><br><span class="line">        InternalResourceViewResolver resolver = </span><br><span class="line">            <span class="keyword">new</span> InternalResourceViewResolver();</span><br><span class="line">        resolver.setPrefix(<span class="string">"/WEB_INF/views"</span>);</span><br><span class="line">        resolver.setSuffix(<span class="string">".jsp"</span>);</span><br><span class="line">        resolver.setExposeContextBeansAsAttributes(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> resolver;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//配置静态资源的处理</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">configureDefaultServletHandling</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        DefaultServletHandlerConfigurer)</span></span>&#123;</span><br><span class="line">        configurer.enable();<span class="comment">//对静态资源的请求转发到Servlet容器默认的Servlet上，而不是使用DispaterSerlvet本身来处理此类请求</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="RootConfig-class"><a href="#RootConfig-class" class="headerlink" title="RootConfig.class"></a>RootConfig.class</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages=&#123;<span class="string">"spitter"</span>&#125;,</span><br><span class="line">	excludeFilters=&#123;</span><br><span class="line">        <span class="meta">@Filter</span>(type=FilterType.ANNOTATION,value=EnableWebMvc.class)</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RootConfig</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=&#123;<span class="string">"/"</span>,<span class="string">"homepage"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HomeController</span></span>&#123;</span><br><span class="line">	<span class="meta">@RequestMapping</span>(method=GET)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"home"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//显示声明模型</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">contacts1</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line">	model.addAttribute(<span class="string">"contactsList"</span>,</span><br><span class="line">		contactRepository.findContacts(Long.MAX_VALUE,<span class="number">20</span>));</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"contacts"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//非Spring类型</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">contacts2</span><span class="params">(Map map)</span></span>&#123;</span><br><span class="line">    model.addAttribute(<span class="string">"contactsList"</span>,</span><br><span class="line">		contactRepository.findContacts(Long.MAX_VALUE,<span class="number">20</span>));</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"contacts"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//返回对象和集合时，这个值会被放到模型</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Contact&gt;contacts3()&#123;</span><br><span class="line">    <span class="keyword">return</span> contactRepository.findContacts(Long.MAX_VALUE,<span class="number">20</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//模型中会存储一个contacts列表，key为contactsList，然后这个列表会发送到名为contacts的视图中。</span></span><br><span class="line"><span class="comment">//模型数据会作为请求属性放到请求request之中</span></span><br></pre></td></tr></table></figure>

<h5 id="接受请求输入"><a href="#接受请求输入" class="headerlink" title="接受请求输入"></a>接受请求输入</h5><p>@PathVariable：获取url中参数的格式：/hello/{id}/{name}</p>
<p>@RequestParam：获取url参数格式：/hello？id=10</p>
<ol>
<li>当URL指向的是某一具体业务资源，例如博客，用户时，使用@PathVariable</li>
<li>当URL需要对资源或者资源列表进行过滤，删选时，用@RequestParam</li>
</ol>
<p>@RequestBody：获取一个json格式的java对象</p>
<p>@CookieValue：获取Cookie中的值</p>
<ul>
<li><p>查询参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String MAX_LONG_AS_STRING = </span><br><span class="line">    Long.toString(Long.MAX_VALUE);</span><br><span class="line"><span class="comment">//分页，有参和无参情况同时考虑</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(method=RequestMethod.GET)</span><br><span class="line"><span class="keyword">public</span> List&lt;Contact&gt;contacts(</span><br><span class="line">    <span class="meta">@RequestParam</span>(value=<span class="string">"max"</span>,</span><br><span class="line">                 defaultValue=MAX_LONG_AS_STRING) <span class="keyword">long</span> max,</span><br><span class="line">    <span class="meta">@RequestParam</span>(value=<span class="string">"count"</span>,</span><br><span class="line">                 defaultValue=<span class="string">"20"</span>) <span class="keyword">int</span> count)&#123;</span><br><span class="line">    <span class="keyword">return</span> contactRepository.findContacts(max,count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>表单参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//重定向保证了表单不会重复提交</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/register"</span>,method=POST)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">processRegistration</span><span class="params">(Spitter spitter)</span></span>&#123;</span><br><span class="line">    <span class="comment">//保存spitter</span></span><br><span class="line">    spitterRepository.save(spitter);</span><br><span class="line">    <span class="comment">//重定向到基本信息页，forward则跳转到指定url</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"redirect:/spitter/"</span> + spitter.getUsername();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>路径变量：@PathVariable：获取url中数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询参数</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"show"</span>,method=RequestMethod.GET)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">showSpittle</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    @RequestParam(<span class="string">"spittle_id"</span>)</span><span class="keyword">long</span> spittleId,</span></span><br><span class="line"><span class="function">    Model model)</span>&#123;</span><br><span class="line">    mode.addAttribute(spittleRepository.findOne(spittleId));</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"spittle"</span>;</span><br><span class="line">&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//路径变量</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/&#123;spittleId&#125;"</span>,method=RequestMethod.GET)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">spittle</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    //跳过占位符传递到spittleId参数中</span></span></span><br><span class="line"><span class="function"><span class="params">    @PathVariable(<span class="string">"spittleId"</span>)</span><span class="keyword">long</span> spittleId,</span></span><br><span class="line"><span class="function">    Model model)</span>&#123;  </span><br><span class="line">    mode.addAttribute(spittleRepository.findOne(spittleId));<span class="comment">//默认key是类型名</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"spittle"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="跨重定向请求传递数据"><a href="#跨重定向请求传递数据" class="headerlink" title="跨重定向请求传递数据"></a>跨重定向请求传递数据</h5><p>重定向会结束原来的请求，发起一个新的get请求，原始请求中所带有的模型数据就消亡了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//存放普通数据</span></span><br><span class="line">model.addAttribute(<span class="string">"id"</span>,id);</span><br><span class="line"><span class="keyword">return</span> <span class="string">"redirect：/index/&#123;username&#125;"</span>;</span><br><span class="line"><span class="comment">//存放对象</span></span><br><span class="line">RedirectAttribute model;</span><br><span class="line">model.addFlashAttribute(<span class="string">"object"</span>,object);</span><br></pre></td></tr></table></figure>

<h3 id="REST-API"><a href="#REST-API" class="headerlink" title="REST API"></a>REST API</h3><blockquote>
<p>REST：将资源的状态以最适合客户端或服务段的形式转移</p>
<p>‘以信息为中心的表述性状态转移，关注要处理的数据，面向资源’</p>
<ul>
<li>表述性：可以用各种形式来进行表述</li>
<li>状态：更关注资源的状态，而不是资源采取的行为</li>
<li>转移：涉及到转移资源数据，以某种表述性形式转移</li>
</ul>
<p>SOAP：关注行为和处理</p>
</blockquote>
<h5 id="将资源的java表述形式转换为发送给客户端的表述形式"><a href="#将资源的java表述形式转换为发送给客户端的表述形式" class="headerlink" title="将资源的java表述形式转换为发送给客户端的表述形式"></a>将资源的java表述形式转换为发送给客户端的表述形式</h5><ul>
<li><p>内容协商：选择一个试图，将模型渲染为呈现给客户端的表述形式</p>
</li>
<li><p>消息转换器：通过一个消息转换器将控制器所返回的对象转换为呈现给客户端的表现形式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过查找请求中Content-Type头部信息，寻找对应的转换器</span></span><br><span class="line"><span class="meta">@ResponseBody</span><span class="comment">//在把数据发送到客户端的时候，要使用某一个消息器</span></span><br><span class="line"><span class="meta">@RequestBody</span><span class="comment">//查找一个消息转换器，将来自客户端的资源表述转换为对象</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(consumes=”application/json“)<span class="comment">//只处理头部信息为consumes的请求，如果不满足，会由其他方法来处理请求</span></span><br><span class="line"><span class="meta">@RestController</span><span class="comment">//类级别的ResponseBody</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="发送错误信息到客户端"><a href="#发送错误信息到客户端" class="headerlink" title="发送错误信息到客户端"></a>发送错误信息到客户端</h5><ul>
<li><p>@ResponseStatus：指定状态码</p>
</li>
<li><p>@ResponseEntity：控制器方法返回此类型对象，包含更多相应元数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ResponseEntity包含ResponseBody的语义</span></span><br><span class="line"><span class="comment">//ResponseEntity封装了响应和状态码</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Spittle&gt;spittleById(<span class="meta">@PathVariable</span> <span class="keyword">long</span> id)&#123;</span><br><span class="line">    Spittle spittle = spittleRepository.findOne(id);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    HttpStatus status = spittle != null ?</span></span><br><span class="line"><span class="comment">        HttpStatus.OK : HttpStatus.NOT_FOUND;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    <span class="keyword">if</span>(spittle == <span class="keyword">null</span>)&#123;</span><br><span class="line">        Error error = <span class="keyword">new</span> Error(<span class="number">4</span>,<span class="string">"Spittle"</span>+id+<span class="string">"not found"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;Error&gt;(error,HttpStatus.NOT_FOUND);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;Spittle&gt;(spittle,status);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>异常处理器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler</span>(SpittleNotFoundException.class)</span><br><span class="line"><span class="meta">@ResponseStatus</span>(HttpStatus.NOT_FOUND)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Error <span class="title">spittleNotFound</span><span class="params">(SpittleNotFoundException e)</span></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> spittleId = e.getSpittleId();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Error(<span class="number">4</span>,<span class="string">"spittle"</span>+id+<span class="string">"not found"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h5 id="在相应中设置头部信息"><a href="#在相应中设置头部信息" class="headerlink" title="在相应中设置头部信息"></a>在相应中设置头部信息</h5><p>将返回的错误200处理成201</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//构建ResponseEntity</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(method=RequestMethod.POST</span><br><span class="line">consumes=<span class="string">"application/json"</span>)</span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Spittle&gt;saveSpittle(</span><br><span class="line"><span class="meta">@RequestBody</span> Spittle spittle)&#123;</span><br><span class="line">    Spittle spittle = spittleRepository.save(spittle);</span><br><span class="line">    HttpHeaders header = <span class="keyword">new</span> HttpHeaders();</span><br><span class="line">    <span class="comment">/*------URI------*/</span></span><br><span class="line">    URI locationUri = URI.create(</span><br><span class="line">    <span class="string">"http://localhost:8080/spittr/spittles/*"</span>+spittle.getId());</span><br><span class="line">    header.setLocation(locationUri);</span><br><span class="line">    </span><br><span class="line">    ResponseEntity&lt;Spittle&gt;responseEntity = </span><br><span class="line">        <span class="keyword">new</span> ResponseEntity&lt;Spittle&gt;(</span><br><span class="line">    spittle,headers,HttpStatus.CREATE);</span><br><span class="line">    <span class="keyword">return</span> responseEntity;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//利用UriComponentsBuilder来构建LocationURI</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(method=RequestMethod.POST</span><br><span class="line">consumes=<span class="string">"application/json"</span>)</span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Spittle&gt;saveSpittle(</span><br><span class="line"><span class="meta">@RequestBody</span> Spittle spittle,UriComponentsBuilder ucb)&#123;</span><br><span class="line">    Spittle spittle = spittleRepository.save(spittle);</span><br><span class="line">    HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();</span><br><span class="line">    <span class="comment">/*-------UriComponentsBuilder---------*/</span></span><br><span class="line">    URI locationUri = </span><br><span class="line">        ucb.path(<span class="string">"/spittles/*"</span>)<span class="comment">//处理的基础路径</span></span><br><span class="line">        .path(String.valueOf(spittle.getId()))<span class="comment">//使用已保存的id</span></span><br><span class="line">        .build()<span class="comment">//构建UriComponents</span></span><br><span class="line">        .toUri();<span class="comment">//得到新创建的Spittle的URI</span></span><br><span class="line">    header.setLocation(locationUri);</span><br><span class="line">    </span><br><span class="line">    ResponseEntity&lt;Spittle&gt;responseEntity = </span><br><span class="line">        <span class="keyword">new</span> ResponseEneity&lt;Spittle&gt;(</span><br><span class="line">    spittle,headers,HttpStatus.CREATED);</span><br><span class="line">    <span class="keyword">return</span> responseEntity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="创建REST客户端"><a href="#创建REST客户端" class="headerlink" title="创建REST客户端"></a>创建REST客户端</h4><h3 id="Entity实体类"><a href="#Entity实体类" class="headerlink" title="Entity实体类"></a>Entity实体类</h3><p>@NotEmpty：String，Colection，Map，数组，是不能为null或者长度为0的(调用了String，Colection，Map的isEmpty()方法)</p>
<p>@NotBlank：纯空格的String是不符合规则的</p>
<p>@NotNull：不能为null</p>
<p>@asserttrue：验证boolean对象是否为true</p>
<p>@assertfalse：验证boolean对象是否为false</p>
<p>@min：验证number和string对象是否大等于指定的值</p>
<p>@max：验证number和string对象是否小等于指定的值</p>
<p>@length：验证string的长度</p>
<p>@decimalmin：验证number和string对象是否大等于指定的值，小数存在精度</p>
<p>@decimalmax：验证number和string对象是否小等于指定的值，小数存在精度</p>
<p>@size：验证对象（array,collection,map,string）长度是否在给定的范围之内</p>
<p>@digits：验证number和string的构成是否合法</p>
<p>@past：验证date和calendar对象是否在当前时间之前</p>
<p>@future：验证date和calendar对象是否在当前时间之后</p>
<p>@pattern：验证String对象是否符合正则表达式的规则</p>
<p>@Email：验证邮箱</p>
<h3 id="DAO数据访问层"><a href="#DAO数据访问层" class="headerlink" title="DAO数据访问层"></a>DAO数据访问层</h3><h4 id="整合mybatis"><a href="#整合mybatis" class="headerlink" title="整合mybatis"></a>整合mybatis</h4><p>开启扫描</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan</span>(<span class="string">"com.neo.mapper"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(Application.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Dao层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Select</span>(<span class="string">"SELECT * FROM users"</span>)</span><br><span class="line">	<span class="meta">@Results</span>(&#123;</span><br><span class="line"><span class="meta">@Result</span>(property = <span class="string">"userSex"</span>,  column = <span class="string">"user_sex"</span>, javaType = UserSexEnum.class),</span><br><span class="line"><span class="meta">@Result</span>(property = <span class="string">"nickName"</span>, column = <span class="string">"nick_name"</span>)&#125;)</span><br><span class="line">	<span class="function">List&lt;UserEntity&gt; <span class="title">getAll</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Select</span>(<span class="string">"SELECT * FROM users WHERE id = #&#123;id&#125;"</span>)</span><br><span class="line">	<span class="meta">@Results</span>(&#123;</span><br><span class="line">		<span class="meta">@Result</span>(property = <span class="string">"userSex"</span>,  column = <span class="string">"user_sex"</span>, javaType = UserSexEnum.class),</span><br><span class="line">		<span class="meta">@Result</span>(property = <span class="string">"nickName"</span>, column = <span class="string">"nick_name"</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="function">UserEntity <span class="title">getOne</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Insert</span>(<span class="string">"INSERT INTO users(userName,passWord,user_sex) VALUES(#&#123;userName&#125;, #&#123;passWord&#125;, #&#123;userSex&#125;)"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(UserEntity user)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Update</span>(<span class="string">"UPDATE users SET userName=#&#123;userName&#125;,nick_name=#&#123;nickName&#125; WHERE id =#&#123;id&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(UserEntity user)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Delete</span>(<span class="string">"DELETE FROM users WHERE id =#&#123;id&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">(Long id)</span></span>;</span><br></pre></td></tr></table></figure>

<h4 id="Bind标签"><a href="#Bind标签" class="headerlink" title="Bind标签"></a>Bind标签</h4><p><bind>标签的两个属性都是必选的，name为绑定到上下文的变量名，value为OGNL表达式。</bind></p>
<h3 id="Service业务逻辑层"><a href="#Service业务逻辑层" class="headerlink" title="Service业务逻辑层"></a>Service业务逻辑层</h3><p>Service主要进行业务处理，controller主要进行请求转发</p>
<h2 id="Spring-Security"><a href="#Spring-Security" class="headerlink" title="Spring Security"></a>Spring Security</h2><h3 id="Basic安全认证"><a href="#Basic安全认证" class="headerlink" title="Basic安全认证"></a>Basic安全认证</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  security:</span></span><br><span class="line"><span class="attr">    user:</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">user</span></span><br><span class="line"><span class="attr">      password:</span> <span class="string">security</span></span><br><span class="line"><span class="attr">      roles:</span> <span class="string">USER</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Spring Security配置类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity</span>(prePostEnabled = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//配置如何通过拦截器保护请求</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//所有的请求都需要经过HTTPBasic认证</span></span><br><span class="line">        http.authorizeRequests().anyRequest().authenticated().and().httpBasic();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置user-detail服务</span></span><br><span class="line"><span class="comment">//    @Override</span></span><br><span class="line"><span class="comment">//    protected void configure(AuthenticationManagerBuilder auth) throws Exception &#123;</span></span><br><span class="line"><span class="comment">//        auth.userDetailsService(this.userDetailsService).passwordEncoder(this.passwordEncoder());</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置SpringSecurity的Filter链</span></span><br><span class="line">    <span class="comment">//@Override</span></span><br><span class="line">    <span class="comment">//protected void configure(WebSecurity);</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PasswordEncoder <span class="title">passwordEncoder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        明文编码器：不做任何操作的密码编辑器，用于明文测试</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">return</span> NoOpPasswordEncoder.getInstance();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    @Autowired</span></span><br><span class="line"><span class="comment">//    private CustomUserDetailsService userDetailsService;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Spring注解"><a href="#Spring注解" class="headerlink" title="Spring注解"></a>Spring注解</h2><p>@Autowired：注解，一般结合@ComponentScan注解，来自动注入一个Service或Dao级别的Bean</p>
<p>@Resource：默认自动装配，当找不到匹配的名称或者id时才按类型进行装配</p>
<blockquote>
<p>Resource是java自己的注解，name属性解析为bean的名字，而type属性解析为bean的类型。如果匹配到多个bean，则必须指定一个name或用@Qualifier确定合适的bean</p>
<p>Autowired是spring的注解，只根据type进行注入，不会去匹配name。如果匹配到多个bean，可以用@Qualifier也可以用@primary指定默认bean</p>
</blockquote>
<p>@Configuration：类级别，定义配置类，会被AnnotationConfigApplicationContext或AnnotationConfigWebApplicationContext类进行扫描，并用于构建bean定义，初始化Spring容器</p>
<p>@ConfigurationProperties 根据前缀分类映射到不同对象.</p>
<p>@Component类级别注解，用来标识一个组件，比如自定了一个filter，则需要此注解标识之后，Spring Boot才会正确识别。</p>
<p>@Value：可以在类里调用设置在<code>yml</code>里的变量<code>@Value(&quot;${xxx}&quot;)</code></p>
<p>@Bean：方法级别，产生一个Bean并交由容器管理。</p>
<p>@Repository：将DAO类声明为Bean，同时还能将所标注的类中抛出的数据访问异常封装为Spring的数据访问异常类型。</p>
<p>@<code>ResponseBody</code>：方法级别，返回结果直接写入<code>Http response body</code>中，通常用来返回<code>JSON</code>数据或者XML</p>
<h4 id="带参请求处理"><a href="#带参请求处理" class="headerlink" title="带参请求处理"></a>带参请求处理</h4><p><code>@RequestBody</code>：</p>
<blockquote>
<p>作用在形参列表上， 用于将前台发送过过来固定格式的数据(xml或者<code>json</code>)封装为对应的<code>javaBean</code>对象，封装时使用到的一个对象时系统默认配置的<code>httpMessageConverter</code>进行解析，然后封装到形参上</p>
</blockquote>
<ul>
<li><code>application/json</code>时候可用</li>
<li><code>form-data</code>，<code>x-www-form-urlencoded</code>时候不可用</li>
</ul>
<p><code>@RequestParam</code>：</p>
<ul>
<li><code>application/json</code>时候，<code>json</code>字符串部分不可用</li>
<li><code>url</code>中的？后面添加参数可用</li>
<li><code>form-data</code>，<code>x-www-form-urlencoded</code>时候可用，且参数可以没有顺序，但是要将Headers里的Content-Type删掉</li>
</ul>
<p>==没有指定参数接收方式，可以通过<code>HttpServletRequest</code>取到<code>form-data</code>，<code>x-www-form-urlencoded</code>中的值==</p>
<p><code>@PathVariable</code>：接受<code>@RequestMapping</code>传过来的URI中的id，并绑定在参数上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span> </span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/owners/&#123;a&#125;"</span>) </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RelativePathUriTemplateController</span> </span>&#123; </span><br><span class="line">  <span class="meta">@RequestMapping</span>(<span class="string">"/pets/&#123;b&#125;"</span>) </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findPet</span><span class="params">(@PathVariable(<span class="string">"a"</span>)</span> String a,@PathVariable String b, Model model) </span>&#123;     </span><br><span class="line">    <span class="comment">// implementation omitted </span></span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@RequestHeader</code>：处理request header部分的注解</p>
<p><code>@CookieValue</code>：将cookie里的id绑定到方法参数上</p>
<p>@Around：增强处理</p>
<p><code>@ExceptionHandler</code>：统一处理某一类异常</p>
<p><code>@ResponseStatus</code>：类或方法级别，将某种异常映射为<code>http</code>状态码</p>
<p>当方法被调用时，制定的code和reason会返回给前端，value时<code>http</code>状态码，reason时错误信息。</p>
<p><code>@ControllerAdvice</code>：异常集中处理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;  </span><br><span class="line">    <span class="comment">// 表示让Spring捕获到所有抛出的SQLException异常，并交由这个被注解的handleSQLException方法处理</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(SQLException.class)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// @ResponseStatus指定了code和reason写到response上，返回给前端  </span></span><br><span class="line">    <span class="meta">@ResponseStatus</span>(value=HttpStatus.INTERNAL_SERVER_ERROR,reason=”sql查询错误”)  </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*表示让Spring捕获到所有抛出的SQLException异常</span></span><br><span class="line"><span class="comment">     *交由这个被注解的handleSQLException方法处理</span></span><br><span class="line"><span class="comment">     *同时使用@ResponseStatus指定了code和reason写到response上</span></span><br><span class="line"><span class="comment">     *返回给前端。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ResponseBody</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ExceptionResponse <span class="title">handleSQLException</span><span class="params">(HttpServletRequest request, Exception ex)</span> </span>&#123;  </span><br><span class="line">        String message = ex.getMessage();  </span><br><span class="line">        <span class="keyword">return</span> ExceptionResponse.create(HttpStatus.INTERNAL_SERVER_ERROR.value(), message);  </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/01/Nginx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PPCoder">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/author.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/01/Nginx/" itemprop="url">Nginx简单配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-01T17:32:51+08:00">
                2019-10-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><h3 id="Nginx工作原理"><a href="#Nginx工作原理" class="headerlink" title="Nginx工作原理"></a>Nginx工作原理</h3><h4 id="nginx-文件结构"><a href="#nginx-文件结构" class="headerlink" title="nginx 文件结构"></a>nginx 文件结构</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">...              #全局块</span><br><span class="line"></span><br><span class="line">events &#123;         #events块</span><br><span class="line">   ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http      #http块</span><br><span class="line">&#123;</span><br><span class="line">    ...   #http全局块</span><br><span class="line">    server        #server块</span><br><span class="line">    &#123; </span><br><span class="line">        ...       #server全局块</span><br><span class="line">        location [PATTERN]   #location块</span><br><span class="line">        &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">        location [PATTERN] </span><br><span class="line">        &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    server</span><br><span class="line">    &#123;</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...     #http全局块</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>全局块</strong>：配置影响nginx全局的指令。一般有运行nginx服务器的用户组，nginx进程pid存放路径，日志存放路径，配置文件引入，允许生成worker process数等。</li>
<li><strong>events块</strong>：配置影响nginx服务器或与用户的网络连接。有每个进程的最大连接数，选取哪种事件驱动模型处理连接请求，是否允许同时接受多个网路连接，开启多个网络连接序列化等。</li>
<li><strong>http块</strong>：可以嵌套多个server，配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置。如文件引入，mime-type定义，日志自定义，是否使用sendfile传输文件，连接超时时间，单连接请求数等。</li>
<li><strong>server块</strong>：配置虚拟主机的相关参数，一个http中可以有多个server。</li>
<li><strong>location块</strong>：配置请求的路由，以及各种页面的处理情况。</li>
</ul>
<h4 id="处理流程"><a href="#处理流程" class="headerlink" title="处理流程"></a>处理流程</h4><p><img src="D:%5Clearn%5Cnote%5Cpic%5C1564450067806.png" alt="1564450067806"></p>
<ol>
<li>接到HTTP请求，nginx通过查找配置文件将请求映射到一个location block</li>
<li>location配置的各个指令会启动不同模块完成工作</li>
<li>通常一个location的指令会涉及一个handler模块和多个filter模块</li>
<li>handler模块负责处理请求，完成响应内容的生成，filter模块负责对响应内容进行处理</li>
</ol>
<h4 id="多线程模型"><a href="#多线程模型" class="headerlink" title="多线程模型"></a>多线程模型</h4><p>nginx启动会以daemon形式在后台运行，采用多线程+异步非阻塞IO事件模型来处理各种连接请求。</p>
<ol>
<li><p>多线程模型包括一个master进程，多个worker进程。</p>
<ul>
<li>master进程负责管理nginx本身和其他worker进程</li>
<li>读取并验证配置文件nginx.conf</li>
</ul>
</li>
<li><p>每个worker进程都维护一个线程，处理连接和请求。worker进程的个数由配置文件决定，一般和cpu个数相关</p>
</li>
</ol>
<h4 id="多进程处理模型"><a href="#多进程处理模型" class="headerlink" title="多进程处理模型"></a>多进程处理模型</h4><p>惊群现象：一个请求进来的时候，所有的worker都会感知到</p>
<p>worker进程fork master进程，具有相同的设置，所以设置一个类似互斥锁，保证只有一个进程可以去注册读事件</p>
<h4 id="Nginx的热部署"><a href="#Nginx的热部署" class="headerlink" title="Nginx的热部署"></a>Nginx的热部署</h4><p>修改配置文件后，重新生成新的worker进程，以新的配置处理请求，新的请求都交给新的worker进程，老的worker进程，等把以前的请求处理完毕就kill掉</p>
<h4 id="IO事件模型"><a href="#IO事件模型" class="headerlink" title="IO事件模型"></a>IO事件模型</h4><p>nginx采用linux的epoll模型，epoll模型基于事件驱动机制，可以监控多个事件是否准备完毕，如果ok，则放入epoll队列，这个过程是异步的。worker只需要从epoll队列循环处理即可</p>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><h4 id="代理设置"><a href="#代理设置" class="headerlink" title="代理设置"></a>代理设置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location /user/ &#123;</span><br><span class="line">	proxy_pass http://ppgoder.cn;</span><br><span class="line">	proxy_method get;    #支持客户端的请求方法。post/get；</span><br><span class="line">	#Nginx服务器提供代理服务的http协议版本1.0，1.1，默认设置为1.0版本</span><br><span class="line">	proxy_http_version 1.0 ; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="正向代理"><a href="#正向代理" class="headerlink" title="正向代理"></a>正向代理</h4><p>客户端非常明确的要访问的服务器地址，服务器只清楚请求来自    哪个代理服务器，不清楚来自的客户端</p>
<p>代客户端发送请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">location /xxx &#123;</span><br><span class="line">	#最上层目录的定义</span><br><span class="line">	root	html/static;</span><br><span class="line">	#url为localhost/xxx,文件地址为../html/static/xxx</span><br><span class="line">	</span><br><span class="line">	#目录的别名,目录后面必须用&apos;/&apos;结束</span><br><span class="line">	alias	html/static/;</span><br><span class="line">	#url为localhost/xxx，文件地址为../html/static/</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h4><p>客户端是无感知代理的存在，对外都是透明的，访问者不知道自己访问的是一个代理，反响代理隐藏了服务器的信息</p>
<p>代服务器接收请求</p>
<p>配置请求转发</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//nginx.conf</span></span><br><span class="line">http&#123;</span><br><span class="line">	server&#123;</span><br><span class="line">		listen <span class="number">80</span>;<span class="comment">//端口号</span></span><br><span class="line">		server_name www.baidu.com;<span class="comment">//访问的域名</span></span><br><span class="line">		access_log logs/www_baidu_access.log main;<span class="comment">//日志</span></span><br><span class="line">        error_log logs/www_baidu_error.log;<span class="comment">//日志存放位置</span></span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_redirect off;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_pass http:<span class="comment">//127.0.0.1:8081; //转发的ip地址</span></span><br><span class="line">            #access_log  logs/www_baidu_access.log;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="错误页面配置"><a href="#错误页面配置" class="headerlink" title="错误页面配置"></a>错误页面配置</h4><h5 id="直接访问"><a href="#直接访问" class="headerlink" title="直接访问"></a>直接访问</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error_page  404              https://www.baidu.com;</span><br></pre></td></tr></table></figure>

<h5 id="路径访问"><a href="#路径访问" class="headerlink" title="路径访问"></a>路径访问</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">error_page  404              /404.html;</span><br><span class="line">location = /404.html&#123;</span><br><span class="line">	root	html/; #将会链接到html文件夹下的404.html</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h4><h5 id="模式"><a href="#模式" class="headerlink" title="模式"></a>模式</h5><ol>
<li>轮询</li>
<li>ip_hash：按ip的hash结果分配，同一ip会固定访问一个后端服务器</li>
<li>url_hash：按url的hash结果分配，同一url会固定访问一个后端服务器</li>
<li>fair：按后端服务器的响应时间分配，响应时间短的优先分配</li>
</ol>
<h5 id="服务器参数"><a href="#服务器参数" class="headerlink" title="服务器参数"></a>服务器参数</h5><ol>
<li>down：当前服务器暂不参与负载</li>
<li>weight：权重，值越大，负载量越大</li>
<li>max_fails：允许请求失败的次数，默认为1</li>
<li>fail_timeout：max_fail次失败后暂停的时间</li>
<li>backup：备份机，只有其他所有的非backup机器down或者忙时，才会请求backup机器</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">//nginx.conf</span><br><span class="line">http&#123;</span><br><span class="line">    //服务器集群</span><br><span class="line">    upstream myserver&#123;</span><br><span class="line">		server 127.0.0.1:8081;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	server&#123;</span><br><span class="line">		listen 80;//端口号</span><br><span class="line">		server_name www.baidu.com;//访问的域名</span><br><span class="line">		access_log logs/www_baidu_access.log main;//日志</span><br><span class="line">        error_log logs/www_baidu_error.log;//日志存放位置</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_redirect off;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_pass http://myserver; //转发的ip地址</span><br><span class="line">            #access_log  logs/www_baidu_access.log;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="静态服务器"><a href="#静态服务器" class="headerlink" title="静态服务器"></a>静态服务器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123; </span><br><span class="line">    listen 80;</span><br><span class="line">    #静态网站访问的域名地址</span><br><span class="line">    server_name www.xxx.com;</span><br><span class="line">    client_max_body_size 1024M; </span><br><span class="line">    location / &#123;</span><br><span class="line">    	#直接静态项目的绝对路径的根目录</span><br><span class="line">    	root	/var/www/xxx_static; </span><br><span class="line">        index	index.html; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/01/Odoo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PPCoder">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/author.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/01/Odoo/" itemprop="url">Odoo简易安装</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-01T13:15:07+08:00">
                2019-10-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h2 id="Odoo运维文档"><a href="#Odoo运维文档" class="headerlink" title="Odoo运维文档"></a>Odoo运维文档</h2><p>author: dongml</p>
<p>date: 2019/8/28 14:56</p>
<h3 id="开发环境配置"><a href="#开发环境配置" class="headerlink" title="开发环境配置"></a>开发环境配置</h3><ol>
<li><h4 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h4><h5 id="1-1-什么是docker"><a href="#1-1-什么是docker" class="headerlink" title="1.1 什么是docker"></a>1.1 什么是docker</h5><blockquote>
<p>Docker is the company driving the container movement and the only container platform provider to address every application across the hybrid cloud. Today’s businesses are under pressure to digitally transform but are constrained by existing applications and infrastructure while rationalizing an increasingly diverse portfolio of clouds, datacenters and application architectures. Docker enables true independence between applications and infrastructure and developers and IT ops to unlock their potential and creates a model for better collaboration and innovation.</p>
<p>Docker是推动集装箱运输的公司，也是唯一能够解决混合云中每个应用程序的容器平台提供商。今天的企业面临数字化转型的压力，但受到现有应用程序和基础架构的限制，同时使云，数据中心和应用程序架构的组合日益多样化。 Docker实现了应用程序和基础架构之间的真正独立性，开发人员和IT运营商可以释放潜力，并创建更好的协作和创新模型</p>
</blockquote>
<h5 id="1-2-为什么用docker"><a href="#1-2-为什么用docker" class="headerlink" title="1.2 为什么用docker"></a>1.2 为什么用docker</h5><p>众所周知，我们在安装odoo过程中很痛苦，那么，，，，有没有这样的一款软件，让你免除这些痛苦，能很轻易的上手操作呢。</p>
<p>有的，那就是docker，docker是一个容器，它保存的是odoo等软件的镜像，我们甚至只要从仓库拉取需要的镜像就可以很轻松的实现安装或者迁移，那么你以及你的队友，无论是从ubuntu迁移到centos，还是windows迁移linux，只要主机安装了docker，就完全无需考虑配置问题，docker可以迅速的帮你配置好一切，并且保持环境，配置一致。</p>
<p>而我们使用docker，甚至只需要一个写好的compose，我们所有开发的配置都可以保持一致</p>
<h5 id="1-3-安装配置"><a href="#1-3-安装配置" class="headerlink" title="1.3 安装配置"></a>1.3 安装配置</h5><p>1.3.1 查看内核版本是否支持Docker</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -r</span><br></pre></td></tr></table></figure>

<p>1.3.2 更新软件包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y upgrade</span><br></pre></td></tr></table></figure>

<p>1.3.3 查看是否安装过旧版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa|grep docker</span><br></pre></td></tr></table></figure>

<p>1.3.4 如果有就移除旧版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">yum remove docker \</span><br><span class="line">           docker-client \</span><br><span class="line">           docker-client-latest \</span><br><span class="line">           docker-common \</span><br><span class="line">           docker-latest \</span><br><span class="line">           docker-latest-logrotate \</span><br><span class="line">           docker-logrotate \</span><br><span class="line">           docker-selinux \</span><br><span class="line">           docker-engine-selinux \</span><br><span class="line">           docker-engine</span><br></pre></td></tr></table></figure>

<p>1.3.5 使用脚本安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://get.docker.com/ | sh</span><br><span class="line">sh get-docker.sh</span><br></pre></td></tr></table></figure>

<p>1.3.6 设置自启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable docker</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="2">
<li><h4 id="安装postgres"><a href="#安装postgres" class="headerlink" title="安装postgres"></a>安装postgres</h4></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo docker pull postgres</span><br><span class="line">docker run -d -e POSTGRES_USER=odoo -e POSTGRES_PASSWORD=odoo -e POSTGRES_DB=postgres --name db postgres</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><h4 id="安装odoo-12"><a href="#安装odoo-12" class="headerlink" title="安装odoo:12"></a>安装odoo:12</h4></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo docker pull odoo:12</span><br><span class="line">docker run -p 8069:8069 --name odoo --link db:postgres -t odoo</span><br></pre></td></tr></table></figure>



<p>以上，我们的一个环境就部署完成了，但是这环境看起来似乎并没有特别简单，如果能只运行一行命令就能解决该多好呀。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<h4 id="附：docker-compose-yml"><a href="#附：docker-compose-yml" class="headerlink" title="附：docker-compose.yml"></a>附：docker-compose.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.3'</span></span><br><span class="line"><span class="attr">services:</span> </span><br><span class="line">	<span class="attr">odoo12:</span> </span><br><span class="line">		<span class="attr">build:</span> <span class="string">./build/odoo12</span></span><br><span class="line">		<span class="attr">command:</span> <span class="string">start</span></span><br><span class="line">    	<span class="attr">links:</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="attr">postgres:db</span></span><br><span class="line">    	<span class="attr">ports:</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">"8069:8069"</span></span><br><span class="line">    	<span class="attr">volumes:</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="attr">odoo-web-data:/var/lib/odoo</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">./volumes/odoo12/config:/etc/odoo</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">./volumes/odoo12/addons:/opt/odoo/additional_addons</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">./volumes/odoo12/filestore:/opt/odoo/data/filestore</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">./volumes/odoo12/sessions:/opt/odoo/data/sessions</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">./volumes/odoo12/ssh:/opt/odoo/ssh:ro</span></span><br><span class="line">      	</span><br><span class="line">	<span class="attr">postgres:</span></span><br><span class="line">    	<span class="attr">image:</span> <span class="attr">postgres:10</span></span><br><span class="line">    	<span class="attr">container_name:</span> <span class="string">pgsql</span></span><br><span class="line">		<span class="attr">ports:</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">"5432:5432"</span></span><br><span class="line">  	  	<span class="attr">networks:</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">"odoonetwork"</span></span><br><span class="line">    	<span class="attr">environment:</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">POSTGRES_DB=postgres</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">POSTGRES_PASSWORD=odoo</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">POSTGRES_USER=odoo</span></span><br><span class="line">    	<span class="attr">volumes:</span></span><br><span class="line">      	<span class="bullet">-</span> <span class="string">./volumes/postgres:/var/lib/postgresql/data</span></span><br></pre></td></tr></table></figure>

<h4 id="附：odoo配置文件"><a href="#附：odoo配置文件" class="headerlink" title="附：odoo配置文件"></a>附：odoo配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[options]</span><br><span class="line">addons_path = /mnt/extra-addons,/usr/lib/python2.7/dist-packages/odoo/addons</span><br><span class="line">;data_dir = /var/lib/odoo</span><br><span class="line">admin_passwd = admin</span><br><span class="line">csv_internal_sep = ,</span><br><span class="line">db_maxconn = 64</span><br><span class="line">db_name = False</span><br><span class="line">db_template = template1</span><br><span class="line">dbfilter = .*</span><br><span class="line">debug_mode = False</span><br><span class="line">email_from = False</span><br><span class="line">limit_memory_hard = 2684354560</span><br><span class="line">limit_memory_soft = 2147483648</span><br><span class="line">limit_request = 8192</span><br><span class="line">limit_time_cpu = 60</span><br><span class="line">limit_time_real = 120</span><br><span class="line">list_db = True</span><br><span class="line">log_db = False</span><br><span class="line">log_handler = [&apos;:INFO&apos;]</span><br><span class="line">log_level = info</span><br><span class="line">logfile = None</span><br><span class="line">longpolling_port = 8072</span><br><span class="line">max_cron_threads = 2</span><br><span class="line">osv_memory_age_limit = 1.0</span><br><span class="line">osv_memory_count_limit = False</span><br><span class="line">smtp_password = False</span><br><span class="line">smtp_port = 25</span><br><span class="line">smtp_server = localhost</span><br><span class="line">smtp_ssl = False</span><br><span class="line">smtp_user = False</span><br><span class="line">workers = 2</span><br><span class="line">xmlrpc = True</span><br><span class="line">xmlrpc_interface =</span><br><span class="line">xmlrpc_port = 8069</span><br><span class="line">xmlrpcs = True</span><br><span class="line">xmlrpcs_interface =</span><br><span class="line">xmlrpcs_port = 8071</span><br></pre></td></tr></table></figure>

<h3 id="设置Nginx反向代理"><a href="#设置Nginx反向代理" class="headerlink" title="设置Nginx反向代理"></a>设置Nginx反向代理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">upstream odoo &#123;</span><br><span class="line">​    server 127.0.0.1:8069;</span><br><span class="line">&#125;</span><br><span class="line">upstream odoochat &#123;</span><br><span class="line">​    server 127.0.0.1:8072;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">​     listen 80;</span><br><span class="line">​     # Add Headers for odoo proxy mode</span><br><span class="line">​     proxy_set_header X-Forwarded-Host $host;</span><br><span class="line">​     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">​     proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">​     proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line"></span><br><span class="line">​     # log</span><br><span class="line">​     access_log /var/log/nginx/odoo.access.log;</span><br><span class="line">​     error_log /var/log/nginx/odoo.error.log;</span><br><span class="line">​     # Redirect longpoll requests to odoo longpolling port</span><br><span class="line">​     location /longpolling &#123;</span><br><span class="line">​        proxy_pass http://odoochat;</span><br><span class="line">​     &#125;</span><br><span class="line"></span><br><span class="line">​     # Redirect requests to odoo backend server</span><br><span class="line">​     location / &#123;</span><br><span class="line">​         proxy_redirect off;</span><br><span class="line">​         proxy_pass http://odoo;</span><br><span class="line">​     &#125;</span><br><span class="line"></span><br><span class="line">​     # common gzip</span><br><span class="line">​    gzip_types text/css text/scss text/plain text/xml application/xml application/json application/javascript;</span><br><span class="line">​    gzip on;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/26/SingleServiceDemo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PPCoder">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/author.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/26/SingleServiceDemo/" itemprop="url">一个小Demo的尝试</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-26T21:09:56+08:00">
                2019-09-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h2 id="1-搭建服务"><a href="#1-搭建服务" class="headerlink" title="1.搭建服务"></a>1.搭建服务</h2><ul>
<li><input checked disabled type="checkbox"> 实现增删改查</li>
</ul>
<ul>
<li><input checked disabled type="checkbox"> 将操作记录保存到库中</li>
<li><input checked disabled type="checkbox"> 处理异常：少用异常</li>
<li><input checked disabled type="checkbox"> 日志分类</li>
</ul>
<h3 id="保存操作记录"><a href="#保存操作记录" class="headerlink" title="保存操作记录"></a>保存操作记录</h3><p>切面保存操作记录</p>
<p>规范化返回信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回结果工具类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">success</span><span class="params">(Object object)</span></span>&#123;</span><br><span class="line">        Result result = <span class="keyword">new</span> Result();</span><br><span class="line">        result.setCode(<span class="number">0</span>);</span><br><span class="line">        result.setMsg(<span class="string">"成功"</span>);</span><br><span class="line">        result.setData(object);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">success</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> success(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">error</span><span class="params">(Integer code,String msg)</span></span>&#123;</span><br><span class="line">        Result result = <span class="keyword">new</span> Result();</span><br><span class="line">        result.setCode(code);</span><br><span class="line">        result.setMsg(msg);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回格式</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Result</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//错误码</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//提示信息</span></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//具体的内容</span></span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//枚举格式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> ResultEnum &#123;</span><br><span class="line">    UNKNOW_ERROR(-<span class="number">1</span>,<span class="string">"未知错误"</span>),</span><br><span class="line">    SUCCESS(<span class="number">0</span>,<span class="string">"成功"</span>),</span><br><span class="line">    PRIMARY_SCHOOL(<span class="number">100</span>,<span class="string">"xx"</span>),</span><br><span class="line">    MIDDLE_SCHOOL(<span class="number">101</span>,<span class="string">"xxx"</span>),</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>  Integer code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    ResultEnum(Integer code, String msg) &#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="异常处理："><a href="#异常处理：" class="headerlink" title="异常处理："></a>异常处理：</h3><blockquote>
<p>try-catch：捕获异常</p>
<p>throws：抛出异常到上层</p>
</blockquote>
<p><img src="https://image-static.segmentfault.com/411/861/4118619330-5a05577c2d32f" alt="img"></p>
<p>异常捕获规范：不要在业务代码中捕获异常，将业务层的所有异常全部抛出到上层，我们只需要用AOP对Controller层的所有方法处理即可</p>
<p>默认异常处理：/error</p>
<p>单个异常处理</p>
<p>全局异常处理</p>
<ul>
<li><p>自定义error属性</p>
<blockquote>
<p>simply add a bean of type <code>ErrorAttributes</code> to use the existing mechanism but replace the contents</p>
</blockquote>
</li>
<li><p>自定义errorController</p>
<blockquote>
<p>To do that just extend <code>BasicErrorController</code> and add a public method with a <code>@RequestMapping</code> that has a <code>produces</code> attribute, and create a bean of your new type.</p>
</blockquote>
</li>
<li><p>自定义ControllerAdvice</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义异常</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//参数可以改为枚举类型</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyException</span><span class="params">(Integer code,String message)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//父类的构造方法本身会传message进去</span></span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCode</span><span class="params">(Integer code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义error属性</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomErrorAttributes</span> <span class="keyword">implements</span> <span class="title">ErrorAttributes</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getErrorAttributes</span><span class="params">(RequestAttributes requestAttributes, <span class="keyword">boolean</span> includeStackTrace)</span> </span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; result = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    result.put(<span class="string">"timestamp"</span>, System.currentTimeMillis());</span><br><span class="line">    result.put(<span class="string">"error"</span>, <span class="string">"customized error"</span>);</span><br><span class="line">    result.put(<span class="string">"path"</span>, <span class="string">"customized path"</span>);</span><br><span class="line">    result.put(<span class="string">"status"</span>, <span class="number">100</span>);</span><br><span class="line">    result.put(<span class="string">"exception"</span>, <span class="string">"customized exception"</span>);</span><br><span class="line">    result.put(<span class="string">"message"</span>, <span class="string">"customized message"</span>);</span><br><span class="line">    result.put(<span class="string">"trace"</span>, <span class="string">"customized trace"</span>);</span><br><span class="line">    result.put(<span class="string">"add-attribute"</span>, <span class="string">"add-attribute"</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Throwable <span class="title">getError</span><span class="params">(RequestAttributes requestAttributes)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*应用到所有@RequestMapping注解方法，在其执行之前初始化数据绑定器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@InitBinder</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initWebBinder</span><span class="params">(WebDataBinder binder)</span></span>&#123;</span><br><span class="line">        <span class="comment">//对日期的统一处理</span></span><br><span class="line">        binder.addCustomFormatter(<span class="keyword">new</span> DateFormatter(<span class="string">"yyyy-MM-dd"</span>));</span><br><span class="line">        <span class="comment">//添加对数据的校验</span></span><br><span class="line">        <span class="comment">//binder.setValidator();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 把值绑定到Model中，使全局@RequestMapping可以获取到该值</span></span><br><span class="line"><span class="comment">     * 在Controller中使用ModelMap以及@ModelAttribute()来获取值</span></span><br><span class="line"><span class="comment">     * 实例：用于将异常信息传给控制器，然后规范json格式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ModelAttribute</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addAttribute</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">        model.addAttribute(<span class="string">"attribute"</span>,  <span class="string">"The Attribute"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_ERROR_VIEW = <span class="string">"error"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 全局异常捕获</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(value = Exception.class)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">defaultErrorHandler</span><span class="params">(HttpServletRequest req, Exception e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">        mav.addObject(<span class="string">"exception"</span>, e);</span><br><span class="line">        mav.addObject(<span class="string">"url"</span>, req.getRequestURL());</span><br><span class="line">        mav.setViewName(DEFAULT_ERROR_VIEW);</span><br><span class="line">        <span class="keyword">return</span> mav;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自定义异常捕获</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(value = MyException.class)<span class="comment">//拦截异常的类型，传入的参数可以时一个数组，同时处理多个异常</span></span><br><span class="line">    <span class="meta">@ResponseStatus</span>(HttpStatus.INTERNAL_SERVER_ERROR)<span class="comment">//自定义浏览器返回的状态码</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">jsonErrorHandler</span><span class="params">(HttpServletRequest req, MyException e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Response r = <span class="keyword">new</span> Response();</span><br><span class="line">        r.setMsg(e.getMessage());<span class="comment">//消息内容</span></span><br><span class="line">        r.setCode(ErrorInfo.ERROR);<span class="comment">//消息类型</span></span><br><span class="line">        r.setData(<span class="string">"Some Data"</span>);<span class="comment">//请求返回的数据</span></span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Springmvc的异常处理器</span></span><br><span class="line"><span class="comment">//不能使用两个ExceptionHandler去处理同一个异常</span></span><br></pre></td></tr></table></figure>

<h3 id="记录日志："><a href="#记录日志：" class="headerlink" title="记录日志："></a>记录日志：</h3><h4 id="SpringBoot中日志配置"><a href="#SpringBoot中日志配置" class="headerlink" title="SpringBoot中日志配置"></a>SpringBoot中日志配置</h4><h5 id="在项目中打印日志"><a href="#在项目中打印日志" class="headerlink" title="在项目中打印日志"></a>在项目中打印日志</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(XXX.class);</span><br></pre></td></tr></table></figure>

<h5 id="将日志存储到文件"><a href="#将日志存储到文件" class="headerlink" title="将日志存储到文件"></a>将日志存储到文件</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">	<span class="attr">file:</span> <span class="string">log\springbootdemo.log//设置文件，相对路径+文件名</span></span><br><span class="line">	<span class="attr">path:</span> <span class="string">xxxx//设置目录，绝对路径或相对路径</span></span><br><span class="line">	<span class="string">//当file和path同时设置，只有file生效</span></span><br></pre></td></tr></table></figure>

<h5 id="设置日志级别"><a href="#设置日志级别" class="headerlink" title="设置日志级别"></a>设置日志级别</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">	<span class="attr">level:</span></span><br><span class="line">		<span class="string">root=WARN;</span></span><br><span class="line">		<span class="string">com.example=INFO;</span></span><br></pre></td></tr></table></figure>

<h4 id="自定义日志配置"><a href="#自定义日志配置" class="headerlink" title="自定义日志配置"></a>自定义日志配置</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">	<span class="string">config=classpath:logging-config.xml</span></span><br></pre></td></tr></table></figure>

<p><code>configuration</code></p>
<ul>
<li><code>scan</code>：如果配置文件发生改变，将会被重新加载</li>
<li><code>scanPeriod</code>：设置检测配置文件是否有修改的时间间隔，如果没有给出时间单位，默认的单位是毫秒，默认时间1分钟</li>
<li><code>debug</code>：打印出<code>logback</code>内部日志信息，实时查看<code>logback</code>运行状态</li>
</ul>
<p><code>contextName</code></p>
<blockquote>
<p>每个logger都关联到logger上下文，默认上下文名称为“default”。</p>
<p>但可以使用<contextname>设置成其他名字，用于区分不同应用程序的记录。</contextname></p>
<p>一旦设置，不能修改,可以通过<code>%contextName</code>来打印日志上下文名称。</p>
</blockquote>
<p><code>property</code>：定义变量值</p>
<h5 id="appender：格式化日志输出节点"><a href="#appender：格式化日志输出节点" class="headerlink" title="appender：格式化日志输出节点"></a>appender：格式化日志输出节点</h5><ul>
<li><p>class：指定哪种输出策略，常用的是控制台输出策略和文件输出策略</p>
<p>–&gt; <code>ThresholdFilter</code>：系统定义拦截器，过滤ERROR级别以下的日志，</p>
</li>
</ul>
<p><code>encoder</code>：对日志进行编码</p>
<p><code>RollingFileAppender</code>：切分日志</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"RollingFileInfo"</span> <span class="attr">fileName</span>=<span class="string">"$&#123;log_path&#125;/info.log"</span></span></span><br><span class="line"><span class="tag"><span class="attr">filePattern</span>=<span class="string">"$&#123;log_path&#125;/$$&#123;date:yyyy-MM&#125;/info-%d&#123;yyyy-MM-dd&#125;-%i.log.gz"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Filters</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">"INFO"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">"WARN"</span> <span class="attr">onMatch</span>=<span class="string">"DENY"</span></span></span><br><span class="line"><span class="tag">                                 <span class="attr">onMismatch</span>=<span class="string">"NEUTRAL"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Filters</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"[%d][%t][%p][%c:%L] %m%n"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 归档每天的文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">"1"</span> <span class="attr">modulate</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 限制单个文件大小 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"2 MB"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 限制每天文件个数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">compressionLevel</span>=<span class="string">"0"</span> <span class="attr">max</span>=<span class="string">"10"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>fileNamePattern</code>：定义了日志的切分方式，把每一天的归档到一个文件夹中</p>
<h5 id="root：指定最基础的日志级别"><a href="#root：指定最基础的日志级别" class="headerlink" title="root：指定最基础的日志级别"></a><code>root</code>：指定最基础的日志级别</h5><ul>
<li>level：设置打印级别</li>
</ul>
<h5 id="loger：设置某个包或类的日志打印级别"><a href="#loger：设置某个包或类的日志打印级别" class="headerlink" title="loger：设置某个包或类的日志打印级别"></a><code>loger</code>：设置某个包或类的日志打印级别</h5><h3 id="事务回滚"><a href="#事务回滚" class="headerlink" title="事务回滚"></a>事务回滚</h3><p>1.业务层抛出异常，控制层处理</p>
<p>2.当异常为<code>RuntimeException</code>时，才会开启回滚</p>
<h2 id="2-nginx转发均衡"><a href="#2-nginx转发均衡" class="headerlink" title="2. nginx转发均衡"></a>2. nginx转发均衡</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#服务器集群</span><br><span class="line">upstream message.com&#123;</span><br><span class="line">    #weight是权重</span><br><span class="line">    server 127.0.0.1:5757 weight=2;</span><br><span class="line">    server 156.2.3.1:7777 weight=1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#修改nginx配置文件，</span><br><span class="line">server &#123;</span><br><span class="line">	listen       8765;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    #charset koi8-r;</span><br><span class="line">    #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        #root 静态资源文件存放位置</span><br><span class="line">        root   /home/work/chat/static;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">        #当访问路径不存在该资源时，转发</span><br><span class="line">        if (!-e $request_filename) &#123;</span><br><span class="line">        	proxy_pass http:message.com;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>附加：通过一个域名访问不同的nginx服务器</p>
<h2 id="3-postman调用接口"><a href="#3-postman调用接口" class="headerlink" title="3. postman调用接口"></a>3. postman调用接口</h2><h2 id="4-Druid监控"><a href="#4-Druid监控" class="headerlink" title="4. Druid监控"></a>4. Druid监控</h2><h4 id="4-1-Druid：数据库连接池"><a href="#4-1-Druid：数据库连接池" class="headerlink" title="4.1 Druid：数据库连接池"></a>4.1 Druid：数据库连接池</h4><h4 id="4-2-功能："><a href="#4-2-功能：" class="headerlink" title="4.2 功能："></a>4.2 功能：</h4><ol>
<li>数据库连接池，代替DBCP和C3P0</li>
<li>可以监控数据库访问性能</li>
<li>数据库密码加密</li>
<li>SQL执行日志</li>
<li>拓展JDBC：Filter机制</li>
</ol>
<h4 id="4-3-配置方法："><a href="#4-3-配置方法：" class="headerlink" title="4.3 配置方法："></a>4.3 配置方法：</h4><h5 id="4-3-1-纯yml配置"><a href="#4-3-1-纯yml配置" class="headerlink" title="4.3.1 纯yml配置"></a>4.3.1 纯yml配置</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用druid数据源</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="attr">druid:</span></span><br><span class="line">   <span class="comment"># 初始化大小</span></span><br><span class="line"><span class="attr">   initialSize:</span> <span class="number">10</span></span><br><span class="line">   <span class="comment">#最小连接数</span></span><br><span class="line"><span class="attr">   minIdle:</span> <span class="number">10</span></span><br><span class="line">   <span class="comment">#最大连接数</span></span><br><span class="line"><span class="attr">   maxActive:</span> <span class="number">200</span></span><br><span class="line">   <span class="comment"># 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒</span></span><br><span class="line"><span class="attr">   time-between-eviction-runs-millis:</span> <span class="number">60000</span></span><br><span class="line">   <span class="comment"># 配置一个连接在池中最小生存的时间，单位是毫秒</span></span><br><span class="line"><span class="attr">   min-evictable-idle-time-millis:</span> <span class="number">300000</span></span><br><span class="line">   <span class="comment"># 配置测试查询语句</span></span><br><span class="line"><span class="attr">   validationQuery:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">DUAL</span></span><br><span class="line"><span class="attr">   testOnBorrow:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">   testWhileIdle:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">   removeAbandoned:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">   removeAbandonedTimeout:</span> <span class="number">1800</span></span><br><span class="line"><span class="attr">   logAbandoned:</span> <span class="literal">true</span></span><br><span class="line">   <span class="comment"># 打开PSCache，并且指定每个连接上PSCache的大小</span></span><br><span class="line"><span class="attr">   poolPreparedStatements:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">   maxOpenPreparedStatements:</span> <span class="number">100</span></span><br><span class="line">   <span class="comment"># 配置监控统计拦截的filters，去掉后监控界面sql无法统计，'wall'用于防火墙</span></span><br><span class="line"><span class="attr">   filters:</span> <span class="string">stat,wall</span></span><br><span class="line">   <span class="comment"># 通过connectProperties属性来打开mergeSql功能；慢SQL记录</span></span><br><span class="line"><span class="attr">   connectionProperties:</span> <span class="string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=5000</span></span><br><span class="line">   <span class="comment">#配置监控视图</span></span><br><span class="line"><span class="attr">   stat-view-servlet:</span></span><br><span class="line">     <span class="comment">#登录查看信息的账号密码, 用于登录Druid监控后台</span></span><br><span class="line"><span class="attr">     login-username:</span> <span class="string">admin</span></span><br><span class="line"><span class="attr">     login-password:</span> <span class="number">1234</span></span><br><span class="line">     <span class="comment">#是否能够重置数据.</span></span><br><span class="line"><span class="attr">     reset-enable:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">     url-pattern:</span> <span class="string">/druid/*</span></span><br><span class="line">     <span class="comment"># 添加IP白名单</span></span><br><span class="line">     <span class="comment">#allow:</span></span><br><span class="line">     <span class="comment"># 添加IP黑名单，当白名单和黑名单重复时，黑名单优先级更高</span></span><br><span class="line">     <span class="comment">#deny:</span></span><br><span class="line">  <span class="comment">#监控拦截器</span></span><br><span class="line"><span class="attr">  web-stat-filter:</span></span><br><span class="line">     <span class="comment"># 添加过滤规则</span></span><br><span class="line"><span class="attr">     url-pattern:</span> <span class="string">/*</span></span><br><span class="line">     <span class="comment"># 忽略过滤格式</span></span><br><span class="line"><span class="attr">     exclusions:</span> <span class="string">"*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*"</span></span><br></pre></td></tr></table></figure>

<h5 id="4-3-2-配置类"><a href="#4-3-2-配置类" class="headerlink" title="4.3.2 配置类"></a>4.3.2 配置类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DruidConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(DruidConfig.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AppConfig appConfig;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.url&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String dbUrl;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.username&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.password&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.driver-class-name&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String driverClassName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.initial-size&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> initialSize;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.min-idle&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> minIdle;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.max-active&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxActive;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.max-wait&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxWait;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.time-between-eviction-runs-millis&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> timeBetweenEvictionRunsMillis;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.min-evictable-idle-time-millis&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> minEvictableIdleTimeMillis;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.validation-query&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String validationQuery;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.test-while-idle&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> testWhileIdle;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.test-on-borrow&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> testOnBorrow;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.test-on-return&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> testOnReturn;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.pool-prepared-statements&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> poolPreparedStatements;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.max-pool-prepared-statement-per-connection-size&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxPoolPreparedStatementPerConnectionSize;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.filters&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String filters;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"&#123;spring.datasource.druid.connection-properties&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String connectionProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>     <span class="comment">//声明其为Bean实例</span></span><br><span class="line">    <span class="meta">@Primary</span>  <span class="comment">//在同样的DataSource中，首先使用被标注的DataSource</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DruidDataSource datasource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">        datasource.setUrl(dbUrl);</span><br><span class="line">        datasource.setUsername(username);</span><br><span class="line">        datasource.setPassword(password);</span><br><span class="line">        datasource.setDriverClassName(driverClassName);</span><br><span class="line">        <span class="comment">//configuration</span></span><br><span class="line">        datasource.setInitialSize(initialSize);</span><br><span class="line">        datasource.setMinIdle(minIdle);</span><br><span class="line">        datasource.setMaxActive(maxActive);</span><br><span class="line">        datasource.setMaxWait(maxWait);</span><br><span class="line">        datasource.setTimeBetweenEvictionRunsMillis(timeBetweenEvictionRunsMillis);</span><br><span class="line">        datasource.setMinEvictableIdleTimeMillis(minEvictableIdleTimeMillis);</span><br><span class="line">        datasource.setValidationQuery(validationQuery);</span><br><span class="line">        datasource.setTestWhileIdle(testWhileIdle);</span><br><span class="line">        datasource.setTestOnBorrow(testOnBorrow);</span><br><span class="line">        datasource.setTestOnReturn(testOnReturn);</span><br><span class="line">        datasource.setPoolPreparedStatements(poolPreparedStatements);</span><br><span class="line">        datasource.setMaxPoolPreparedStatementPerConnectionSize(maxPoolPreparedStatementPerConnectionSize);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            datasource.setFilters(filters);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">"druid configuration initialization filter"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        datasource.setConnectionProperties(connectionProperties);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> datasource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">druidServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//logger.info("init Druid Servlet Configuration ");</span></span><br><span class="line">        ServletRegistrationBean servletRegistrationBean = <span class="keyword">new</span> ServletRegistrationBean();</span><br><span class="line">        servletRegistrationBean.setServlet(<span class="keyword">new</span> StatViewServlet());</span><br><span class="line">        servletRegistrationBean.addUrlMappings(<span class="string">"/druid/*"</span>);</span><br><span class="line">        Map&lt;String, String&gt; initParameters = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        initParameters.put(<span class="string">"loginUsername"</span>, appConfig.getDruidUserName());<span class="comment">// 用户名</span></span><br><span class="line">        initParameters.put(<span class="string">"loginPassword"</span>, appConfig.getDruidPassword());<span class="comment">// 密码</span></span><br><span class="line">        initParameters.put(<span class="string">"resetEnable"</span>, appConfig.getDruidResetAll());<span class="comment">// 禁用HTML页面上的“Reset All”功能</span></span><br><span class="line">        initParameters.put(<span class="string">"allow"</span>, <span class="string">""</span>); <span class="comment">// IP白名单 (没有配置或者为空，则允许所有访问)</span></span><br><span class="line">        <span class="comment">//initParameters.put("deny", "192.168.20.38");// IP黑名单 (存在共同时，deny优先于allow)</span></span><br><span class="line">        servletRegistrationBean.setInitParameters(initParameters);</span><br><span class="line">        <span class="keyword">return</span> servletRegistrationBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">druidWebStatViewFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        FilterRegistrationBean registrationBean = <span class="keyword">new</span> FilterRegistrationBean(<span class="keyword">new</span> WebStatFilter());</span><br><span class="line">        registrationBean.addInitParameter(<span class="string">"urlPatterns"</span>, <span class="string">"/*"</span>);</span><br><span class="line">        registrationBean.addInitParameter(<span class="string">"exclusions"</span>, <span class="string">"*.js,*.gif,*.jpg,*.bmp,*.png,*.css,*.ico,/druid/*"</span>);</span><br><span class="line">        <span class="keyword">return</span> registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-4-使用方法"><a href="#4-4-使用方法" class="headerlink" title="4.4 使用方法"></a>4.4 使用方法</h4><p>本地访问 <a href="http://localhost:8080/druid" target="_blank" rel="noopener">http://localhost:8080/druid</a></p>
<h2 id="5-Redis缓存"><a href="#5-Redis缓存" class="headerlink" title="5. Redis缓存"></a>5. Redis缓存</h2><h3 id="5-1-Redis"><a href="#5-1-Redis" class="headerlink" title="5.1 Redis"></a>5.1 Redis</h3><h4 id="5-1-1-Redis是什么"><a href="#5-1-1-Redis是什么" class="headerlink" title="5.1.1 Redis是什么"></a>5.1.1 Redis是什么</h4><blockquote>
<p>Redis是一个开源（BSD许可），内存数据结构存储，用作数据库，缓存和消息代理。它支持数据结构，如 strings, hashes, lists, sets, sorted sets with range queries, bitmaps, hyperloglogs, geospatial indexes with radius queries and streams。Redis具有内置复制，Lua脚本，LRU驱逐，事务和不同级别的磁盘持久性，并通过Redis Sentinel提供高可用性并使用Redis Cluster自动分区</p>
</blockquote>
<blockquote>
<p>Redis通常被称为<em>数据结构</em>服务器，这意味着Redis通过一组命令提供对可变数据结构的访问，这些命令使用带有TCP套接字和简单协议的<code>server-client</code>模型发送。因此，不同的进程可以以共享方式和修改相同的数据结构。</p>
</blockquote>
<h4 id="5-1-2-Redis数据结构的特殊属性"><a href="#5-1-2-Redis数据结构的特殊属性" class="headerlink" title="5.1.2 Redis数据结构的特殊属性"></a>5.1.2 Redis数据结构的特殊属性</h4><ul>
<li>Redis关心将它们存储在磁盘上， 即使它们总是被提供并修改到内存服务器内存中。这意味着Redis速度很快，但这也是非易失性的</li>
<li>数据结构的实现强调内存效率，因此与使用高级变成语言建模的相同数据结构相比，Redis内部的数据结构可能会使用更少的内存</li>
<li>Redis提供了许多在数据库中很容易找到的功能，如复制，可调节的持久性，群集，高可用性。</li>
</ul>
<h3 id="5-2-Redis的应用场景"><a href="#5-2-Redis的应用场景" class="headerlink" title="5.2 Redis的应用场景"></a>5.2 Redis的应用场景</h3><h3 id="5-3-Redis的数据结构"><a href="#5-3-Redis的数据结构" class="headerlink" title="5.3 Redis的数据结构"></a>5.3 Redis的数据结构</h3><p><img src="https://upload-images.jianshu.io/upload_images/6751690-0dbb4c73b2761208.png?imageMogr2/auto-orient/" alt="img"></p>
<h3 id="5-4-Redis代替Session保存用户状态"><a href="#5-4-Redis代替Session保存用户状态" class="headerlink" title="5.4 Redis代替Session保存用户状态"></a>5.4 Redis代替Session保存用户状态</h3><h2 id="6-PageHelper"><a href="#6-PageHelper" class="headerlink" title="6. PageHelper"></a>6. PageHelper</h2><p>分页！</p>
<h5 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h5><p>注意：SpringBoot中要添加SpringBoot的starter，不然不能用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="添加配置"><a href="#添加配置" class="headerlink" title="添加配置"></a>添加配置</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pagehelper:</span></span><br><span class="line">  <span class="comment">#自动检测当前的数据库链接，自动选择合适的分页方式。可以指定使用的方言</span></span><br><span class="line"><span class="attr">  helperDialect:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="comment">#分页合理化参数，默认值为false，当设置为true时，pageNum&lt;=0时会查询第一页，pageNum&gt;pages总数时，会查询最后一页。</span></span><br><span class="line"><span class="attr">  reasonable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment">#支持通过Mapper接口参数来传递分页参数，默认值false，分页插件会从查询方法的参数值中，自动根据params配置的字段中取值，查找到合适的值就自动分页</span></span><br><span class="line"><span class="attr">  supportMethodsArguments:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment">#为了支持startPage(Object params)，增加了该参数来配置参数映射</span></span><br><span class="line">  <span class="comment">#用于从对象中根据属性名取值，可以配置 pageNum,pageSize,count,pageSizeZero,reasonable，</span></span><br><span class="line">  <span class="comment">#不配置映射时用默认值， 默认值为pageNum=pageNum;pageSize=pageSize;count=countSql;reasonable=reasonable;pageSizeZero=pageSizeZero。</span></span><br><span class="line"><span class="attr">  params:</span> <span class="string">count=countSql</span></span><br></pre></td></tr></table></figure>

<h5 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PageInfo&lt;UserInfo&gt; <span class="title">selectAll</span><span class="params">(Integer page, Integer size)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//开启分页查询，写在查询语句上方</span></span><br><span class="line">    <span class="comment">//只有紧跟在PageHelper.startPage方法后的第一个Mybatis的查询（Select）方法会被分页。</span></span><br><span class="line">    PageHelper.startPage(page, size);</span><br><span class="line">    List&lt;UserInfo&gt; userInfoList = userInfoMapper.selectAll();</span><br><span class="line">    PageInfo&lt;UserInfo&gt; pageInfo = <span class="keyword">new</span> PageInfo&lt;&gt;(userInfoList);</span><br><span class="line">    <span class="keyword">return</span> pageInfo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-单点登录"><a href="#7-单点登录" class="headerlink" title="7. 单点登录"></a>7. 单点登录</h2><p>cookie的安全性</p>
<p>跨域读取cookie</p>
<h2 id="8-Eureka"><a href="#8-Eureka" class="headerlink" title="8. Eureka"></a>8. Eureka</h2><h3 id="8-1-高可用注册中心"><a href="#8-1-高可用注册中心" class="headerlink" title="8.1 高可用注册中心"></a>8.1 高可用注册中心</h3><ol>
<li>所有节点即是服务的提供方，也是服务的消费方</li>
<li>将自己作为服务向其他服务中心注册自己，以实现服务清单的互相同步</li>
</ol>
<h3 id="8-2-搭建步骤"><a href="#8-2-搭建步骤" class="headerlink" title="8.2 搭建步骤"></a>8.2 搭建步骤</h3><h5 id="EnableEurekaServer声明注册中心"><a href="#EnableEurekaServer声明注册中心" class="headerlink" title="@EnableEurekaServer声明注册中心"></a><code>@EnableEurekaServer</code>声明注册中心</h5><h5 id="添加配置-1"><a href="#添加配置-1" class="headerlink" title="添加配置"></a>添加配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># server (eureka 默认端口为：8761)</span><br><span class="line">server.port=8761</span><br><span class="line"># 服务名</span><br><span class="line">spring.application.name=spring-cloud-server</span><br><span class="line"># 是否注册到eureka（eureka本身是不需要再注册到自己的）</span><br><span class="line">eureka.client.register-with-eureka=false</span><br><span class="line"># 是否从eureka获取注册信息</span><br><span class="line">eureka.client.fetch-registry=false</span><br><span class="line"># eureka服务器的地址（注意：地址最后面的 /eureka/ 这个是固定值）</span><br><span class="line">eureka.client.serviceUrl.defaultZone=http://localhost:$&#123;server.port&#125;/eureka/</span><br><span class="line">#服务失效时间，Eureka多长时间没收到服务的renew操作，就剔除该服务，默认90秒</span><br><span class="line">eureka.instance.leaseExpirationDurationInSeconds=15</span><br><span class="line">#eureka server清理无效节点的时间间隔，默认60000毫秒，即60秒</span><br><span class="line">eureka.server.evictionIntervalTimerInMs=20000</span><br><span class="line"># 自我保护模式（缺省为打开）</span><br><span class="line">eureka.server.enable-self-preservation: true</span><br><span class="line"># 续期时间，即扫描失效服务的间隔时间（缺省为60*1000ms）       </span><br><span class="line">eureka.server.eviction-interval-timer-in-ms: 5000</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>1.根据切面<code>AfterReturning</code>可以得到返回值，来为操作记录添加状态或者根据状态判断是否保存</p>
<p>2.少用异常，给前端统一的状态吗和错误信息</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/22/运维开发文档/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PPCoder">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/author.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/22/运维开发文档/" itemprop="url">ssh登录自用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-22T22:54:27+08:00">
                2019-09-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h2 id="SSH远程登录"><a href="#SSH远程登录" class="headerlink" title="SSH远程登录"></a>SSH远程登录</h2><p>ssh -p 22 <a href="mailto:root@111.111.111.111" target="_blank" rel="noopener">root@111.111.111.111</a></p>
<h2 id="服务器安全"><a href="#服务器安全" class="headerlink" title="服务器安全"></a>服务器安全</h2><p>白名单：/etc/hosts.allow</p>
<p>黑名单：/etc/hosts.deny</p>
<p>sshd:xxx.xxx.xxx.xxx:deny</p>
<p>多次登录失败加入黑名单脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#脚本来源：https://www.cnblogs.com/panblack/p/secure_ssh_auto_block.html</span><br><span class="line"></span><br><span class="line">#脚本地址：/usr/local/bin/secure_ssh.sh</span><br><span class="line">#! /bin/bash</span><br><span class="line">cat /var/log/secure|awk &apos;/Failed/&#123;print $(NF-3)&#125;&apos;|sort|uniq -c|awk &apos;&#123;print $2&quot;=&quot;$1;&#125;&apos; &gt; /usr/local/bin/black.list</span><br><span class="line">for i in `cat  /usr/local/bin/black.list`</span><br><span class="line">do</span><br><span class="line">  IP=`echo $i |awk -F= &apos;&#123;print $1&#125;&apos;`</span><br><span class="line">  NUM=`echo $i|awk -F= &apos;&#123;print $2&#125;&apos;`</span><br><span class="line">  if [ $&#123;#NUM&#125; -gt 1 ]; then</span><br><span class="line">    grep $IP /etc/hosts.deny &gt; /dev/null</span><br><span class="line">    if [ $? -gt 0 ];then</span><br><span class="line">      echo &quot;sshd:$IP:deny&quot; &gt;&gt; /etc/hosts.deny</span><br><span class="line">    fi</span><br><span class="line">  fi</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">#定时执行</span><br><span class="line"># crontab -e</span><br><span class="line">*/1 * * * *  sh /usr/local/bin/secure_ssh.sh</span><br></pre></td></tr></table></figure>

<h4 id="sshd-config-配置"><a href="#sshd-config-配置" class="headerlink" title="sshd_config 配置"></a>sshd_config 配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#####ssh server整体设定#####</span><br><span class="line">#端口</span><br><span class="line">Port 1007</span><br><span class="line">#安全协议</span><br><span class="line">#protocol 1存在漏洞，使用时建议改为2，客户端openssh7.4以上不再支持v1</span><br><span class="line">Protocol 1,2</span><br><span class="line"></span><br><span class="line">#####安全认证#####</span><br><span class="line">#用户登录失败，在切断连接前服务器需要等待的时间</span><br><span class="line">LoginGraceTime 2m</span><br><span class="line"></span><br><span class="line">#####登录后设置#####</span><br><span class="line">#打印上一次登录信息</span><br><span class="line">PrintLastLog yes</span><br><span class="line">#最大失败次数</span><br><span class="line">#当失败次数太多时，修改白名单即可</span><br><span class="line">MaxAuthTries 2</span><br><span class="line">#ssh最大连接个数</span><br><span class="line">MAxStartups 5</span><br></pre></td></tr></table></figure>

<p>service sshd reload –&gt; 生效</p>
<h2 id="防火墙firewall"><a href="#防火墙firewall" class="headerlink" title="防火墙firewall"></a>防火墙firewall</h2><p>启动：systemctl start firewall或systemctl start firewalld.service</p>
<p>开机自启：systemctl enable firewall</p>
<p>添加端口：firewall-cmd –zone=public –add-port=443/tcp –permanent</p>
<p>查看端口：firewall-cmd –permanent –list-port</p>
<p>修改配置文件后重新加载配置：firewall-cmd –reload</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/author.jpg" alt="PPCoder">
            
              <p class="site-author-name" itemprop="name">PPCoder</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/ppCoder" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:dml_pig@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">PPCoder</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
