<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="微服务 微服务架构是一种架构模式，它提倡将单一应用程序划分成一组小的服务，服务之间相互协调、互相配合，为用户提供最终价值。每个服务运行在其独立的进程中，服务和服务之间采用轻量级的通信机制相互沟通（通常是基于HTTP的Restful API). 每个服务都围绕着具体的业务进行构建，并且能够被独立的部署到生产环境、类生产环境等。另外，应尽量避免统一的、集中的服务管理机制，对具体的一个服务而言，应根据业">
<meta property="og:type" content="article">
<meta property="og:title" content="微服务学习">
<meta property="og:url" content="http://yoursite.com/2019/10/03/SpringCloud/index.html">
<meta property="og:site_name" content="Yun">
<meta property="og:description" content="微服务 微服务架构是一种架构模式，它提倡将单一应用程序划分成一组小的服务，服务之间相互协调、互相配合，为用户提供最终价值。每个服务运行在其独立的进程中，服务和服务之间采用轻量级的通信机制相互沟通（通常是基于HTTP的Restful API). 每个服务都围绕着具体的业务进行构建，并且能够被独立的部署到生产环境、类生产环境等。另外，应尽量避免统一的、集中的服务管理机制，对具体的一个服务而言，应根据业">
<meta property="og:locale" content="en">
<meta property="og:image" content="c:%5CUsers%5CEDZ%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1562647212344.png">
<meta property="og:image" content="c:%5CUsers%5CEDZ%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1562663773534.png">
<meta property="og:image" content="c:%5CUsers%5CEDZ%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1562663919656.png">
<meta property="og:updated_time" content="2019-12-26T07:40:41.804Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="微服务学习">
<meta name="twitter:description" content="微服务 微服务架构是一种架构模式，它提倡将单一应用程序划分成一组小的服务，服务之间相互协调、互相配合，为用户提供最终价值。每个服务运行在其独立的进程中，服务和服务之间采用轻量级的通信机制相互沟通（通常是基于HTTP的Restful API). 每个服务都围绕着具体的业务进行构建，并且能够被独立的部署到生产环境、类生产环境等。另外，应尽量避免统一的、集中的服务管理机制，对具体的一个服务而言，应根据业">
<meta name="twitter:image" content="c:%5CUsers%5CEDZ%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1562647212344.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/10/03/SpringCloud/">





  <title>微服务学习 | Yun</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Yun</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Code and Love.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/03/SpringCloud/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PPCoder">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/author.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">微服务学习</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-03T13:45:51+08:00">
                2019-10-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="微服务"><a href="#微服务" class="headerlink" title="微服务"></a>微服务</h1><blockquote>
<p>微服务架构是一种架构模式，它提倡将单一应用程序划分成一组小的服务，服务之间相互协调、互相配合，为用户提供最终价值。每个服务运行在其独立的进程中，服务和服务之间采用轻量级的通信机制相互沟通（通常是基于HTTP的Restful API).</p>
<p>每个服务都围绕着具体的业务进行构建，并且能够被独立的部署到生产环境、类生产环境等。另外，应尽量避免统一的、集中的服务管理机制，对具体的一个服务而言，应根据业务上下文，选择合适的语言、工具对其进行构</p>
</blockquote>
<p>微服务：从业务层面对项目进行分割，注重项目粒度的划分，项目之间独立部署并通过协议进行数据交互</p>
<p>将应用分割为一系列细小的服务，每个服务专注于单一的功能，运行在独立的进程中</p>
<h3 id="服务的发现与注册"><a href="#服务的发现与注册" class="headerlink" title="服务的发现与注册"></a>服务的发现与注册</h3><blockquote>
<p>一般的微服务架构里都有两层API GetWay，</p>
<ul>
<li><p>外部API GetWay，用于用户访问系统；</p>
</li>
<li><p>内部API GetWay，内部服务之间的API GetWay，内部API GetWay要解决的问题就是服务发现和服务注册。API Gateway还可能有其他功能，如授权、监控、负载均衡、缓存、请求分片和管理、静态响应处理等。 </p>
</li>
</ul>
<p>从这也能看出来，为什么通信的方式要尽量单一，API GetWay有一项工作就是协议转换。</p>
</blockquote>
<h3 id="高可用性"><a href="#高可用性" class="headerlink" title="高可用性"></a>高可用性</h3><blockquote>
<p>描述一个系统经过专门的设计，从而减少停工时间，而保持其服务的高度可用性</p>
</blockquote>
<h4 id="负载均衡服务器的高可用性"><a href="#负载均衡服务器的高可用性" class="headerlink" title="负载均衡服务器的高可用性"></a>负载均衡服务器的高可用性</h4><p>建立一个备份机，监控主机的运行状况，如果备份机不能接收到主机的信息时，就接管主机的服务ip继续提供服务，如果又收到了主机的信息时，就释放服务ip地址。主，备份机之间实现系统配置信息的同步</p>
<h2 id="Dubbo"><a href="#Dubbo" class="headerlink" title="Dubbo"></a>Dubbo</h2><p>RPC框架，通讯协议是RPC协议</p>
<ol>
<li>被远程调用的接口，需要在<code>zookeeper</code>中进行注册</li>
<li>需要远程调用的服务在<code>zookeeper</code>中声明自己需要的接口</li>
<li><code>zookeeper</code>将已经注册的接口通知给需要的服务</li>
</ol>
<h2 id="Spring-Cloud"><a href="#Spring-Cloud" class="headerlink" title="Spring Cloud"></a>Spring Cloud</h2><p>RPC框架，通讯协议是HTTP RESTful协议</p>
<blockquote>
<p>Spring Cloud是一系列框架的有序集合。</p>
<p>它利用Spring Boot的开发便利性巧妙地简化了分布式系统基础设施的开发，如服务发现注册、配置中心、消息总线、负载均衡、断路器、数据监控等，都可以用Spring Boot的开发风格做到一键启动和部署。</p>
<p>Spring并没有重复制造轮子，它只是将目前各家公司开发的比较成熟、经得起实际考验的服务框架组合起来，通过Spring Boot风格进行再封装屏蔽掉了复杂的配置和实现原理，最终给开发者留出了一套简单易懂、易部署和易维护的分布式系统开发工具包。</p>
</blockquote>
<p><img src="C:%5CUsers%5CEDZ%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1562647212344.png" alt="1562647212344"></p>
<h4 id="版本冲突详见"><a href="#版本冲突详见" class="headerlink" title="版本冲突详见"></a>版本冲突详见</h4><ul>
<li><p>Angel版本基于<code>Spring Boot1.2.x</code>构建，在一些场景下，与<code>Spring Boot1.3.x</code>及以上版本不兼容。</p>
</li>
<li><p><code>Brixton</code>版本基于<code>Spring Boot1.3.x</code>构建，也可使用<code>1.4.x</code>进行测试，与<code>Spring Boot1.2.x</code>不兼容。</p>
</li>
<li><p><code>Camden</code>版本基于<code>Spring Boot1.4.x</code>构建，也可使用<code>1.5.x</code>进行测试。</p>
</li>
<li><p><code>Dalston</code>版本基于<code>Spring Boot1.5.x</code>构建，不兼容<code>Spring Boot2.0.x</code>。</p>
</li>
<li><p><code>Edgware</code>版本基于<code>Spring Boot1.5.x</code>构建，不兼容<code>Spring Boot2.0.x</code>。</p>
</li>
<li><p><code>Finchley</code>版本基于<code>Spring Boot2.0.x</code>构建，不兼容<code>Spring Boot1.x</code>。</p>
</li>
<li><p><code>Greenwich</code>版本基于<code>Spring Boot2.1.x</code>构建，不兼容<code>Spring Boot2.x</code>。</p>
</li>
</ul>
<p>!注意：发生<code>NoClasses</code>等问题时，查找各组件对应的SpringBoot版本号，动态的调整，SpringCloud只能表示大部分组件，并不能代表所有组件都支持最新</p>
<p>#### </p>
<h2 id="SpringCloud组件"><a href="#SpringCloud组件" class="headerlink" title="SpringCloud组件"></a>SpringCloud组件</h2><h3 id="Netflix"><a href="#Netflix" class="headerlink" title="Netflix"></a>Netflix</h3><p>对Netflix公司一系列开源产品的包装，它为Spring Boot应用提供了自配置的Netflix OSS整合。</p>
<h4 id="Eureka"><a href="#Eureka" class="headerlink" title="Eureka"></a>Eureka</h4><blockquote>
<p>服务中心，云端服务发现，一个基于 REST 的服务，用于定位服务，以实现云端中间层服务发现和故障转移。</p>
</blockquote>
<p>服务中心，提供服务，保证稳定性和质量。</p>
<p>包含两个组件：Eureka Server（服务端）和Eureka Client（客户端）</p>
<ul>
<li><p>Eureka Server：</p>
<blockquote>
<p>提供服务注册服务，各个节点启动会，会在Server中进行注册，包括主机与端口号，服务版本号，通讯协议等。</p>
<p>支持集群模式部署，集群中的不同服务注册中心通过异步模式相互复制各自的状态，这也意味着在给定的时间点每个实例关于所有服务的状态可能存在不一致的现象</p>
</blockquote>
</li>
<li><p>Eureka Client：</p>
<blockquote>
<p>处理服务的注册和发现，客户端服务通过注册和参数配置的方式，嵌入在客户端应用程序的代码中。</p>
</blockquote>
</li>
</ul>
<p>在应用启动时，Eureka客户端向服务端注册自己的服务信息，同时将服务端的服务信息缓存到本地。客户端会和服务端周期性的进行心跳交互，以更新服务租约和服务信息。</p>
<h4 id="Ribbon"><a href="#Ribbon" class="headerlink" title="Ribbon"></a>Ribbon</h4><p><img src="C:%5CUsers%5CEDZ%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1562663773534.png" alt="1562663773534"></p>
<blockquote>
<p>Spring Cloud Ribbon是一个基于HTTP和TCP的客户端负载均衡工具，它基于Netflix Ribbon实现。通过Spring Cloud的封装，可以让我们轻松地将面向服务的REST模版请求自动转换成客户端负载均衡的服务调用。</p>
</blockquote>
<p>作用：提供客户侧的软件负载均衡算法</p>
<h4 id="Hystrix"><a href="#Hystrix" class="headerlink" title="Hystrix"></a>Hystrix</h4><p><img src="C:%5CUsers%5CEDZ%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1562663919656.png" alt="1562663919656"></p>
<blockquote>
<p>熔断器，容错管理工具，旨在通过熔断机制控制服务和第三方库的节点,从而对延迟和故障提供更强大的容错能力。</p>
</blockquote>
<p>熔断器，服务无法正常使用，防止其他服务多次请求造成堵塞和浪费连接，将服务熔断，停止访问。</p>
<blockquote>
<p>为了保证其高可用，单个服务通常会集群部署。由于网络原因或者自身的原因，服务并不能保证100%可用，如果单个服务出现问题，调用这个服务就会出现线程阻塞，此时若有大量的请求涌入，Servlet容器的线程资源会被消耗完毕，导致服务瘫痪。服务与服务之间的依赖性，故障会传播，会对整个微服务系统造成灾难性的严重后果，这就是服务故障的“雪崩”效应。</p>
</blockquote>
<h4 id="Zuul"><a href="#Zuul" class="headerlink" title="Zuul"></a>Zuul</h4><blockquote>
<p>Zuul 是在云平台上提供动态路由,监控,弹性,安全等边缘服务的框架。</p>
<p>Zuul 相当于是设备和 Netflix 流应用的 Web 网站后端所有请求的前门。</p>
<p>智能路由，拦截和转发非法请求，api网关，负载均衡</p>
</blockquote>
<h4 id="Archaius"><a href="#Archaius" class="headerlink" title="Archaius"></a>Archaius</h4><blockquote>
<p>配置管理API，包含一系列配置管理API，提供动态类型化属性、线程安全配置操作、轮询框架、回调机制等功能。可以实现动态获取配置， 原理是每隔60s（默认，可配置）从配置源读取一次内容，这样修改了配置文件后不需要重启服务就可以使修改后的内容生效，前提使用Archaius的API来读取。</p>
</blockquote>
<p>动态获取配置</p>
<h3 id="Spring-Cloud-1"><a href="#Spring-Cloud-1" class="headerlink" title="Spring Cloud"></a>Spring Cloud</h3><h4 id="Config"><a href="#Config" class="headerlink" title="Config"></a>Config</h4><blockquote>
<p>俗称的配置中心，配置管理工具包，让你可以把配置放到远程服务器，集中化管理集群配置，目前支持本地存储、Git以及Subversion。</p>
</blockquote>
<p>配置中心，收集管理所有配置，方便上传到云端</p>
<blockquote>
<p>SpringCloud Config提供服务器端和客户端。服务器存储后端的默认实现使用git，因此它轻松支持标签版本的配置环境，以及可以访问用于管理内容的各种工具。</p>
</blockquote>
<h4 id="Bus"><a href="#Bus" class="headerlink" title="Bus"></a>Bus</h4><blockquote>
<p>事件、消息总线，用于在集群（例如，配置变化事件）中传播状态变化，可与Spring Cloud Config联合实现热部署。</p>
</blockquote>
<p>相当于水浒传中日行八百里的神行太保戴宗，确保各个小弟之间消息保持畅通。</p>
<h4 id="Cloud-Foundry"><a href="#Cloud-Foundry" class="headerlink" title="Cloud Foundry"></a>Cloud Foundry</h4><blockquote>
<p>Cloud Foundry是VMware推出的业界第一个开源PaaS云平台，它支持多种框架、语言、运行时环境、云平台及应用服务，使开发人员能够在几秒钟内进行应用程序的部署和扩展，无需担心任何基础架构的问题</p>
</blockquote>
<p>其实就是与CloudFoundry进行集成的一套解决方案，抱了Cloud Foundry的大腿。</p>
<h4 id="Cluster"><a href="#Cluster" class="headerlink" title="Cluster"></a>Cluster</h4><blockquote>
<p>Spring Cloud Cluster将取代Spring Integration。提供在分布式系统中的集群所需要的基础功能支持，如：选举、集群的状态一致性、全局锁、tokens等常见状态模式的抽象和实现。</p>
</blockquote>
<p>如果把不同的帮派组织成统一的整体，Spring Cloud Cluster已经帮你提供了很多方便组织成统一的工具。</p>
<h4 id="Consul"><a href="#Consul" class="headerlink" title="Consul"></a>Consul</h4><blockquote>
<p>Consul 是一个支持多数据中心分布式高可用的服务发现和配置共享的服务软件</p>
<p>Spring Cloud Consul 封装了Consul操作，consul是一个服务发现与配置工具，与Docker容器可以无缝集成。</p>
</blockquote>
<p>特征：</p>
<ul>
<li>服务发现</li>
<li>健康检查</li>
<li>Key/Value存储</li>
<li>多数据中心</li>
</ul>
<h4 id="Security"><a href="#Security" class="headerlink" title="Security"></a>Security</h4><p>基于spring security的安全工具包，为你的应用程序添加安全控制。这个小弟很牛鼻专门负责整个帮派的安全问题，设置不同的门派访问特定的资源，不能把秘籍葵花宝典泄漏了。</p>
<h4 id="Sleuth"><a href="#Sleuth" class="headerlink" title="Sleuth"></a>Sleuth</h4><p>日志收集工具包，封装了Dapper和log-based追踪以及Zipkin和HTrace操作，为SpringCloud应用实现了一种分布式追踪解决方案。</p>
<h4 id="Data-Flow"><a href="#Data-Flow" class="headerlink" title="Data Flow"></a>Data Flow</h4><ul>
<li>Data flow 是一个用于开发和执行大范围数据处理其模式包括ETL，批量运算和持续运算的统一编程模型和托管服务。</li>
<li>对于在现代运行环境中可组合的微服务程序来说，Spring Cloud data flow是一个原生云可编配的服务。使用Spring Cloud data flow，开发者可以为像数据抽取，实时分析，和数据导入/导出这种常见用例创建和编配数据通道 （data pipelines）。</li>
<li>Spring Cloud data flow 是基于原生云对 spring XD的重新设计，该项目目标是简化大数据应用的开发。Spring XD 的流处理和批处理模块的重构分别是基于 Spring Boot的stream 和 task/batch 的微服务程序。这些程序现在都是自动部署单元而且他们原生的支持像 Cloud Foundry、Apache YARN、Apache Mesos和Kubernetes 等现代运行环境。</li>
<li>Spring Cloud data flow 为基于微服务的分布式流处理和批处理数据通道提供了一系列模型和最佳实践。</li>
</ul>
<h4 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h4><p>Spring Cloud Stream是创建消息驱动微服务应用的框架。Spring Cloud Stream是基于Spring Boot创建，用来建立单独的／工业级spring应用，使用spring integration提供与消息代理之间的连接。数据流操作开发包，封装了与Redis,Rabbit、Kafka等发送接收消息。</p>
<p>一个业务会牵扯到多个任务，任务之间是通过事件触发的，这就是Spring Cloud stream要干的事了</p>
<h4 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h4><p>Spring Cloud Task 主要解决短命微服务的任务管理，任务调度的工作，比如说某些定时任务晚上就跑一次，或者某项数据分析临时就跑几次。</p>
<h4 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h4><blockquote>
<p><code>ZooKeeper</code>是一个分布式的，开放源码的分布式应用程序协调服务，是Google的Chubby一个开源的实现，是<code>Hadoop</code>和<code>Hbase</code>的重要组件。它是一个为分布式应用提供一致性服务的软件，提供的功能包括：配置维护、域名服务、分布式同步、组服务等。<code>ZooKeeper</code>的目标就是封装好复杂易出错的关键服务，将简单易用的接口和性能高效、功能稳定的系统提供给用户。</p>
</blockquote>
<p>操作<code>Zookeeper</code>的工具包，用于使用<code>zookeeper</code>方式的服务发现和配置管理，抱了<code>Zookeeper</code>的大腿。</p>
<h4 id="Connectors"><a href="#Connectors" class="headerlink" title="Connectors"></a>Connectors</h4><blockquote>
<p>Spring Cloud Connectors 简化了连接到服务的过程和从云平台获取操作的过程，有很强的扩展性，可以利用Spring Cloud Connectors来构建你自己的云平台。</p>
<p>便于云端应用程序在各种<code>PaaS</code>平台连接到后端，如：数据库和消息代理服务。</p>
</blockquote>
<h4 id="Starters"><a href="#Starters" class="headerlink" title="Starters"></a>Starters</h4><blockquote>
<p>Spring Boot式的启动项目，为Spring Cloud提供开箱即用的依赖管理。</p>
</blockquote>
<h4 id="CLI"><a href="#CLI" class="headerlink" title="CLI"></a>CLI</h4><blockquote>
<p>基于 Spring Boot CLI，可以让你以命令行方式快速建立云组件。</p>
</blockquote>
<h2 id="Dalston版"><a href="#Dalston版" class="headerlink" title="Dalston版"></a>Dalston版</h2><h3 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>12<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring-cloud.version</span>&gt;</span>Dalston.SR1<span class="tag">&lt;/<span class="name">spring-cloud.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--eureka server --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-eureka-server</span><br><span class="line">    <span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.xml.bind<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxb-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun.xml.bind<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxb-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.glassfish.jaxb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxb-runtime<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.activation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- jaxb模块引用 - end --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Eureka-Service"><a href="#Eureka-Service" class="headerlink" title="Eureka Service"></a>Eureka Service</h3><h3 id="Zuul网关"><a href="#Zuul网关" class="headerlink" title="Zuul网关"></a>Zuul网关</h3><h5 id="路由规则"><a href="#路由规则" class="headerlink" title="路由规则"></a>路由规则</h5><blockquote>
<p>路由规则包含两部分，一部分是外部请求的匹配规则，另一部分是路由的服务ID</p>
</blockquote>
<h5 id="默认路由规则："><a href="#默认路由规则：" class="headerlink" title="默认路由规则："></a>默认路由规则：</h5><blockquote>
<p>当zuul网关启动并注册到服务中心之后，服务网关会在注册中心发现我们启动的两个服务，网关就会创建两个对应的路由规则</p>
</blockquote>
<h5 id="传统路由配置"><a href="#传统路由配置" class="headerlink" title="传统路由配置"></a>传统路由配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#单实例配置</span><br><span class="line">zuul.routes.&lt;route&gt;.path=/user-service/**</span><br><span class="line">zuul.routes.&lt;route&gt;.url=http://localhost:8080/</span><br><span class="line">-------------------------------------------</span><br><span class="line">#多实例配置</span><br><span class="line">zuul.routes.&lt;route&gt;.path=/user-service/**</span><br><span class="line">zuul.routes.&lt;route&gt;.serviceId=user-service</span><br><span class="line">#serviceID:用户手工命名的服务名称</span><br><span class="line"></span><br><span class="line">#ribbon.eureka.enabled：由于zuul.routes.&lt;route&gt;.serviceId指定的是服务名称，默认情况下Ribbon会根据服务发现机制来获取配置服务名对应的实例清单。但是，该示例并没有整合类似Eureka之类的服务治理框架，所以需要将该参数设置为false，不然配置的serviceId是获取不到对应实例清单的。</span><br><span class="line">ribbon.eureka.enabled=false</span><br><span class="line">#进行转发的时候实现负载均衡</span><br><span class="line">#对多个实例进行路由转发时需要实现负载均衡策略，并且Zuul中自带Ribbon依赖</span><br><span class="line">&lt;serviceId&gt;.ribbon.listOfServers=http://localhost:8080/,http://localhost:8081/</span><br></pre></td></tr></table></figure>

<h5 id="服务路由配置"><a href="#服务路由配置" class="headerlink" title="服务路由配置"></a>服务路由配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zuul.routes.&lt;route&gt;.path=/user-service/**</span><br><span class="line">zuul.routes.&lt;route&gt;.serviceId=user-service</span><br><span class="line">--------------------------------------------</span><br><span class="line">zuul.routes.&lt;route&gt;=/user-service/**</span><br></pre></td></tr></table></figure>

<h2 id="Finchley版"><a href="#Finchley版" class="headerlink" title="Finchley版"></a>Finchley版</h2><h3 id="配置环境-1"><a href="#配置环境-1" class="headerlink" title="配置环境"></a>配置环境</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--开启安全模块:spring.security.user.name进行配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>Finchley.SR2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Eureka-1"><a href="#Eureka-1" class="headerlink" title="Eureka"></a>Eureka</h3><h4 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server.port=8761</span><br><span class="line"></span><br><span class="line">#true：注册到defaultZone对应的server中，|是否将自己注册到server</span><br><span class="line">eureka.client.register-with-eureka=false</span><br><span class="line">#true：从server获取注册信息并缓存到本地 |是否从server获取注册信息</span><br><span class="line">eureka.client.fetch-registry=false</span><br><span class="line"></span><br><span class="line">logging.level.com.netflix.eureka=OFF</span><br><span class="line">logging.level.com.netflix.discovery=OFF</span><br></pre></td></tr></table></figure>

<p><code>Eureka</code>：一个<code>instane</code>通过<code>instanceId</code>来唯一标识，如果没有这个值就用<code>eureka.instance.metadataMap.instanceId</code>来代替</p>
<p><code>SpringCLoud</code>：默认值是<code>spring.application.name</code>，没有设置则为UNKNOWN</p>
<p><code>eureka.instance.instanceId</code>不设置时，直接使用缺省值(<code>client.hostname:appliation.name:port</code>)</p>
<h5 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br></pre></td></tr></table></figure>

<h5 id="失效剔除"><a href="#失效剔除" class="headerlink" title="失效剔除"></a>失效剔除</h5><p>默认每隔一段时间（默认60s）将当前清单中超时（默认90s）没有续约的服务剔除出去</p>
<h5 id="自我保护"><a href="#自我保护" class="headerlink" title="自我保护"></a>自我保护</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 自我保护机制：</span><br><span class="line"># Eureka Server在运行期间，会统计心跳失败的比例在15分钟之内是否低于85%，</span><br><span class="line"># 如果出现低于的情况（在单机调试的时候很容易满足，实际在生产环境上通常是由</span><br><span class="line"># 于网络不稳定导致），Eureka Server会将当前的实例注册信息保护起来，同时提示这个警告。</span><br><span class="line"># 关闭后，会在服务停止后大约3分钟，将服务剔除Eureka Server。</span><br><span class="line">eureka.server.enable-self-preservation=false</span><br></pre></td></tr></table></figure>

<h5 id="【未解决】-添加用户认证"><a href="#【未解决】-添加用户认证" class="headerlink" title="【未解决】*添加用户认证"></a>【未解决】*添加用户认证</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--开启安全认证--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">    security:</span></span><br><span class="line"><span class="attr">        user:</span></span><br><span class="line"><span class="attr">          name:</span> <span class="string">user</span></span><br><span class="line"><span class="attr">          password:</span> <span class="number">1234</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    service-url:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://user:1234@eureka-server2:8762/eureka/</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConf</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//spring cloud 2.0 默认启用csrf校验</span></span><br><span class="line">        http.csrf().disable();</span><br><span class="line">        <span class="keyword">super</span>.configure(http);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Eureka的元数据"><a href="#Eureka的元数据" class="headerlink" title="Eureka的元数据"></a>Eureka的元数据</h5><ul>
<li><p>标准元数据：主机名，IP地址，端口号，状态页，健康检查，这些信息被发布在服务注册表中，用于服务之间的调用</p>
</li>
<li><p>自定义元数据：eureka.instance.metadata-map配置。这些元数据可以在远程客户端中访问，但一般不会改变客户端的行为，除非客户端知道该元数据的含义</p>
</li>
</ul>
<h5 id="多网卡环境下的ip选择"><a href="#多网卡环境下的ip选择" class="headerlink" title="多网卡环境下的ip选择"></a>多网卡环境下的ip选择</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">	<span class="attr">cloud:</span></span><br><span class="line">		<span class="attr">inetutils:</span> </span><br><span class="line">            <span class="comment">#忽略指定名称的网卡</span></span><br><span class="line"><span class="attr">            ignored-interfaces:</span></span><br><span class="line"><span class="bullet">             -</span> <span class="string">docker0</span></span><br><span class="line"><span class="bullet">             -</span> <span class="string">veth.*</span></span><br><span class="line">            <span class="comment">#正则指定网络地址</span></span><br><span class="line"><span class="attr">            preferredNetworks:</span> </span><br><span class="line"><span class="bullet">            -</span> <span class="number">192.168</span></span><br><span class="line"><span class="bullet">            -</span> <span class="number">10.0</span></span><br><span class="line">            <span class="comment">#只使用站点本地地址</span></span><br><span class="line"><span class="attr">            useOnlySiteLocalInterfaces:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">eureka:</span> </span><br><span class="line">	<span class="attr">instance:</span> </span><br><span class="line">	<span class="comment">#将自己的ip注册到server，默认为false，会注册hostname到server</span></span><br><span class="line">		<span class="attr">prefer-ip-address:</span> <span class="literal">true</span></span><br><span class="line">		<span class="comment">#手动指定注册到server的微服务ip</span></span><br><span class="line">		<span class="attr">ip-address:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<h4 id="Server的高可用"><a href="#Server的高可用" class="headerlink" title="Server的高可用"></a>Server的高可用</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改主机host</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">eureka-server</span></span><br><span class="line"><span class="attr">  profiles:</span></span><br><span class="line"><span class="attr">    active:</span> <span class="string">dev3</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span> <span class="string">dev1</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8761</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    service-url:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://eureka-server2:8762/eureka/</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line"><span class="attr">    hostname:</span> <span class="string">eureka-server1</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span> <span class="string">dev2</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8762</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    service-url:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://eureka-server3:8763/eureka/</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line"><span class="attr">    hostname:</span> <span class="string">eureka-server2</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span> <span class="string">dev3</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8763</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    service-url:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://eureka-server1:8761/eureka/</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line"><span class="attr">    hostname:</span> <span class="string">eureka-server3</span></span><br></pre></td></tr></table></figure>

<h4 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h4><p>通过发送REST请求的方式将自己注册到Server上， 同时带上了自身服务的一些元数据信息，Server将元数据信息存储在一个双层Map中，其中第一层MapKey是服务名，第二层key是具体服务的实例名</p>
<h5 id="首次注册"><a href="#首次注册" class="headerlink" title="首次注册"></a>首次注册</h5><p>首次心跳在Client启动后的30s，在这之前，instance不会出现在注册中心</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    serviceUrl:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://localhost:8761/eureka/</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line">    <span class="comment">#将自己的ip注册到server，默认为false，会注册hostname到server</span></span><br><span class="line"><span class="attr">    prefer-ip-address:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8762</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line">  <span class="comment">#指定注册到server上的应用名称</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">service-hi</span></span><br></pre></td></tr></table></figure>

<h5 id="服务续约"><a href="#服务续约" class="headerlink" title="服务续约"></a>服务续约</h5><p>服务注册后，会维持一个心跳用来持续的告诉Server我还活着，防止被Server剔除任务“将服务实例从服务列表中排除出去。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#定义服务续约任务的调用间隔时间</span><br><span class="line">eureka.instance.lease-renewal-interval-in-seconds=30</span><br><span class="line">#定义服务失效的时间</span><br><span class="line">eureka.instance.lease-expiration-duration-in-seconds=90</span><br><span class="line"></span><br><span class="line">#从server获取注册信息并缓存到本地</span><br><span class="line">eureka.client.fetch-registry=true</span><br><span class="line">#增量获取信息，如果为false，则强制每次获取全部注册信息</span><br><span class="line">eureka.client.shouldDisableDelta=true</span><br><span class="line">#异步任务，如果操作失败，以2的指数形式延长重试时间</span><br><span class="line">#修改缓存清单的更新时间</span><br><span class="line">eureka.client.registry-fetch-interval-seconds=30</span><br><span class="line"></span><br><span class="line">#Eureka的自我保护机制</span><br><span class="line"> eureka.server.enable-self-preservation</span><br></pre></td></tr></table></figure>

<h5 id="服务注册"><a href="#服务注册" class="headerlink" title="服务注册"></a>服务注册</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="comment">//EnableDiscoveryClient为各种服务组件提供了支持，是一个spring-cloud-commons项目注解，高度抽象</span></span><br><span class="line"><span class="comment">//EnableEurekaCLient是Netflix项目中的注解，只能与Eureka一起工作，当用Eureka服务注册中心是没有区别</span></span><br></pre></td></tr></table></figure>

<p>启动的时候会通过发送REST请求的方式将自己注册到Server上，同时带上了自身服务的一些元数据信息</p>
<h5 id="服务下线"><a href="#服务下线" class="headerlink" title="服务下线"></a>服务下线</h5><p>当服务实例进行正常的关闭操作时，它会出发一个服务下线的REST请求给Server，告诉服务注册中心：我要下线了</p>
<h5 id="健康检查"><a href="#健康检查" class="headerlink" title="健康检查"></a>健康检查</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#更细粒度控制健康检查，实现HealthCheckHandler接口</span></span><br><span class="line"><span class="attr">eureka:</span> </span><br><span class="line">	<span class="attr">client:</span> </span><br><span class="line">		<span class="comment">#该配置只能配置在application中，配置在bootstrap中有副作用：应用注册到server上状态是unknown</span></span><br><span class="line">		<span class="attr">healthcheck:</span> </span><br><span class="line">			<span class="comment">#actuator的/pause端点会失效，无法标记服务为DOWN</span></span><br><span class="line">			<span class="attr">enable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h4 id="客户端和服务端区别"><a href="#客户端和服务端区别" class="headerlink" title="客户端和服务端区别"></a>客户端和服务端区别</h4><h5 id="客户端模式"><a href="#客户端模式" class="headerlink" title="客户端模式"></a>客户端模式</h5><p>进行微服务调用，首先到服务注册中心获取服务列表，根据调用段本地的负载均衡策略，进行服务调用</p>
<h5 id="服务端模式"><a href="#服务端模式" class="headerlink" title="服务端模式"></a>服务端模式</h5><p>调用方直接向服务注册中心进行请求，服务注册中心再通过自身负载均衡策略，对微服务进行调用。这个模式下，调用方不需要在自身节点维护服务发现逻辑以及服务注册信息，这个模式类似于DNS模式</p>
<table>
<thead>
<tr>
<th>客户端模式</th>
<th>服务端模式</th>
</tr>
</thead>
<tbody><tr>
<td>只需要周期性获取列表，在调用服务时可以注解调用，少了一个RT，但需要在每个客户端维护获取列表的逻辑</td>
<td>简单，不需要在客户端维护获取服务列表的逻辑</td>
</tr>
<tr>
<td>可用性高，即使注册中心故障也能正常工作</td>
<td>可用性由路由器中间件决定，路由中间件故障则所有服务不可用，同时，由于所有调度以及存储都由中间件服务器完成，中间件服务器可能会面临过高的负载</td>
</tr>
<tr>
<td>服务上下线对调用方有影响（会出现短暂的调用失败）</td>
<td>服务上下线调用方无感知</td>
</tr>
</tbody></table>
<h3 id="Ribbon-1"><a href="#Ribbon-1" class="headerlink" title="Ribbon"></a>Ribbon</h3><h5 id="客户端负载均衡器（Ribbon）"><a href="#客户端负载均衡器（Ribbon）" class="headerlink" title="客户端负载均衡器（Ribbon）"></a>客户端负载均衡器（Ribbon）</h5><p>服务实例的清单在客户端，客户端进行负载均衡算法</p>
<p>对HTTP和TCP客户端的行为进行大量控制</p>
<p><code>@FeignClient</code>：指定接口索要调用的服务名称</p>
<p>Ribbon通过向<code>ioc</code>注入<code>RestTemplate</code>，并通过<code>@LoadBalance</code>开启负载均衡</p>
<h5 id="服务端负载均衡（Nginx）"><a href="#服务端负载均衡（Nginx）" class="headerlink" title="服务端负载均衡（Nginx）"></a>服务端负载均衡（Nginx）</h5><p>服务实例的清单在服务端，服务器进行负载均衡算法分配</p>
<h5 id="消费时要在启动类注入Bean"><a href="#消费时要在启动类注入Bean" class="headerlink" title="消费时要在启动类注入Bean"></a>消费时要在启动类注入Bean</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerApplication</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * GetForObject反序列化需要Entity提供无参构造函数</span></span><br><span class="line"><span class="comment">	 * 否则报错</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//..psvm</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>##### </p>
<h5 id="自定义负载均衡策略"><a href="#自定义负载均衡策略" class="headerlink" title="自定义负载均衡策略"></a>自定义负载均衡策略</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySelfRule</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IRule <span class="title">myRule</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//return new RandomRule();// Ribbon默认是轮询，我自定义为随机</span></span><br><span class="line">        <span class="comment">//return new RoundRobinRule();// Ribbon默认是轮询，我自定义为随机</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RandomRule_ZY();<span class="comment">// 我自定义为每台机器5次</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//RandomRule_ZY继承AbstractLoadBalancerRule类，重写public Server choose(ILoadBalancer lb, Object key)即可。</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#NFLoadBalancerClassName:配置ILoadBalancer的实现类</span></span><br><span class="line"><span class="comment">#NFLoadBalancerRuleClassName：配置IRule的实现类</span></span><br><span class="line"><span class="comment">#NFLoadBalancerPingClassName：配置IPing的实现类</span></span><br><span class="line"><span class="comment">#NIWSServerListClassName：配置ServerList的实现类</span></span><br><span class="line"><span class="comment">#NIWSServerListFilterClassName：配置ServerListFilter的实现类</span></span><br><span class="line"></span><br><span class="line"><span class="attr">xxxxxxx:</span> <span class="comment">#服务名</span></span><br><span class="line">	<span class="attr">ribbon:</span> </span><br><span class="line">		<span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.netflix.loadbalancer.RandomRule</span> <span class="comment">#改为随机</span></span><br></pre></td></tr></table></figure>

<h3 id="Hystrix-1"><a href="#Hystrix-1" class="headerlink" title="Hystrix"></a>Hystrix</h3><h5 id="Fallback（失败快速返回）"><a href="#Fallback（失败快速返回）" class="headerlink" title="Fallback（失败快速返回）"></a><code>Fallback</code>（失败快速返回）</h5><p>当某个服务单元发生故障之后，通过断路器的故障监控，<strong>向调用方返回一个错误响应，而不是长时间的等待</strong>，这样就不会使得线程因调用故障服务被长时间占用不释放，避免了故障在分布式系统中的蔓延</p>
<h5 id="资源-依赖隔离（线程池隔离）"><a href="#资源-依赖隔离（线程池隔离）" class="headerlink" title="资源/依赖隔离（线程池隔离）"></a>资源/依赖隔离（线程池隔离）</h5><p>它会为每一个依赖服务创建一个独立的线程池，这也就算某个依赖服务出现延迟过高的情况，也只是对该依赖服务的调用产生影响，而不会拖慢其他的依赖服务</p>
<h5 id="Ribbon中应用熔断器"><a href="#Ribbon中应用熔断器" class="headerlink" title="Ribbon中应用熔断器"></a>Ribbon中应用熔断器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//启动类开启注解</span></span><br><span class="line"><span class="meta">@EnableHystrix</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//对方法创建熔断器</span></span><br><span class="line"><span class="meta">@HystrixCommand</span>(fallbackMethod=<span class="string">"aError"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> restTemplate.getForObject(<span class="string">".."</span>,String.class);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">aError</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"a error!"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Feign中应用熔断器"><a href="#Feign中应用熔断器" class="headerlink" title="Feign中应用熔断器"></a>Feign中应用熔断器</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#默认不打开，需要手动打开hystrix</span><br><span class="line">feign.hystrix.enabled=true</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient</span>(value = <span class="string">"service-hi"</span>,fallback = SchedualServiceHiHystric.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SchedualServiceHi</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/hi"</span>,method = RequestMethod.GET)</span><br><span class="line">    <span class="function">String <span class="title">sayHiFromClientOne</span><span class="params">(@RequestParam(value = <span class="string">"name"</span>)</span> String name)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SchedualServiceHiHystric</span> <span class="keyword">implements</span> <span class="title">SchedualServiceHi</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHiFromClientOne</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"sorry "</span>+name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Feign"><a href="#Feign" class="headerlink" title="Feign"></a>Feign</h3><p>声明式，模板化的HTTP客户端</p>
<h5 id="Feign整合了ribbon和RestTemplate"><a href="#Feign整合了ribbon和RestTemplate" class="headerlink" title="Feign整合了ribbon和RestTemplate"></a>Feign整合了ribbon和<code>RestTemplate</code></h5><!--重点：定义接口，接口根据URL获取服务列表中的服务，Crontroller调用接口即使用服务-->

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//启动类开启注解</span></span><br><span class="line"><span class="meta">@EnableFeignClient</span></span><br></pre></td></tr></table></figure>

<h5 id="服务绑定"><a href="#服务绑定" class="headerlink" title="服务绑定"></a>服务绑定</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// name\value ---&gt;指定调用哪个服务</span></span><br><span class="line">任意一个客户端名称，用于创建Ribbon负载均衡器，可以解析成服务，不用Eureka时也可以配置listOfServers属性配置服务器列表</span><br><span class="line"><span class="comment">// url可以是完整的URL地址或者主机名</span></span><br><span class="line"><span class="comment">// fallbackFactory---&gt;熔断器的降级提示</span></span><br><span class="line"><span class="meta">@FeignClient</span>(value = <span class="string">"MICROSERVICECLOUD-DEPT"</span>, fallbackFactory = DeptClientServiceFallbackFactory.class)</span><br></pre></td></tr></table></figure>

<h3 id="Zuul-1"><a href="#Zuul-1" class="headerlink" title="Zuul"></a>Zuul</h3><p>整合了Hystrix和Ribbon</p>
<ol>
<li>维护服务无状态的特点，实现对服务访问的权限控制</li>
<li>统一向外系统提供REST API</li>
<li>服务路由，均衡负载，权限控制</li>
</ol>
<p><code>@SpringCloudApplication</code>：整合了<code>@SpringBootApplication</code>、<code>@EnableDiscoveryClient</code>、<code>@EnableCircuitBreaker</code></p>
<h4 id="聚合服务"><a href="#聚合服务" class="headerlink" title="聚合服务"></a>聚合服务</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Finchley.SR2版zuul仅支持2.0.x的springboot-starter--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client</span><br><span class="line">    <span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix</span><br><span class="line">    <span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="网关"><a href="#网关" class="headerlink" title="网关"></a>网关</h4><h5 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-zuul</span><br><span class="line">    <span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">api-gateway</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">1101</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line"><span class="attr">    hostname:</span> <span class="string">localhost</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    serviceUrl:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://$&#123;eureka.instance.hostname&#125;:1001/eureka/</span></span><br></pre></td></tr></table></figure>

<h5 id="服务路由"><a href="#服务路由" class="headerlink" title="服务路由"></a>服务路由</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># routes to url</span></span><br><span class="line"><span class="string">zuul.routes.&lt;route&gt;.path=/url-api/**</span></span><br><span class="line"><span class="string">zuul.routes.&lt;route&gt;.url=http://localhost:2222/</span></span><br><span class="line"><span class="comment">#所有/url-api/的访问都会映射到http://localhost:2222/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#自动开启Ribbon负载均衡策略</span></span><br><span class="line"><span class="attr">zuul:</span></span><br><span class="line"><span class="attr">  routes:</span></span><br><span class="line"><span class="attr">    aggregation-client:</span> <span class="string">/message/**</span></span><br></pre></td></tr></table></figure>

<h5 id="服务过滤"><a href="#服务过滤" class="headerlink" title="服务过滤"></a>服务过滤</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//检查请求中是否有accessToken参数</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccessFilter</span> <span class="keyword">extends</span> <span class="title">ZuulFilter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger log = LoggerFactory.getLogger(AccessFilter.class);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**返回一个字符串代表过滤器类型</span></span><br><span class="line"><span class="comment">     * pre:可以在请求被路由之前调用</span></span><br><span class="line"><span class="comment">     * routing:在路由请求时候被调用</span></span><br><span class="line"><span class="comment">     * post:在routing和error过滤器之后被调用</span></span><br><span class="line"><span class="comment">     * error:处理请求时发生错误时被调用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">filterType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"pre"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//通过int值来定义过滤器的执行顺序</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">filterOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//返回一个boolean类型来判断该过滤器是否要执行，所以通过此函数可实现过滤器的开关。true:该过滤器总是生效</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> ZuulException </span>&#123;</span><br><span class="line">        RequestContext ctx = RequestContext.getCurrentContext();</span><br><span class="line">        HttpServletRequest request = ctx.getRequest();</span><br><span class="line"></span><br><span class="line">        log.info(String.format(<span class="string">"%s request to %s"</span>, request.getMethod(), request.getRequestURL().toString()));</span><br><span class="line"></span><br><span class="line">        Object accessToken = request.getParameter(<span class="string">"accessToken"</span>);</span><br><span class="line">        <span class="keyword">if</span>(accessToken == <span class="keyword">null</span>) &#123;</span><br><span class="line">            log.warn(<span class="string">"access token is empty"</span>);</span><br><span class="line">            <span class="comment">//过滤该请求，不对其进行路由</span></span><br><span class="line">            ctx.setSendZuulResponse(<span class="keyword">false</span>);</span><br><span class="line">            <span class="comment">//设置返回的错误码</span></span><br><span class="line">            ctx.setResponseStatusCode(<span class="number">401</span>);</span><br><span class="line">            <span class="comment">//对返回的body内容进行编辑</span></span><br><span class="line">            <span class="comment">//ctx.setResponseBody(body);</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">"access token ok"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//在应用主类中定义bean才会生效</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> AccessFilter <span class="title">accessFilter</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> AccessFilter();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Config-1"><a href="#Config-1" class="headerlink" title="Config"></a>Config</h3><h5 id="bootstrap"><a href="#bootstrap" class="headerlink" title="bootstrap"></a>bootstrap</h5><p>程序引导时执行，应用于更加早期配置信息读取</p>
<h5 id="application"><a href="#application" class="headerlink" title="application"></a>application</h5><p>应用程序特有配置信息</p>
<p>bootstrap先于application加载</p>
<h4 id="Server-1"><a href="#Server-1" class="headerlink" title="Server"></a>Server</h4><h5 id="git调用远程仓库"><a href="#git调用远程仓库" class="headerlink" title="git调用远程仓库"></a>git调用远程仓库</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#写在bootstrap里</span></span><br><span class="line"><span class="string">spring</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">config-server</span></span><br><span class="line"><span class="attr">  cloud:</span></span><br><span class="line"><span class="attr">    config:</span></span><br><span class="line"><span class="attr">      server:</span></span><br><span class="line"><span class="attr">        git:</span></span><br><span class="line"><span class="attr">          uri:</span> <span class="attr">http://git.oschina.net/&lt;config</span> <span class="string">repository&gt;/</span></span><br><span class="line"><span class="attr">          username:</span> <span class="string">xxxx</span></span><br><span class="line"><span class="attr">          password:</span> <span class="string">xxxx</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">1201</span></span><br></pre></td></tr></table></figure>

<h5 id="读取本地文件"><a href="#读取本地文件" class="headerlink" title="读取本地文件"></a>读取本地文件</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span></span><br><span class="line"><span class="attr">    active:</span> <span class="string">native</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">config-server</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">1201</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line"><span class="attr">    hostname:</span> <span class="string">config-server1</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    service-url:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://eureka-server1:8761/eureka/</span></span><br></pre></td></tr></table></figure>

<h4 id="Client-1"><a href="#Client-1" class="headerlink" title="Client"></a>Client</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">eureka-client</span></span><br><span class="line"><span class="attr">  cloud:</span></span><br><span class="line"><span class="attr">    config:</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">config-eureka-client</span></span><br><span class="line"><span class="attr">      profile:</span> <span class="string">dev</span></span><br><span class="line">      <span class="comment">#指定地址去获取值</span></span><br><span class="line">      <span class="comment">#uri: http://</span></span><br><span class="line"><span class="attr">      label:</span> <span class="string">master</span></span><br><span class="line">      <span class="comment">#从注册中心的服务名称，去获取值</span></span><br><span class="line"><span class="attr">      discovery:</span></span><br><span class="line"><span class="attr">        enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">        service-id:</span> <span class="string">config-server</span></span><br><span class="line"><span class="attr">      git:</span></span><br><span class="line"><span class="attr">        basedir:</span> <span class="string">config-repo</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line"><span class="attr">    hostname:</span> <span class="string">eureka-client1</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    service-url:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://eureka-server1:8761/eureka/</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">1001</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="引用BUS自动刷新"><a href="#引用BUS自动刷新" class="headerlink" title="引用BUS自动刷新"></a>引用BUS自动刷新</h4><h5 id="增加依赖"><a href="#增加依赖" class="headerlink" title="增加依赖"></a>增加依赖</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//F版本必须对应SpringBoot2.0.x</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bus-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="增加配置"><a href="#增加配置" class="headerlink" title="增加配置"></a>增加配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">## 刷新时，关闭安全验证</span><br><span class="line">management.security.enabled=false</span><br><span class="line">## 开启消息跟踪</span><br><span class="line">spring.cloud.bus.trace.enabled=true</span><br><span class="line"></span><br><span class="line">spring.rabbitmq.host=localhost</span><br><span class="line">spring.rabbitmq.port=5672</span><br><span class="line">spring.rabbitmq.username=guest</span><br><span class="line">spring.rabbitmq.password=guest</span><br></pre></td></tr></table></figure>

<h5 id="在需要更新的控制类上添加"><a href="#在需要更新的控制类上添加" class="headerlink" title="在需要更新的控制类上添加"></a>在需要更新的控制类上添加</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RefreshScope</span><span class="comment">//添加该注解的类会在配置更改时得到特殊的处理</span></span><br></pre></td></tr></table></figure>

<h1 id="分布式"><a href="#分布式" class="headerlink" title="分布式"></a>分布式</h1><p>内部的一些核心服务，性能要求比较高的可以采用RPC，对外服务的一般可以采用REST</p>
<h2 id="模式"><a href="#模式" class="headerlink" title="模式"></a>模式</h2><h3 id="SOA–面向消息"><a href="#SOA–面向消息" class="headerlink" title="SOA–面向消息"></a>SOA–面向消息</h3><p>–&gt; Service-Oriented Architecture：面向服务的架构</p>
<p>包含多个服务，服务之间通过相互依赖最终提供一系列的功能，一个服务通常以独立的形式存在与操作系统进程中。各个服务之间通过网络调用</p>
<h2 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h2><h3 id="RPC–面向过程"><a href="#RPC–面向过程" class="headerlink" title="RPC–面向过程"></a>RPC–面向过程</h3><p>–&gt; Remote Procedure Call Protocol：远程过程调用协议</p>
<p>通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的协议</p>
<ol>
<li>解决服务之间的调用问题</li>
<li>服务之间调用要像本地调用一样方便</li>
<li>一般都架在TCP/IP协议上</li>
</ol>
<h5 id="RPC是分布式架构的核心"><a href="#RPC是分布式架构的核心" class="headerlink" title="RPC是分布式架构的核心"></a>RPC是分布式架构的核心</h5><p>响应式划分：</p>
<ul>
<li><p>同步调用：客户端调用服务方方法，等待直到服务方返回结果或者超时，再继续自己的操作</p>
<p><code>WebService</code>/<code>RMI</code></p>
</li>
<li><p>异步调用：客户端把消息发送给中间件，不再等待服务端返回，直接继续自己的操作</p>
<p><code>JMS</code>中间件：<code>ActiveMQ</code>，<code>Kafka</code>，<code>RocketMQ</code></p>
</li>
</ul>
<h5 id="RPC优点"><a href="#RPC优点" class="headerlink" title="RPC优点"></a>RPC优点</h5><ol>
<li>TCP不用经过3次握手，减少了网络开销</li>
</ol>
<h3 id="RESTful–面向资源"><a href="#RESTful–面向资源" class="headerlink" title="RESTful–面向资源"></a>RESTful–面向资源</h3><blockquote>
<p>Representation State Transfer：表述性状态传递，软件架构风格</p>
<p>通过HTTP协议定义的通用方法（GET，PUT，DELETE，POST），以URI对网络资源进行唯一标识，响应端根据请求端的不同需求，通过无状态通信，对其请求的资源进行表述</p>
</blockquote>
<h5 id="REST架构的主要原则"><a href="#REST架构的主要原则" class="headerlink" title="REST架构的主要原则"></a>REST架构的主要原则</h5><ol>
<li>网络上的所有事物都被抽象为资源</li>
<li>每个资源都有一个唯一的资源标识符</li>
<li>同一个资源具有多种表现形式（xml，json等）</li>
<li>对资源的各种操作不会改变资源标识符</li>
<li>所有的操作都是无状态的</li>
</ol>
<h5 id="无状态通信"><a href="#无状态通信" class="headerlink" title="无状态通信"></a>无状态通信</h5><p>无状态增强了系统的拓展性</p>
<blockquote>
<p>服务端不保存任何与特定HTTP请求相关的资源，应用状态必须由请求放在请求过程中提供。</p>
<p>要求在网络通信过程中，任意一个Web请求必须<strong>与其他请求隔离</strong>，当请求端提出请求时，请求本身包含了响应端为响应这一请求所需的全部信息</p>
</blockquote>
<h5 id="RESTful用法"><a href="#RESTful用法" class="headerlink" title="RESTful用法"></a>RESTful用法</h5><ul>
<li>GET：查询  幂等  安全</li>
<li>POST：增加  不幂等  不安全</li>
<li>PUT：修改  幂等  不安全</li>
<li>DELETE：删除  幂等  不安全</li>
</ul>
<p>幂等性：对同一REST接口进行多次访问，得到的资源状态是相同的</p>
<p>安全性：对该REST接口访问，不会使服务器端资源的状态发生改变</p>
<h4 id="REST三要素"><a href="#REST三要素" class="headerlink" title="REST三要素"></a>REST三要素</h4><ol>
<li>唯一的资源标识</li>
<li>简单的方法</li>
<li>一定的表达方式</li>
</ol>
<h3 id="SOAP–简单对象访问协议"><a href="#SOAP–简单对象访问协议" class="headerlink" title="SOAP–简单对象访问协议"></a>SOAP–简单对象访问协议</h3><p>–&gt; Simple Object Access Protocol：简单对象访问协议</p>
<ol>
<li>分布式环境的，轻量级的，基于XML进行信息交换的通信协议</li>
<li>可以在任何传输协议上使用</li>
<li>SOAP=RPC+HTTP+XML</li>
</ol>
<h5 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h5><ol>
<li>SOAP协议对于消息体和消息头都有定义，规范，安全</li>
<li>由于各种需求不断扩充其本身协议的内容，导致SOAP处理方面的性能有所下降，</li>
<li>SOAP也是基于HTTP协议，但是提供了session，cookie机制使得SOAP有状态，从而支持需要有状态的业务</li>
</ol>
<h3 id="XML-RPC"><a href="#XML-RPC" class="headerlink" title="XML-RPC"></a>XML-RPC</h3><p>一个远程过程调用的分布式计算协议</p>
<p>通过XML将调用函数封装，并使用HTTP协议作为传送机制</p>
<h2 id="接口设计"><a href="#接口设计" class="headerlink" title="接口设计"></a>接口设计</h2><h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><blockquote>
<p>应用程序编程接口</p>
<p>预先定义的函数，目的是作为”介面“沟通两个不同的东西，提供应用程序与开发人员基于某软件或硬件得以访问一组例程的能力，而又无需访问源码，或理解内部工作机制的细节</p>
</blockquote>
<h3 id="SDK"><a href="#SDK" class="headerlink" title="SDK"></a>SDK</h3><blockquote>
<p>软件开发工具包</p>
<p>被软件工程师用于为特定的软件包，软件框架，硬件平台，操作系统等建立应用软件的开发工具的集合。通俗点是指由第三方服务商提供的实现软件产品某项功能的工具包</p>
</blockquote>
<h3 id="SDK和API的区别"><a href="#SDK和API的区别" class="headerlink" title="SDK和API的区别"></a>SDK和API的区别</h3><p>SDK相当于开发集成工具环境，API就是数据接口。在SDK环境下调用API数据</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/10/03/MQ/" rel="next" title="MQ">
                <i class="fa fa-chevron-left"></i> MQ
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/10/03/面试问题归档/" rel="prev" title="面试的一些小问题">
                面试的一些小问题 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/author.jpg" alt="PPCoder">
            
              <p class="site-author-name" itemprop="name">PPCoder</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#微服务"><span class="nav-number">1.</span> <span class="nav-text">微服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#服务的发现与注册"><span class="nav-number">1.0.1.</span> <span class="nav-text">服务的发现与注册</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#高可用性"><span class="nav-number">1.0.2.</span> <span class="nav-text">高可用性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#负载均衡服务器的高可用性"><span class="nav-number">1.0.2.1.</span> <span class="nav-text">负载均衡服务器的高可用性</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dubbo"><span class="nav-number">1.1.</span> <span class="nav-text">Dubbo</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring-Cloud"><span class="nav-number">1.2.</span> <span class="nav-text">Spring Cloud</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#版本冲突详见"><span class="nav-number">1.2.0.1.</span> <span class="nav-text">版本冲突详见</span></a></li></ol></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#SpringCloud组件"><span class="nav-number">1.3.</span> <span class="nav-text">SpringCloud组件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Netflix"><span class="nav-number">1.3.1.</span> <span class="nav-text">Netflix</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Eureka"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">Eureka</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Ribbon"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">Ribbon</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Hystrix"><span class="nav-number">1.3.1.3.</span> <span class="nav-text">Hystrix</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Zuul"><span class="nav-number">1.3.1.4.</span> <span class="nav-text">Zuul</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Archaius"><span class="nav-number">1.3.1.5.</span> <span class="nav-text">Archaius</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-Cloud-1"><span class="nav-number">1.3.2.</span> <span class="nav-text">Spring Cloud</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Config"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">Config</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Bus"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">Bus</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cloud-Foundry"><span class="nav-number">1.3.2.3.</span> <span class="nav-text">Cloud Foundry</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cluster"><span class="nav-number">1.3.2.4.</span> <span class="nav-text">Cluster</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Consul"><span class="nav-number">1.3.2.5.</span> <span class="nav-text">Consul</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Security"><span class="nav-number">1.3.2.6.</span> <span class="nav-text">Security</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Sleuth"><span class="nav-number">1.3.2.7.</span> <span class="nav-text">Sleuth</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Data-Flow"><span class="nav-number">1.3.2.8.</span> <span class="nav-text">Data Flow</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Stream"><span class="nav-number">1.3.2.9.</span> <span class="nav-text">Stream</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Task"><span class="nav-number">1.3.2.10.</span> <span class="nav-text">Task</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Zookeeper"><span class="nav-number">1.3.2.11.</span> <span class="nav-text">Zookeeper</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Connectors"><span class="nav-number">1.3.2.12.</span> <span class="nav-text">Connectors</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Starters"><span class="nav-number">1.3.2.13.</span> <span class="nav-text">Starters</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CLI"><span class="nav-number">1.3.2.14.</span> <span class="nav-text">CLI</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dalston版"><span class="nav-number">1.4.</span> <span class="nav-text">Dalston版</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#配置环境"><span class="nav-number">1.4.1.</span> <span class="nav-text">配置环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Eureka-Service"><span class="nav-number">1.4.2.</span> <span class="nav-text">Eureka Service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Zuul网关"><span class="nav-number">1.4.3.</span> <span class="nav-text">Zuul网关</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#路由规则"><span class="nav-number">1.4.3.0.1.</span> <span class="nav-text">路由规则</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#默认路由规则："><span class="nav-number">1.4.3.0.2.</span> <span class="nav-text">默认路由规则：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#传统路由配置"><span class="nav-number">1.4.3.0.3.</span> <span class="nav-text">传统路由配置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#服务路由配置"><span class="nav-number">1.4.3.0.4.</span> <span class="nav-text">服务路由配置</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Finchley版"><span class="nav-number">1.5.</span> <span class="nav-text">Finchley版</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#配置环境-1"><span class="nav-number">1.5.1.</span> <span class="nav-text">配置环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Eureka-1"><span class="nav-number">1.5.2.</span> <span class="nav-text">Eureka</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Server"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">Server</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#启动服务"><span class="nav-number">1.5.2.1.1.</span> <span class="nav-text">启动服务</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#失效剔除"><span class="nav-number">1.5.2.1.2.</span> <span class="nav-text">失效剔除</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#自我保护"><span class="nav-number">1.5.2.1.3.</span> <span class="nav-text">自我保护</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#【未解决】-添加用户认证"><span class="nav-number">1.5.2.1.4.</span> <span class="nav-text">【未解决】*添加用户认证</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Eureka的元数据"><span class="nav-number">1.5.2.1.5.</span> <span class="nav-text">Eureka的元数据</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#多网卡环境下的ip选择"><span class="nav-number">1.5.2.1.6.</span> <span class="nav-text">多网卡环境下的ip选择</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Server的高可用"><span class="nav-number">1.5.2.2.</span> <span class="nav-text">Server的高可用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Client"><span class="nav-number">1.5.2.3.</span> <span class="nav-text">Client</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#首次注册"><span class="nav-number">1.5.2.3.1.</span> <span class="nav-text">首次注册</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#服务续约"><span class="nav-number">1.5.2.3.2.</span> <span class="nav-text">服务续约</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#服务注册"><span class="nav-number">1.5.2.3.3.</span> <span class="nav-text">服务注册</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#服务下线"><span class="nav-number">1.5.2.3.4.</span> <span class="nav-text">服务下线</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#健康检查"><span class="nav-number">1.5.2.3.5.</span> <span class="nav-text">健康检查</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#客户端和服务端区别"><span class="nav-number">1.5.2.4.</span> <span class="nav-text">客户端和服务端区别</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#客户端模式"><span class="nav-number">1.5.2.4.1.</span> <span class="nav-text">客户端模式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#服务端模式"><span class="nav-number">1.5.2.4.2.</span> <span class="nav-text">服务端模式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ribbon-1"><span class="nav-number">1.5.3.</span> <span class="nav-text">Ribbon</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#客户端负载均衡器（Ribbon）"><span class="nav-number">1.5.3.0.1.</span> <span class="nav-text">客户端负载均衡器（Ribbon）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#服务端负载均衡（Nginx）"><span class="nav-number">1.5.3.0.2.</span> <span class="nav-text">服务端负载均衡（Nginx）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#消费时要在启动类注入Bean"><span class="nav-number">1.5.3.0.3.</span> <span class="nav-text">消费时要在启动类注入Bean</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#自定义负载均衡策略"><span class="nav-number">1.5.3.0.4.</span> <span class="nav-text">自定义负载均衡策略</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hystrix-1"><span class="nav-number">1.5.4.</span> <span class="nav-text">Hystrix</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Fallback（失败快速返回）"><span class="nav-number">1.5.4.0.1.</span> <span class="nav-text">Fallback（失败快速返回）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#资源-依赖隔离（线程池隔离）"><span class="nav-number">1.5.4.0.2.</span> <span class="nav-text">资源/依赖隔离（线程池隔离）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Ribbon中应用熔断器"><span class="nav-number">1.5.4.0.3.</span> <span class="nav-text">Ribbon中应用熔断器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Feign中应用熔断器"><span class="nav-number">1.5.4.0.4.</span> <span class="nav-text">Feign中应用熔断器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Feign"><span class="nav-number">1.5.5.</span> <span class="nav-text">Feign</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Feign整合了ribbon和RestTemplate"><span class="nav-number">1.5.5.0.1.</span> <span class="nav-text">Feign整合了ribbon和RestTemplate</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#服务绑定"><span class="nav-number">1.5.5.0.2.</span> <span class="nav-text">服务绑定</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Zuul-1"><span class="nav-number">1.5.6.</span> <span class="nav-text">Zuul</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#聚合服务"><span class="nav-number">1.5.6.1.</span> <span class="nav-text">聚合服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#网关"><span class="nav-number">1.5.6.2.</span> <span class="nav-text">网关</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#依赖"><span class="nav-number">1.5.6.2.1.</span> <span class="nav-text">依赖</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#配置"><span class="nav-number">1.5.6.2.2.</span> <span class="nav-text">配置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#服务路由"><span class="nav-number">1.5.6.2.3.</span> <span class="nav-text">服务路由</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#服务过滤"><span class="nav-number">1.5.6.2.4.</span> <span class="nav-text">服务过滤</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Config-1"><span class="nav-number">1.5.7.</span> <span class="nav-text">Config</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#bootstrap"><span class="nav-number">1.5.7.0.1.</span> <span class="nav-text">bootstrap</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#application"><span class="nav-number">1.5.7.0.2.</span> <span class="nav-text">application</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Server-1"><span class="nav-number">1.5.7.1.</span> <span class="nav-text">Server</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#git调用远程仓库"><span class="nav-number">1.5.7.1.1.</span> <span class="nav-text">git调用远程仓库</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#读取本地文件"><span class="nav-number">1.5.7.1.2.</span> <span class="nav-text">读取本地文件</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Client-1"><span class="nav-number">1.5.7.2.</span> <span class="nav-text">Client</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#引用BUS自动刷新"><span class="nav-number">1.5.7.3.</span> <span class="nav-text">引用BUS自动刷新</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#增加依赖"><span class="nav-number">1.5.7.3.1.</span> <span class="nav-text">增加依赖</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#增加配置"><span class="nav-number">1.5.7.3.2.</span> <span class="nav-text">增加配置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#在需要更新的控制类上添加"><span class="nav-number">1.5.7.3.3.</span> <span class="nav-text">在需要更新的控制类上添加</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#分布式"><span class="nav-number">2.</span> <span class="nav-text">分布式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#模式"><span class="nav-number">2.1.</span> <span class="nav-text">模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SOA–面向消息"><span class="nav-number">2.1.1.</span> <span class="nav-text">SOA–面向消息</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#协议"><span class="nav-number">2.2.</span> <span class="nav-text">协议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RPC–面向过程"><span class="nav-number">2.2.1.</span> <span class="nav-text">RPC–面向过程</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#RPC是分布式架构的核心"><span class="nav-number">2.2.1.0.1.</span> <span class="nav-text">RPC是分布式架构的核心</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RPC优点"><span class="nav-number">2.2.1.0.2.</span> <span class="nav-text">RPC优点</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RESTful–面向资源"><span class="nav-number">2.2.2.</span> <span class="nav-text">RESTful–面向资源</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#REST架构的主要原则"><span class="nav-number">2.2.2.0.1.</span> <span class="nav-text">REST架构的主要原则</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#无状态通信"><span class="nav-number">2.2.2.0.2.</span> <span class="nav-text">无状态通信</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RESTful用法"><span class="nav-number">2.2.2.0.3.</span> <span class="nav-text">RESTful用法</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#REST三要素"><span class="nav-number">2.2.2.1.</span> <span class="nav-text">REST三要素</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SOAP–简单对象访问协议"><span class="nav-number">2.2.3.</span> <span class="nav-text">SOAP–简单对象访问协议</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#优点"><span class="nav-number">2.2.3.0.1.</span> <span class="nav-text">优点</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#XML-RPC"><span class="nav-number">2.2.4.</span> <span class="nav-text">XML-RPC</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#接口设计"><span class="nav-number">2.3.</span> <span class="nav-text">接口设计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#API"><span class="nav-number">2.3.1.</span> <span class="nav-text">API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SDK"><span class="nav-number">2.3.2.</span> <span class="nav-text">SDK</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SDK和API的区别"><span class="nav-number">2.3.3.</span> <span class="nav-text">SDK和API的区别</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考资料"><span class="nav-number">2.4.</span> <span class="nav-text">参考资料</span></a></li></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">PPCoder</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
